import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { Effect, ofType } from '@ngrx/effects';
import { normalizeHttpError, StateUtils, OCC_USER_ID_ANONYMOUS, } from '@spartacus/core';
import { of } from 'rxjs';
import { catchError, filter, map, switchMap } from 'rxjs/operators';
import { OrderApprovalActions } from '../actions/index';
import * as i0 from "@angular/core";
import * as i1 from "@ngrx/effects";
import * as i2 from "../../connectors/order-approval.connector";
export class OrderApprovalEffects {
    constructor(actions$, orderApprovalConnector) {
        this.actions$ = actions$;
        this.orderApprovalConnector = orderApprovalConnector;
        this.loadOrderApproval$ = this.actions$.pipe(ofType(OrderApprovalActions.LOAD_ORDER_APPROVAL), map((action) => action.payload), filter((payload) => payload.userId !== OCC_USER_ID_ANONYMOUS), switchMap(({ userId, orderApprovalCode }) => {
            return this.orderApprovalConnector.get(userId, orderApprovalCode).pipe(map((orderApproval) => {
                return new OrderApprovalActions.LoadOrderApprovalSuccess([
                    orderApproval,
                ]);
            }), catchError((error) => of(new OrderApprovalActions.LoadOrderApprovalFail({
                orderApprovalCode,
                error: normalizeHttpError(error),
            }))));
        }));
        this.loadOrderApprovals$ = this.actions$.pipe(ofType(OrderApprovalActions.LOAD_ORDER_APPROVALS), map((action) => action.payload), filter((payload) => payload.userId !== OCC_USER_ID_ANONYMOUS), switchMap(({ userId, params }) => this.orderApprovalConnector.getList(userId, params).pipe(switchMap((orderApprovals) => {
            const { values, page } = StateUtils.normalizeListPage(orderApprovals, 'code');
            return [
                new OrderApprovalActions.LoadOrderApprovalSuccess(values),
                new OrderApprovalActions.LoadOrderApprovalsSuccess({
                    page,
                    params,
                }),
            ];
        }), catchError((error) => of(new OrderApprovalActions.LoadOrderApprovalsFail({
            params: params,
            error: normalizeHttpError(error),
        }))))));
        this.makeDecision$ = this.actions$.pipe(ofType(OrderApprovalActions.MAKE_DECISION), map((action) => action.payload), filter((payload) => payload.userId !== OCC_USER_ID_ANONYMOUS), switchMap(({ userId, orderApprovalCode, orderApprovalDecision }) => this.orderApprovalConnector
            .makeDecision(userId, orderApprovalCode, orderApprovalDecision)
            .pipe(switchMap((orderApprovalDecisionData) => [
            new OrderApprovalActions.MakeDecisionSuccess({
                orderApprovalCode,
                orderApprovalDecision: orderApprovalDecisionData,
            }),
            new OrderApprovalActions.LoadOrderApproval({
                userId,
                orderApprovalCode,
            }),
        ]), catchError((error) => of(new OrderApprovalActions.MakeDecisionFail({
            orderApprovalCode: orderApprovalCode,
            error: normalizeHttpError(error),
        }))))));
    }
}
OrderApprovalEffects.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: OrderApprovalEffects, deps: [{ token: i1.Actions }, { token: i2.OrderApprovalConnector }], target: i0.ɵɵFactoryTarget.Injectable });
OrderApprovalEffects.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: OrderApprovalEffects });
__decorate([
    Effect()
], OrderApprovalEffects.prototype, "loadOrderApproval$", void 0);
__decorate([
    Effect()
], OrderApprovalEffects.prototype, "loadOrderApprovals$", void 0);
__decorate([
    Effect()
], OrderApprovalEffects.prototype, "makeDecision$", void 0);
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: OrderApprovalEffects, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.Actions }, { type: i2.OrderApprovalConnector }]; }, propDecorators: { loadOrderApproval$: [], loadOrderApprovals$: [], makeDecision$: [] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3JkZXItYXBwcm92YWwuZWZmZWN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL29yZ2FuaXphdGlvbi9vcmRlci1hcHByb3ZhbC9jb3JlL3N0b3JlL2VmZmVjdHMvb3JkZXItYXBwcm92YWwuZWZmZWN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBVyxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hELE9BQU8sRUFFTCxrQkFBa0IsRUFDbEIsVUFBVSxFQUNWLHFCQUFxQixHQUN0QixNQUFNLGlCQUFpQixDQUFDO0FBQ3pCLE9BQU8sRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdEMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBR3BFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLGtCQUFrQixDQUFDOzs7O0FBR3hELE1BQU0sT0FBTyxvQkFBb0I7SUFtRy9CLFlBQ1UsUUFBaUIsRUFDakIsc0JBQThDO1FBRDlDLGFBQVEsR0FBUixRQUFRLENBQVM7UUFDakIsMkJBQXNCLEdBQXRCLHNCQUFzQixDQUF3QjtRQW5HeEQsdUJBQWtCLEdBR2QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQ3BCLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxtQkFBbUIsQ0FBQyxFQUNoRCxHQUFHLENBQUMsQ0FBQyxNQUE4QyxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQ3ZFLE1BQU0sQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLE1BQU0sS0FBSyxxQkFBcUIsQ0FBQyxFQUM3RCxTQUFTLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxpQkFB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d0IsRUFBRSxFQUFFLENBQ3RDLEVBQUUsQ0FDQSxJQUFJLG9CQUFvQixDQUFDLGdCQUFnQixDQUFDO1lBQ3hDLGlCQUFpQixFQUFFLGlCQUFpQjtZQUNwQyxLQUFLLEVBQUUsa0JBQWtCLENBQUMsS0FBSyxDQUFDO1NBQ2pDLENBQUMsQ0FDSCxDQUNGLENBQ0YsQ0FDSixDQUNGLENBQUM7SUFLQyxDQUFDOztpSEF0R08sb0JBQW9CO3FIQUFwQixvQkFBb0I7QUFFL0I7SUFEQyxNQUFNLEVBQUU7Z0VBeUJQO0FBR0Y7SUFEQyxNQUFNLEVBQUU7aUVBa0NQO0FBR0Y7SUFEQyxNQUFNLEVBQUU7MkRBaUNQOzJGQWpHUyxvQkFBb0I7a0JBRGhDLFVBQVU7bUlBR1Qsa0JBQWtCLE1BMkJsQixtQkFBbUIsTUFvQ25CLGFBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwRXJyb3JSZXNwb25zZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFjdGlvbnMsIEVmZmVjdCwgb2ZUeXBlIH0gZnJvbSAnQG5ncngvZWZmZWN0cyc7XG5pbXBvcnQge1xuICBFbnRpdGllc01vZGVsLFxuICBub3JtYWxpemVIdHRwRXJyb3IsXG4gIFN0YXRlVXRpbHMsXG4gIE9DQ19VU0VSX0lEX0FOT05ZTU9VUyxcbn0gZnJvbSAnQHNwYXJ0YWN1cy9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjYXRjaEVycm9yLCBmaWx0ZXIsIG1hcCwgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgT3JkZXJBcHByb3ZhbENvbm5lY3RvciB9IGZyb20gJy4uLy4uL2Nvbm5lY3RvcnMvb3JkZXItYXBwcm92YWwuY29ubmVjdG9yJztcbmltcG9ydCB7IE9yZGVyQXBwcm92YWwgfSBmcm9tICcuLi8uLi9tb2RlbC9vcmRlci1hcHByb3ZhbC5tb2RlbCc7XG5pbXBvcnQgeyBPcmRlckFwcHJvdmFsQWN0aW9ucyB9IGZyb20gJy4uL2FjdGlvbnMvaW5kZXgnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgT3JkZXJBcHByb3ZhbEVmZmVjdHMge1xuICBARWZmZWN0KClcbiAgbG9hZE9yZGVyQXBwcm92YWwkOiBPYnNlcnZhYmxlPFxuICAgIHwgT3JkZXJBcHByb3ZhbEFjdGlvbnMuTG9hZE9yZGVyQXBwcm92YWxTdWNjZXNzXG4gICAgfCBPcmRlckFwcHJvdmFsQWN0aW9ucy5Mb2FkT3JkZXJBcHByb3ZhbEZhaWxcbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICBvZlR5cGUoT3JkZXJBcHByb3ZhbEFjdGlvbnMuTE9BRF9PUkRFUl9BUFBST1ZBTCksXG4gICAgbWFwKChhY3Rpb246IE9yZGVyQXBwcm92YWxBY3Rpb25zLkxvYWRPcmRlckFwcHJvdmFsKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgZmlsdGVyKChwYXlsb2FkKSA9PiBwYXlsb2FkLnVzZXJJZCAhPT0gT0NDX1VTRVJfSURfQU5PTllNT1VTKSxcbiAgICBzd2l0Y2hNYXAoKHsgdXNlcklkLCBvcmRlckFwcHJvdmFsQ29kZSB9KSA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5vcmRlckFwcHJvdmFsQ29ubmVjdG9yLmdldCh1c2VySWQsIG9yZGVyQXBwcm92YWxDb2RlKS5waXBlKFxuICAgICAgICBtYXAoKG9yZGVyQXBwcm92YWw6IE9yZGVyQXBwcm92YWwpID0+IHtcbiAgICAgICAgICByZXR1cm4gbmV3IE9yZGVyQXBwcm92YWxBY3Rpb25zLkxvYWRPcmRlckFwcHJvdmFsU3VjY2VzcyhbXG4gICAgICAgICAgICBvcmRlckFwcHJvdmFsLFxuICAgICAgICAgIF0pO1xuICAgICAgICB9KSxcbiAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgIG9mKFxuICAgICAgICAgICAgbmV3IE9yZGVyQXBwcm92YWxBY3Rpb25zLkxvYWRPcmRlckFwcHJvdmFsRmFpbCh7XG4gICAgICAgICAgICAgIG9yZGVyQXBwcm92YWxDb2RlLFxuICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICApO1xuICAgIH0pXG4gICk7XG5cbiAgQEVmZmVjdCgpXG4gIGxvYWRPcmRlckFwcHJvdmFscyQ6IE9ic2VydmFibGU8XG4gICAgfCBPcmRlckFwcHJvdmFsQWN0aW9ucy5Mb2FkT3JkZXJBcHByb3ZhbHNTdWNjZXNzXG4gICAgfCBPcmRlckFwcHJvdmFsQWN0aW9ucy5Mb2FkT3JkZXJBcHByb3ZhbFN1Y2Nlc3NcbiAgICB8IE9yZGVyQXBwcm92YWxBY3Rpb25zLkxvYWRPcmRlckFwcHJvdmFsc0ZhaWxcbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICBvZlR5cGUoT3JkZXJBcHByb3ZhbEFjdGlvbnMuTE9BRF9PUkRFUl9BUFBST1ZBTFMpLFxuICAgIG1hcCgoYWN0aW9uOiBPcmRlckFwcHJvdmFsQWN0aW9ucy5Mb2FkT3JkZXJBcHByb3ZhbHMpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICBmaWx0ZXIoKHBheWxvYWQpID0+IHBheWxvYWQudXNlcklkICE9PSBPQ0NfVVNFUl9JRF9BTk9OWU1PVVMpLFxuICAgIHN3aXRjaE1hcCgoeyB1c2VySWQsIHBhcmFtcyB9KSA9PlxuICAgICAgdGhpcy5vcmRlckFwcHJvdmFsQ29ubmVjdG9yLmdldExpc3QodXNlcklkLCBwYXJhbXMpLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcCgob3JkZXJBcHByb3ZhbHM6IEVudGl0aWVzTW9kZWw8T3JkZXJBcHByb3ZhbD4pID0+IHtcbiAgICAgICAgICBjb25zdCB7IHZhbHVlcywgcGFnZSB9ID0gU3RhdGVVdGlscy5ub3JtYWxpemVMaXN0UGFnZShcbiAgICAgICAgICAgIG9yZGVyQXBwcm92YWxzLFxuICAgICAgICAgICAgJ2NvZGUnXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgbmV3IE9yZGVyQXBwcm92YWxBY3Rpb25zLkxvYWRPcmRlckFwcHJvdmFsU3VjY2Vzcyh2YWx1ZXMpLFxuICAgICAgICAgICAgbmV3IE9yZGVyQXBwcm92YWxBY3Rpb25zLkxvYWRPcmRlckFwcHJvdmFsc1N1Y2Nlc3Moe1xuICAgICAgICAgICAgICBwYWdlLFxuICAgICAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICBdO1xuICAgICAgICB9KSxcbiAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgIG9mKFxuICAgICAgICAgICAgbmV3IE9yZGVyQXBwcm92YWxBY3Rpb25zLkxvYWRPcmRlckFwcHJvdmFsc0ZhaWwoe1xuICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtcyxcbiAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKVxuICAgIClcbiAgKTtcblxuICBARWZmZWN0KClcbiAgbWFrZURlY2lzaW9uJDogT2JzZXJ2YWJsZTxcbiAgICB8IE9yZGVyQXBwcm92YWxBY3Rpb25zLk1ha2VEZWNpc2lvblN1Y2Nlc3NcbiAgICB8IE9yZGVyQXBwcm92YWxBY3Rpb25zLkxvYWRPcmRlckFwcHJvdmFsXG4gICAgfCBPcmRlckFwcHJvdmFsQWN0aW9ucy5NYWtlRGVjaXNpb25GYWlsXG4gID4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgb2ZUeXBlKE9yZGVyQXBwcm92YWxBY3Rpb25zLk1BS0VfREVDSVNJT04pLFxuICAgIG1hcCgoYWN0aW9uOiBPcmRlckFwcHJvdmFsQWN0aW9ucy5NYWtlRGVjaXNpb24pID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICBmaWx0ZXIoKHBheWxvYWQpID0+IHBheWxvYWQudXNlcklkICE9PSBPQ0NfVVNFUl9JRF9BTk9OWU1PVVMpLFxuICAgIHN3aXRjaE1hcCgoeyB1c2VySWQsIG9yZGVyQXBwcm92YWxDb2RlLCBvcmRlckFwcHJvdmFsRGVjaXNpb24gfSkgPT5cbiAgICAgIHRoaXMub3JkZXJBcHByb3ZhbENvbm5lY3RvclxuICAgICAgICAubWFrZURlY2lzaW9uKHVzZXJJZCwgb3JkZXJBcHByb3ZhbENvZGUsIG9yZGVyQXBwcm92YWxEZWNpc2lvbilcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgc3dpdGNoTWFwKChvcmRlckFwcHJvdmFsRGVjaXNpb25EYXRhKSA9PiBbXG4gICAgICAgICAgICBuZXcgT3JkZXJBcHByb3ZhbEFjdGlvbnMuTWFrZURlY2lzaW9uU3VjY2Vzcyh7XG4gICAgICAgICAgICAgIG9yZGVyQXBwcm92YWxDb2RlLFxuICAgICAgICAgICAgICBvcmRlckFwcHJvdmFsRGVjaXNpb246IG9yZGVyQXBwcm92YWxEZWNpc2lvbkRhdGEsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIG5ldyBPcmRlckFwcHJvdmFsQWN0aW9ucy5Mb2FkT3JkZXJBcHByb3ZhbCh7XG4gICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgb3JkZXJBcHByb3ZhbENvZGUsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICBdKSxcbiAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICBvZihcbiAgICAgICAgICAgICAgbmV3IE9yZGVyQXBwcm92YWxBY3Rpb25zLk1ha2VEZWNpc2lvbkZhaWwoe1xuICAgICAgICAgICAgICAgIG9yZGVyQXBwcm92YWxDb2RlOiBvcmRlckFwcHJvdmFsQ29kZSxcbiAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICApXG4gICk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBhY3Rpb25zJDogQWN0aW9ucyxcbiAgICBwcml2YXRlIG9yZGVyQXBwcm92YWxDb25uZWN0b3I6IE9yZGVyQXBwcm92YWxDb25uZWN0b3JcbiAgKSB7fVxufVxuIl19