import { ChangeDetectionStrategy, Component } from '@angular/core';
import { Validators } from '@angular/forms';
import { combineLatest } from 'rxjs';
import { map, switchMap } from 'rxjs/operators';
import { OrderApprovalDecisionValue, } from '../../../core/model/order-approval.model';
import * as i0 from "@angular/core";
import * as i1 from "../order-approval-detail.service";
import * as i2 from "../../../core/services/order-approval.service";
import * as i3 from "@angular/forms";
import * as i4 from "@spartacus/storefront";
import * as i5 from "@angular/common";
import * as i6 from "@angular/router";
import * as i7 from "@spartacus/core";
export class OrderApprovalDetailFormComponent {
    constructor(orderApprovalDetailService, orderApprovalService, fb) {
        this.orderApprovalDetailService = orderApprovalDetailService;
        this.orderApprovalService = orderApprovalService;
        this.fb = fb;
        this.approvalDecisionValue = OrderApprovalDecisionValue;
        this.approvalFormVisible = false;
        this.approvalForm = this.fb.group({
            comment: [''],
        });
        this.orderApprovalLoading$ = this.orderApprovalDetailService
            .getOrderApprovalCodeFromRoute()
            .pipe(switchMap((approvalCode) => this.orderApprovalService.getOrderApprovalLoading(approvalCode)));
        this.decisionResultLoading$ = this.orderApprovalService.getMakeDecisionResultLoading();
        this.loading$ = combineLatest([
            this.orderApprovalLoading$,
            this.decisionResultLoading$,
        ]).pipe(map(([approvalLoading, decisionResultLoading]) => approvalLoading || decisionResultLoading));
        this.orderApproval$ = this.orderApprovalDetailService.getOrderApproval();
        this.orderApprovalService.resetMakeDecisionProcessState();
    }
    displayDecisionForm(decision) {
        this.approvalDecision = decision;
        if (decision === OrderApprovalDecisionValue.APPROVE) {
            this.approvalForm.controls.comment.clearValidators();
        }
        else {
            this.approvalForm.controls.comment.setValidators([Validators.required]);
        }
        this.approvalFormVisible = true;
    }
    cancelDecisionForm() {
        this.approvalFormVisible = false;
        this.approvalForm.reset();
    }
    submitDecision(orderApproval) {
        if (this.approvalForm.valid) {
            this.orderApprovalService.makeDecision(orderApproval.code, {
                decision: this.approvalDecision,
                comment: this.approvalForm.controls.comment.value,
            });
            this.approvalFormVisible = false;
        }
        else {
            this.approvalForm.markAllAsTouched();
        }
    }
    ngOnDestroy() {
        this.orderApprovalService.resetMakeDecisionProcessState();
    }
}
OrderApprovalDetailFormComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: OrderApprovalDetailFormComponent, deps: [{ token: i1.OrderApprovalDetailService }, { token: i2.OrderApprovalService }, { token: i3.FormBuilder }], target: i0.ɵɵFactoryTarget.Component });
OrderApprovalDetailFormComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.0.5", type: OrderApprovalDetailFormComponent, selector: "cx-order-approval-detail-form", ngImport: i0, template: "<ng-container *ngIf=\"orderApproval$ | async as orderApproval\">\n  <div *ngIf=\"loading$ | async; else approvalFormTemplate\">\n    <div class=\"cx-spinner\">\n      <cx-spinner></cx-spinner>\n    </div>\n  </div>\n\n  <ng-template #approvalFormTemplate>\n    <ng-container *ngIf=\"orderApproval?.approvalDecisionRequired\">\n      <div *ngIf=\"approvalFormVisible\" class=\"cx-approval-form-header row\">\n        <div class=\"cx-approval-form-label col-sm-12\">\n          {{\n            'orderApprovalDetails.form.title_' + approvalDecision\n              | cxTranslate\n                : {\n                    orderCode: orderApproval?.order?.code,\n                    orderTotal:\n                      orderApproval?.order?.totalPriceWithTax?.formattedValue\n                  }\n          }}\n        </div>\n      </div>\n\n      <form\n        [formGroup]=\"approvalForm\"\n        (ngSubmit)=\"submitDecision(orderApproval)\"\n        *ngIf=\"approvalFormVisible\"\n      >\n        <label\n          >{{\n            'orderApprovalDetails.form.comment_' + approvalDecision + '.label'\n              | cxTranslate\n          }}\n          <textarea\n            class=\"form-control\"\n            rows=\"3\"\n            formControlName=\"comment\"\n            maxlength=\"255\"\n          ></textarea>\n          <cx-form-errors\n            [control]=\"approvalForm.get('comment')\"\n          ></cx-form-errors>\n        </label>\n        <div class=\"form-group row\">\n          <div class=\"col-lg-6 col-md-12\">\n            <button\n              class=\"btn btn-block btn-secondary\"\n              (click)=\"cancelDecisionForm()\"\n              type=\"button\"\n            >\n              {{ 'orderApprovalDetails.form.cancel' | cxTranslate }}\n            </button>\n          </div>\n          <div class=\"col-lg-6 col-md-12\">\n            <button class=\"btn btn-block btn-primary\" type=\"submit\">\n              {{\n                'orderApprovalDetails.form.submit_' + approvalDecision\n                  | cxTranslate\n              }}\n            </button>\n          </div>\n        </div>\n      </form>\n    </ng-container>\n    <ng-container *ngIf=\"!approvalFormVisible\">\n      <div class=\"form-group row\">\n        <div class=\"col-lg-4 col-md-12\">\n          <a\n            [routerLink]=\"{ cxRoute: 'orderApprovals' } | cxUrl\"\n            class=\"btn btn-block btn-secondary\"\n            >{{ 'orderApprovalDetails.back' | cxTranslate }}</a\n          >\n        </div>\n        <div\n          class=\"col-lg-4 col-md-12\"\n          *ngIf=\"orderApproval?.approvalDecisionRequired\"\n        >\n          <button\n            class=\"btn btn-block btn-primary\"\n            (click)=\"displayDecisionForm(approvalDecisionValue.REJECT)\"\n          >\n            {{ 'orderApprovalDetails.showForm_REJECT' | cxTranslate }}\n          </button>\n        </div>\n        <div\n          class=\"col-lg-4 col-md-12\"\n          *ngIf=\"orderApproval?.approvalDecisionRequired\"\n        >\n          <button\n            class=\"btn btn-block btn-primary\"\n            (click)=\"displayDecisionForm(approvalDecisionValue.APPROVE)\"\n          >\n            {{ 'orderApprovalDetails.showForm_APPROVE' | cxTranslate }}\n          </button>\n        </div>\n      </div>\n    </ng-container>\n  </ng-template>\n</ng-container>\n", components: [{ type: i4.SpinnerComponent, selector: "cx-spinner" }, { type: i4.FormErrorsComponent, selector: "cx-form-errors", inputs: ["prefix", "translationParams", "control"] }], directives: [{ type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i3.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { type: i3.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { type: i3.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { type: i3.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { type: i3.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { type: i3.FormControlName, selector: "[formControlName]", inputs: ["disabled", "formControlName", "ngModel"], outputs: ["ngModelChange"] }, { type: i3.MaxLengthValidator, selector: "[maxlength][formControlName],[maxlength][formControl],[maxlength][ngModel]", inputs: ["maxlength"] }, { type: i6.RouterLinkWithHref, selector: "a[routerLink],area[routerLink]", inputs: ["routerLink", "target", "queryParams", "fragment", "queryParamsHandling", "preserveFragment", "skipLocationChange", "replaceUrl", "state", "relativeTo"] }], pipes: { "async": i5.AsyncPipe, "cxTranslate": i7.TranslatePipe, "cxUrl": i7.UrlPipe }, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: OrderApprovalDetailFormComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'cx-order-approval-detail-form',
                    templateUrl: './order-approval-detail-form.component.html',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return [{ type: i1.OrderApprovalDetailService }, { type: i2.OrderApprovalService }, { type: i3.FormBuilder }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3JkZXItYXBwcm92YWwtZGV0YWlsLWZvcm0uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL29yZ2FuaXphdGlvbi9vcmRlci1hcHByb3ZhbC9jb21wb25lbnRzL2RldGFpbHMvb3JkZXItYXBwcm92YWwtZGV0YWlsLWZvcm0vb3JkZXItYXBwcm92YWwtZGV0YWlsLWZvcm0uY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL29yZ2FuaXphdGlvbi9vcmRlci1hcHByb3ZhbC9jb21wb25lbnRzL2RldGFpbHMvb3JkZXItYXBwcm92YWwtZGV0YWlsLWZvcm0vb3JkZXItYXBwcm92YWwtZGV0YWlsLWZvcm0uY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLHVCQUF1QixFQUFFLFNBQVMsRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUM5RSxPQUFPLEVBQTBCLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxhQUFhLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFDakQsT0FBTyxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNoRCxPQUFPLEVBRUwsMEJBQTBCLEdBQzNCLE1BQU0sMENBQTBDLENBQUM7Ozs7Ozs7OztBQVNsRCxNQUFNLE9BQU8sZ0NBQWdDO0lBaUMzQyxZQUNZLDBCQUFzRCxFQUN0RCxvQkFBMEMsRUFDNUMsRUFBZTtRQUZiLCtCQUEwQixHQUExQiwwQkFBMEIsQ0FBNEI7UUFDdEQseUJBQW9CLEdBQXBCLG9CQUFvQixDQUFzQjtRQUM1QyxPQUFFLEdBQUYsRUFBRSxDQUFhO1FBbkN6QiwwQkFBcUIsR0FBRywwQkFBMEIsQ0FBQztRQUVuRCx3QkFBbUIsR0FBRyxLQUFLLENBQUM7UUFDNUIsaUJBQVksR0FBYyxJQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQztZQUN0QyxPQUFPLEVBQUUsQ0FBQyxFQUFFLENBQUM7U0FDZCxDQUFDLENBQUM7UUFFTywwQkFBcUIsR0FDN0IsSUFBSSxDQUFDLDBCQUEwQjthQUM1Qiw2QkFBNkIsRUFBRTthQUMvQixJQUFJLENBQ0gsU0FBUyxDQUFDLENBQUMsWUFBb0IsRUFBRSxFQUFFLENBQ2pDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyx1QkFBdUIsQ0FBQyxZQUFZLENBQUMsQ0FDaEUsQ0FDRixDQUFDO1FBRUksMkJBQXNCLEdBQzlCLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyw0QkFBNEIsRUFBRSxDQUFDO1FBRTNELGFBQVEsR0FBRyxhQUFhLENBQUM7WUFDdkIsSUFBSSxDQUFDLHFCQUFxQjtZQUMxQixJQUFJLENBQUMsc0JBQXNCO1NBQzVCLENBQUMsQ0FBQyxJQUFJLENBQ0wsR0FBRyxDQUNELENBQUMsQ0FBQyxlQUFlLEVBQUUscUJBQXFCLENBQUMsRUFBRSxFQUFFLENBQzNDLGVBQWUsSUFBSSxxQkFBcUIsQ0FDM0MsQ0FDRixDQUFDO1FBRUYsbUJBQWMsR0FDWixJQUFJLENBQUMsMEJBQTBCLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQU9uRCxJQUFJLENBQUMsb0JBQW9CLENBQUMsNkJBQTZCLEVBQUUsQ0FBQztJQUM1RCxDQUFDO0lBRUQsbUJBQW1CLENBQUMsUUFBb0M7UUFDdEQsSUFBSSxDQUFDLGdCQUFnQixHQUFHLFFBQVEsQ0FBQztRQUNqQyxJQUFJLFFBQVEsS0FBSywwQkFBMEIsQ0FBQyxPQUFPLEVBQUU7WUFDbkQsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLGVBQWUsRUFBRSxDQUFDO1NBQ3REO2FBQU07WUFDTCxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7U0FDekU7UUFDRCxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDO0lBQ2xDLENBQUM7SUFFRCxrQkFBa0I7UUFDaEIsSUFBSSxDQUFDLG1CQUFtQixHQUFHLEtBQUssQ0FBQztRQUNqQyxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQzVCLENBQUM7SUFFRCxjQUFjLENBQUMsYUFBNEI7UUFDekMsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRTtZQUMzQixJQUFJLENBQUMsb0JBQW9CLENBQUMsWUFBWSxDQUFDLGFBQWEsQ0FBQyxJQUFJLEVBQUU7Z0JBQ3pELFFBQVEsRUFBRSxJQUFJLENBQUMsZ0JBQWdCO2dCQUMvQixPQUFPLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUs7YUFDbEQsQ0FBQyxDQUFDO1lBQ0gsSUFBSSxDQUFDLG1CQUFtQixHQUFHLEtBQUssQ0FBQztTQUNsQzthQUFNO1lBQ0wsSUFBSSxDQUFDLFlBQVksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1NBQ3RDO0lBQ0gsQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFJLENBQUMsb0JBQW9CLENBQUMsNkJBQTZCLEVBQUUsQ0FBQztJQUM1RCxDQUFDOzs2SEF0RVUsZ0NBQWdDO2lIQUFoQyxnQ0FBZ0MscUVDaEI3Qyx5ekdBbUdBOzJGRG5GYSxnQ0FBZ0M7a0JBTDVDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLCtCQUErQjtvQkFDekMsV0FBVyxFQUFFLDZDQUE2QztvQkFDMUQsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07aUJBQ2hEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENvbXBvbmVudCwgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGb3JtQnVpbGRlciwgRm9ybUdyb3VwLCBWYWxpZGF0b3JzIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgY29tYmluZUxhdGVzdCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge1xuICBPcmRlckFwcHJvdmFsLFxuICBPcmRlckFwcHJvdmFsRGVjaXNpb25WYWx1ZSxcbn0gZnJvbSAnLi4vLi4vLi4vY29yZS9tb2RlbC9vcmRlci1hcHByb3ZhbC5tb2RlbCc7XG5pbXBvcnQgeyBPcmRlckFwcHJvdmFsU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL2NvcmUvc2VydmljZXMvb3JkZXItYXBwcm92YWwuc2VydmljZSc7XG5pbXBvcnQgeyBPcmRlckFwcHJvdmFsRGV0YWlsU2VydmljZSB9IGZyb20gJy4uL29yZGVyLWFwcHJvdmFsLWRldGFpbC5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnY3gtb3JkZXItYXBwcm92YWwtZGV0YWlsLWZvcm0nLFxuICB0ZW1wbGF0ZVVybDogJy4vb3JkZXItYXBwcm92YWwtZGV0YWlsLWZvcm0uY29tcG9uZW50Lmh0bWwnLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgT3JkZXJBcHByb3ZhbERldGFpbEZvcm1Db21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuICBhcHByb3ZhbERlY2lzaW9uVmFsdWUgPSBPcmRlckFwcHJvdmFsRGVjaXNpb25WYWx1ZTtcbiAgYXBwcm92YWxEZWNpc2lvbjogT3JkZXJBcHByb3ZhbERlY2lzaW9uVmFsdWU7XG4gIGFwcHJvdmFsRm9ybVZpc2libGUgPSBmYWxzZTtcbiAgYXBwcm92YWxGb3JtOiBGb3JtR3JvdXAgPSB0aGlzLmZiLmdyb3VwKHtcbiAgICBjb21tZW50OiBbJyddLFxuICB9KTtcblxuICBwcm90ZWN0ZWQgb3JkZXJBcHByb3ZhbExvYWRpbmckOiBPYnNlcnZhYmxlPGJvb2xlYW4+ID1cbiAgICB0aGlzLm9yZGVyQXBwcm92YWxEZXRhaWxTZXJ2aWNlXG4gICAgICAuZ2V0T3JkZXJBcHByb3ZhbENvZGVGcm9tUm91dGUoKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcCgoYXBwcm92YWxDb2RlOiBzdHJpbmcpID0+XG4gICAgICAgICAgdGhpcy5vcmRlckFwcHJvdmFsU2VydmljZS5nZXRPcmRlckFwcHJvdmFsTG9hZGluZyhhcHByb3ZhbENvZGUpXG4gICAgICAgIClcbiAgICAgICk7XG5cbiAgcHJvdGVjdGVkIGRlY2lzaW9uUmVzdWx0TG9hZGluZyQgPVxuICAgIHRoaXMub3JkZXJBcHByb3ZhbFNlcnZpY2UuZ2V0TWFrZURlY2lzaW9uUmVzdWx0TG9hZGluZygpO1xuXG4gIGxvYWRpbmckID0gY29tYmluZUxhdGVzdChbXG4gICAgdGhpcy5vcmRlckFwcHJvdmFsTG9hZGluZyQsXG4gICAgdGhpcy5kZWNpc2lvblJlc3VsdExvYWRpbmckLFxuICBdKS5waXBlKFxuICAgIG1hcChcbiAgICAgIChbYXBwcm92YWxMb2FkaW5nLCBkZWNpc2lvblJlc3VsdExvYWRpbmddKSA9PlxuICAgICAgICBhcHByb3ZhbExvYWRpbmcgfHwgZGVjaXNpb25SZXN1bHRMb2FkaW5nXG4gICAgKVxuICApO1xuXG4gIG9yZGVyQXBwcm92YWwkOiBPYnNlcnZhYmxlPE9yZGVyQXBwcm92YWw+ID1cbiAgICB0aGlzLm9yZGVyQXBwcm92YWxEZXRhaWxTZXJ2aWNlLmdldE9yZGVyQXBwcm92YWwoKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgb3JkZXJBcHByb3ZhbERldGFpbFNlcnZpY2U6IE9yZGVyQXBwcm92YWxEZXRhaWxTZXJ2aWNlLFxuICAgIHByb3RlY3RlZCBvcmRlckFwcHJvdmFsU2VydmljZTogT3JkZXJBcHByb3ZhbFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBmYjogRm9ybUJ1aWxkZXJcbiAgKSB7XG4gICAgdGhpcy5vcmRlckFwcHJvdmFsU2VydmljZS5yZXNldE1ha2VEZWNpc2lvblByb2Nlc3NTdGF0ZSgpO1xuICB9XG5cbiAgZGlzcGxheURlY2lzaW9uRm9ybShkZWNpc2lvbjogT3JkZXJBcHByb3ZhbERlY2lzaW9uVmFsdWUpIHtcbiAgICB0aGlzLmFwcHJvdmFsRGVjaXNpb24gPSBkZWNpc2lvbjtcbiAgICBpZiAoZGVjaXNpb24gPT09IE9yZGVyQXBwcm92YWxEZWNpc2lvblZhbHVlLkFQUFJPVkUpIHtcbiAgICAgIHRoaXMuYXBwcm92YWxGb3JtLmNvbnRyb2xzLmNvbW1lbnQuY2xlYXJWYWxpZGF0b3JzKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYXBwcm92YWxGb3JtLmNvbnRyb2xzLmNvbW1lbnQuc2V0VmFsaWRhdG9ycyhbVmFsaWRhdG9ycy5yZXF1aXJlZF0pO1xuICAgIH1cbiAgICB0aGlzLmFwcHJvdmFsRm9ybVZpc2libGUgPSB0cnVlO1xuICB9XG5cbiAgY2FuY2VsRGVjaXNpb25Gb3JtKCkge1xuICAgIHRoaXMuYXBwcm92YWxGb3JtVmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuYXBwcm92YWxGb3JtLnJlc2V0KCk7XG4gIH1cblxuICBzdWJtaXREZWNpc2lvbihvcmRlckFwcHJvdmFsOiBPcmRlckFwcHJvdmFsKSB7XG4gICAgaWYgKHRoaXMuYXBwcm92YWxGb3JtLnZhbGlkKSB7XG4gICAgICB0aGlzLm9yZGVyQXBwcm92YWxTZXJ2aWNlLm1ha2VEZWNpc2lvbihvcmRlckFwcHJvdmFsLmNvZGUsIHtcbiAgICAgICAgZGVjaXNpb246IHRoaXMuYXBwcm92YWxEZWNpc2lvbixcbiAgICAgICAgY29tbWVudDogdGhpcy5hcHByb3ZhbEZvcm0uY29udHJvbHMuY29tbWVudC52YWx1ZSxcbiAgICAgIH0pO1xuICAgICAgdGhpcy5hcHByb3ZhbEZvcm1WaXNpYmxlID0gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYXBwcm92YWxGb3JtLm1hcmtBbGxBc1RvdWNoZWQoKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLm9yZGVyQXBwcm92YWxTZXJ2aWNlLnJlc2V0TWFrZURlY2lzaW9uUHJvY2Vzc1N0YXRlKCk7XG4gIH1cbn1cbiIsIjxuZy1jb250YWluZXIgKm5nSWY9XCJvcmRlckFwcHJvdmFsJCB8IGFzeW5jIGFzIG9yZGVyQXBwcm92YWxcIj5cbiAgPGRpdiAqbmdJZj1cImxvYWRpbmckIHwgYXN5bmM7IGVsc2UgYXBwcm92YWxGb3JtVGVtcGxhdGVcIj5cbiAgICA8ZGl2IGNsYXNzPVwiY3gtc3Bpbm5lclwiPlxuICAgICAgPGN4LXNwaW5uZXI+PC9jeC1zcGlubmVyPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cblxuICA8bmctdGVtcGxhdGUgI2FwcHJvdmFsRm9ybVRlbXBsYXRlPlxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJvcmRlckFwcHJvdmFsPy5hcHByb3ZhbERlY2lzaW9uUmVxdWlyZWRcIj5cbiAgICAgIDxkaXYgKm5nSWY9XCJhcHByb3ZhbEZvcm1WaXNpYmxlXCIgY2xhc3M9XCJjeC1hcHByb3ZhbC1mb3JtLWhlYWRlciByb3dcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImN4LWFwcHJvdmFsLWZvcm0tbGFiZWwgY29sLXNtLTEyXCI+XG4gICAgICAgICAge3tcbiAgICAgICAgICAgICdvcmRlckFwcHJvdmFsRGV0YWlscy5mb3JtLnRpdGxlXycgKyBhcHByb3ZhbERlY2lzaW9uXG4gICAgICAgICAgICAgIHwgY3hUcmFuc2xhdGVcbiAgICAgICAgICAgICAgICA6IHtcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJDb2RlOiBvcmRlckFwcHJvdmFsPy5vcmRlcj8uY29kZSxcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJUb3RhbDpcbiAgICAgICAgICAgICAgICAgICAgICBvcmRlckFwcHJvdmFsPy5vcmRlcj8udG90YWxQcmljZVdpdGhUYXg/LmZvcm1hdHRlZFZhbHVlXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgfX1cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cblxuICAgICAgPGZvcm1cbiAgICAgICAgW2Zvcm1Hcm91cF09XCJhcHByb3ZhbEZvcm1cIlxuICAgICAgICAobmdTdWJtaXQpPVwic3VibWl0RGVjaXNpb24ob3JkZXJBcHByb3ZhbClcIlxuICAgICAgICAqbmdJZj1cImFwcHJvdmFsRm9ybVZpc2libGVcIlxuICAgICAgPlxuICAgICAgICA8bGFiZWxcbiAgICAgICAgICA+e3tcbiAgICAgICAgICAgICdvcmRlckFwcHJvdmFsRGV0YWlscy5mb3JtLmNvbW1lbnRfJyArIGFwcHJvdmFsRGVjaXNpb24gKyAnLmxhYmVsJ1xuICAgICAgICAgICAgICB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgfX1cbiAgICAgICAgICA8dGV4dGFyZWFcbiAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCJcbiAgICAgICAgICAgIHJvd3M9XCIzXCJcbiAgICAgICAgICAgIGZvcm1Db250cm9sTmFtZT1cImNvbW1lbnRcIlxuICAgICAgICAgICAgbWF4bGVuZ3RoPVwiMjU1XCJcbiAgICAgICAgICA+PC90ZXh0YXJlYT5cbiAgICAgICAgICA8Y3gtZm9ybS1lcnJvcnNcbiAgICAgICAgICAgIFtjb250cm9sXT1cImFwcHJvdmFsRm9ybS5nZXQoJ2NvbW1lbnQnKVwiXG4gICAgICAgICAgPjwvY3gtZm9ybS1lcnJvcnM+XG4gICAgICAgIDwvbGFiZWw+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwIHJvd1wiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtbGctNiBjb2wtbWQtMTJcIj5cbiAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAgY2xhc3M9XCJidG4gYnRuLWJsb2NrIGJ0bi1zZWNvbmRhcnlcIlxuICAgICAgICAgICAgICAoY2xpY2spPVwiY2FuY2VsRGVjaXNpb25Gb3JtKClcIlxuICAgICAgICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAge3sgJ29yZGVyQXBwcm92YWxEZXRhaWxzLmZvcm0uY2FuY2VsJyB8IGN4VHJhbnNsYXRlIH19XG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLWxnLTYgY29sLW1kLTEyXCI+XG4gICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi1ibG9jayBidG4tcHJpbWFyeVwiIHR5cGU9XCJzdWJtaXRcIj5cbiAgICAgICAgICAgICAge3tcbiAgICAgICAgICAgICAgICAnb3JkZXJBcHByb3ZhbERldGFpbHMuZm9ybS5zdWJtaXRfJyArIGFwcHJvdmFsRGVjaXNpb25cbiAgICAgICAgICAgICAgICAgIHwgY3hUcmFuc2xhdGVcbiAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZm9ybT5cbiAgICA8L25nLWNvbnRhaW5lcj5cbiAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiIWFwcHJvdmFsRm9ybVZpc2libGVcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwIHJvd1wiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLWxnLTQgY29sLW1kLTEyXCI+XG4gICAgICAgICAgPGFcbiAgICAgICAgICAgIFtyb3V0ZXJMaW5rXT1cInsgY3hSb3V0ZTogJ29yZGVyQXBwcm92YWxzJyB9IHwgY3hVcmxcIlxuICAgICAgICAgICAgY2xhc3M9XCJidG4gYnRuLWJsb2NrIGJ0bi1zZWNvbmRhcnlcIlxuICAgICAgICAgICAgPnt7ICdvcmRlckFwcHJvdmFsRGV0YWlscy5iYWNrJyB8IGN4VHJhbnNsYXRlIH19PC9hXG4gICAgICAgICAgPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdlxuICAgICAgICAgIGNsYXNzPVwiY29sLWxnLTQgY29sLW1kLTEyXCJcbiAgICAgICAgICAqbmdJZj1cIm9yZGVyQXBwcm92YWw/LmFwcHJvdmFsRGVjaXNpb25SZXF1aXJlZFwiXG4gICAgICAgID5cbiAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICBjbGFzcz1cImJ0biBidG4tYmxvY2sgYnRuLXByaW1hcnlcIlxuICAgICAgICAgICAgKGNsaWNrKT1cImRpc3BsYXlEZWNpc2lvbkZvcm0oYXBwcm92YWxEZWNpc2lvblZhbHVlLlJFSkVDVClcIlxuICAgICAgICAgID5cbiAgICAgICAgICAgIHt7ICdvcmRlckFwcHJvdmFsRGV0YWlscy5zaG93Rm9ybV9SRUpFQ1QnIHwgY3hUcmFuc2xhdGUgfX1cbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXZcbiAgICAgICAgICBjbGFzcz1cImNvbC1sZy00IGNvbC1tZC0xMlwiXG4gICAgICAgICAgKm5nSWY9XCJvcmRlckFwcHJvdmFsPy5hcHByb3ZhbERlY2lzaW9uUmVxdWlyZWRcIlxuICAgICAgICA+XG4gICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgY2xhc3M9XCJidG4gYnRuLWJsb2NrIGJ0bi1wcmltYXJ5XCJcbiAgICAgICAgICAgIChjbGljayk9XCJkaXNwbGF5RGVjaXNpb25Gb3JtKGFwcHJvdmFsRGVjaXNpb25WYWx1ZS5BUFBST1ZFKVwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAge3sgJ29yZGVyQXBwcm92YWxEZXRhaWxzLnNob3dGb3JtX0FQUFJPVkUnIHwgY3hUcmFuc2xhdGUgfX1cbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L25nLWNvbnRhaW5lcj5cbiAgPC9uZy10ZW1wbGF0ZT5cbjwvbmctY29udGFpbmVyPlxuIl19