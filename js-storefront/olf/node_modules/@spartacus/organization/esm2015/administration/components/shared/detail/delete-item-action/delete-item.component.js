import { Component, Input } from '@angular/core';
import { LoadStatus } from '@spartacus/organization/administration/core';
import { Subscription } from 'rxjs';
import { filter, first, take } from 'rxjs/operators';
import { ConfirmationMessageComponent } from '../../message/confirmation/confirmation-message.component';
import * as i0 from "@angular/core";
import * as i1 from "../../item.service";
import * as i2 from "../../message/services/message.service";
import * as i3 from "@angular/common";
import * as i4 from "@spartacus/core";
/**
 * Reusable component in the my-company is to delete an item (if it's possible)
 */
export class DeleteItemComponent {
    constructor(itemService, messageService) {
        this.itemService = itemService;
        this.messageService = messageService;
        /**
         * The key input can be used to add a custom key.
         *
         * Most _organization_ entities use the `code` key, but there is some variations.
         */
        this.key = 'code';
        /**
         * resolves the current item.
         */
        this.current$ = this.itemService.current$;
        /**
         * resolves if the user is currently in the edit form.
         */
        this.isInEditMode$ = this.itemService.isInEditMode$;
        this.subscription = new Subscription();
    }
    delete(item) {
        if (!this.confirmation) {
            this.confirmation = this.messageService.add({
                message: {
                    key: this.i18nRoot + '.messages.delete',
                    params: { item },
                },
                messageTitle: {
                    key: this.i18nRoot + '.messages.deleteTitle',
                    params: { item },
                },
                component: ConfirmationMessageComponent,
            });
            this.subscription.add(this.confirmation.pipe(first()).subscribe((event) => {
                if (event.close) {
                    this.confirmation = null;
                }
                if (event.confirm) {
                    this.messageService.close(this.confirmation);
                    this.confirmDelete(item);
                    this.confirmation = null;
                }
            }));
        }
    }
    confirmDelete(item) {
        this.itemService
            .delete(item[this.key], this.additionalParam)
            .pipe(take(1), filter((data) => data.status === LoadStatus.SUCCESS))
            .subscribe((data) => this.notify(Object.assign(Object.assign({}, item), data.item)));
    }
    notify(item) {
        this.messageService.add({
            message: {
                key: `${this.i18nRoot}.messages.deleted`,
                params: { item },
            },
        });
    }
    ngOnDestroy() {
        var _a;
        (_a = this.subscription) === null || _a === void 0 ? void 0 : _a.unsubscribe();
    }
}
DeleteItemComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: DeleteItemComponent, deps: [{ token: i1.ItemService }, { token: i2.MessageService }], target: i0.ɵɵFactoryTarget.Component });
DeleteItemComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.0.5", type: DeleteItemComponent, selector: "cx-org-delete-item", inputs: { i18nRoot: "i18nRoot", key: "key", additionalParam: "additionalParam" }, host: { classAttribute: "content-wrapper" }, ngImport: i0, template: "<button\n  *ngIf=\"current$ | async as item\"\n  class=\"button active\"\n  [disabled]=\"isInEditMode$ | async\"\n  (click)=\"delete(item)\"\n>\n  {{ 'organization.delete' | cxTranslate }}\n</button>\n", directives: [{ type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }], pipes: { "async": i3.AsyncPipe, "cxTranslate": i4.TranslatePipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: DeleteItemComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'cx-org-delete-item',
                    templateUrl: './delete-item.component.html',
                    host: { class: 'content-wrapper' },
                }]
        }], ctorParameters: function () { return [{ type: i1.ItemService }, { type: i2.MessageService }]; }, propDecorators: { i18nRoot: [{
                type: Input
            }], key: [{
                type: Input
            }], additionalParam: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVsZXRlLWl0ZW0uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL29yZ2FuaXphdGlvbi9hZG1pbmlzdHJhdGlvbi9jb21wb25lbnRzL3NoYXJlZC9kZXRhaWwvZGVsZXRlLWl0ZW0tYWN0aW9uL2RlbGV0ZS1pdGVtLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2ZlYXR1cmUtbGlicy9vcmdhbml6YXRpb24vYWRtaW5pc3RyYXRpb24vY29tcG9uZW50cy9zaGFyZWQvZGV0YWlsL2RlbGV0ZS1pdGVtLWFjdGlvbi9kZWxldGUtaXRlbS5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUM1RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sNkNBQTZDLENBQUM7QUFDekUsT0FBTyxFQUF1QixZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDekQsT0FBTyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFckQsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sMkRBQTJELENBQUM7Ozs7OztBQUt6Rzs7R0FFRztBQU1ILE1BQU0sT0FBTyxtQkFBbUI7SUFtQzlCLFlBQ1ksV0FBMkIsRUFDM0IsY0FBdUQ7UUFEdkQsZ0JBQVcsR0FBWCxXQUFXLENBQWdCO1FBQzNCLG1CQUFjLEdBQWQsY0FBYyxDQUF5QztRQTVCbkU7Ozs7V0FJRztRQUNNLFFBQUcsR0FBRyxNQUFNLENBQUM7UUFRdEI7O1dBRUc7UUFDSCxhQUFRLEdBQWtCLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDO1FBRXBEOztXQUVHO1FBQ0gsa0JBQWEsR0FBd0IsSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUM7UUFFMUQsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0lBTXpDLENBQUM7SUFFSixNQUFNLENBQUMsSUFBTztRQUNaLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ3RCLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUM7Z0JBQzFDLE9BQU8sRUFBRTtvQkFDUCxHQUFHLEVBQUUsSUFBSSxDQUFDLFFBQVEsR0FBRyxrQkFBa0I7b0JBQ3ZDLE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRTtpQkFDakI7Z0JBQ0QsWUFBWSxFQUFFO29CQUNaLEdBQUcsRUFBRSxJQUFJLENBQUMsUUFBUSxHQUFHLHVCQUF1QjtvQkFDNUMsTUFBTSxFQUFFLEVBQUUsSUFBSSxFQUFFO2lCQUNqQjtnQkFDRCxTQUFTLEVBQUUsNEJBQTRCO2FBQ3hDLENBQUMsQ0FBQztZQUVILElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUNuQixJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO2dCQUNsRCxJQUFJLEtBQUssQ0FBQyxLQUFLLEVBQUU7b0JBQ2YsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7aUJBQzFCO2dCQUNELElBQUksS0FBSyxDQUFDLE9BQU8sRUFBRTtvQkFDakIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO29CQUM3QyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO29CQUN6QixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQztpQkFDMUI7WUFDSCxDQUFDLENBQUMsQ0FDSCxDQUFDO1NBQ0g7SUFDSCxDQUFDO0lBRVMsYUFBYSxDQUFDLElBQU87UUFDN0IsSUFBSSxDQUFDLFdBQVc7YUFDYixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsZUFBZSxDQUFDO2FBQzVDLElBQUksQ0FDSCxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQ1AsTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxLQUFLLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FDckQ7YUFDQSxTQUFTLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLGlDQUFNLElBQUksR0FBSyxJQUFJLENBQUMsSUFBSSxFQUFHLENBQUMsQ0FBQztJQUNqRSxDQUFDO0lBRVMsTUFBTSxDQUFDLElBQU87UUFDdEIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUM7WUFDdEIsT0FBTyxFQUFFO2dCQUNQLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxRQUFRLG1CQUFtQjtnQkFDeEMsTUFBTSxFQUFFLEVBQUUsSUFBSSxFQUFFO2FBQ2pCO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELFdBQVc7O1FBQ1QsTUFBQSxJQUFJLENBQUMsWUFBWSwwQ0FBRSxXQUFXLEVBQUUsQ0FBQztJQUNuQyxDQUFDOztnSEExRlUsbUJBQW1CO29HQUFuQixtQkFBbUIseUxDbEJoQywyTUFRQTsyRkRVYSxtQkFBbUI7a0JBTC9CLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLG9CQUFvQjtvQkFDOUIsV0FBVyxFQUFFLDhCQUE4QjtvQkFDM0MsSUFBSSxFQUFFLEVBQUUsS0FBSyxFQUFFLGlCQUFpQixFQUFFO2lCQUNuQzsrSEFRVSxRQUFRO3NCQUFoQixLQUFLO2dCQU9HLEdBQUc7c0JBQVgsS0FBSztnQkFNRyxlQUFlO3NCQUF2QixLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBMb2FkU3RhdHVzIH0gZnJvbSAnQHNwYXJ0YWN1cy9vcmdhbml6YXRpb24vYWRtaW5pc3RyYXRpb24vY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGZpbHRlciwgZmlyc3QsIHRha2UgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBJdGVtU2VydmljZSB9IGZyb20gJy4uLy4uL2l0ZW0uc2VydmljZSc7XG5pbXBvcnQgeyBDb25maXJtYXRpb25NZXNzYWdlQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vbWVzc2FnZS9jb25maXJtYXRpb24vY29uZmlybWF0aW9uLW1lc3NhZ2UuY29tcG9uZW50JztcbmltcG9ydCB7IENvbmZpcm1hdGlvbk1lc3NhZ2VEYXRhIH0gZnJvbSAnLi4vLi4vbWVzc2FnZS9jb25maXJtYXRpb24vY29uZmlybWF0aW9uLW1lc3NhZ2UubW9kZWwnO1xuaW1wb3J0IHsgTWVzc2FnZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9tZXNzYWdlL3NlcnZpY2VzL21lc3NhZ2Uuc2VydmljZSc7XG5pbXBvcnQgeyBCYXNlSXRlbSB9IGZyb20gJy4uLy4uL29yZ2FuaXphdGlvbi5tb2RlbCc7XG5cbi8qKlxuICogUmV1c2FibGUgY29tcG9uZW50IGluIHRoZSBteS1jb21wYW55IGlzIHRvIGRlbGV0ZSBhbiBpdGVtIChpZiBpdCdzIHBvc3NpYmxlKVxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjeC1vcmctZGVsZXRlLWl0ZW0nLFxuICB0ZW1wbGF0ZVVybDogJy4vZGVsZXRlLWl0ZW0uY29tcG9uZW50Lmh0bWwnLFxuICBob3N0OiB7IGNsYXNzOiAnY29udGVudC13cmFwcGVyJyB9LFxufSlcbmV4cG9ydCBjbGFzcyBEZWxldGVJdGVtQ29tcG9uZW50PFQgZXh0ZW5kcyBCYXNlSXRlbT4gaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuICAvKipcbiAgICogVGhlIGxvY2FsaXphdGlvbiBvZiBtZXNzYWdlcyBpcyBiYXNlZCBvbiB0aGUgaTE4biByb290LiBNZXNzYWdlcyBhcmVcbiAgICogY29uY2F0ZW5hdGVkIHRvIHRoZSByb290LCBzdWNoIGFzOlxuICAgKlxuICAgKiBgW2kxOG5Sb290XS5tZXNzYWdlcy5kZWFjdGl2YXRlYFxuICAgKi9cbiAgQElucHV0KCkgaTE4blJvb3Q6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGtleSBpbnB1dCBjYW4gYmUgdXNlZCB0byBhZGQgYSBjdXN0b20ga2V5LlxuICAgKlxuICAgKiBNb3N0IF9vcmdhbml6YXRpb25fIGVudGl0aWVzIHVzZSB0aGUgYGNvZGVgIGtleSwgYnV0IHRoZXJlIGlzIHNvbWUgdmFyaWF0aW9ucy5cbiAgICovXG4gIEBJbnB1dCgpIGtleSA9ICdjb2RlJztcblxuICAvKipcbiAgICogVGhlIGFkZGl0aW9uYWxQYXJhbSBpbnB1dCBjYW4gYmUgdXNlZCB0byBwcm92aWRlIGFkZGl0aW9uYWwgZGF0YSBpZiBpdCdzIHJlcXVpcmVkXG4gICAqIGZvciBBUEkgcmVxdWVzdFxuICAgKi9cbiAgQElucHV0KCkgYWRkaXRpb25hbFBhcmFtPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiByZXNvbHZlcyB0aGUgY3VycmVudCBpdGVtLlxuICAgKi9cbiAgY3VycmVudCQ6IE9ic2VydmFibGU8VD4gPSB0aGlzLml0ZW1TZXJ2aWNlLmN1cnJlbnQkO1xuXG4gIC8qKlxuICAgKiByZXNvbHZlcyBpZiB0aGUgdXNlciBpcyBjdXJyZW50bHkgaW4gdGhlIGVkaXQgZm9ybS5cbiAgICovXG4gIGlzSW5FZGl0TW9kZSQ6IE9ic2VydmFibGU8Ym9vbGVhbj4gPSB0aGlzLml0ZW1TZXJ2aWNlLmlzSW5FZGl0TW9kZSQ7XG5cbiAgcHJvdGVjdGVkIHN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24oKTtcbiAgcHJvdGVjdGVkIGNvbmZpcm1hdGlvbjogU3ViamVjdDxDb25maXJtYXRpb25NZXNzYWdlRGF0YT47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIGl0ZW1TZXJ2aWNlOiBJdGVtU2VydmljZTxUPixcbiAgICBwcm90ZWN0ZWQgbWVzc2FnZVNlcnZpY2U6IE1lc3NhZ2VTZXJ2aWNlPENvbmZpcm1hdGlvbk1lc3NhZ2VEYXRhPlxuICApIHt9XG5cbiAgZGVsZXRlKGl0ZW06IFQpIHtcbiAgICBpZiAoIXRoaXMuY29uZmlybWF0aW9uKSB7XG4gICAgICB0aGlzLmNvbmZpcm1hdGlvbiA9IHRoaXMubWVzc2FnZVNlcnZpY2UuYWRkKHtcbiAgICAgICAgbWVzc2FnZToge1xuICAgICAgICAgIGtleTogdGhpcy5pMThuUm9vdCArICcubWVzc2FnZXMuZGVsZXRlJyxcbiAgICAgICAgICBwYXJhbXM6IHsgaXRlbSB9LFxuICAgICAgICB9LFxuICAgICAgICBtZXNzYWdlVGl0bGU6IHtcbiAgICAgICAgICBrZXk6IHRoaXMuaTE4blJvb3QgKyAnLm1lc3NhZ2VzLmRlbGV0ZVRpdGxlJyxcbiAgICAgICAgICBwYXJhbXM6IHsgaXRlbSB9LFxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnQ6IENvbmZpcm1hdGlvbk1lc3NhZ2VDb21wb25lbnQsXG4gICAgICB9KTtcblxuICAgICAgdGhpcy5zdWJzY3JpcHRpb24uYWRkKFxuICAgICAgICB0aGlzLmNvbmZpcm1hdGlvbi5waXBlKGZpcnN0KCkpLnN1YnNjcmliZSgoZXZlbnQpID0+IHtcbiAgICAgICAgICBpZiAoZXZlbnQuY2xvc2UpIHtcbiAgICAgICAgICAgIHRoaXMuY29uZmlybWF0aW9uID0gbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGV2ZW50LmNvbmZpcm0pIHtcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZVNlcnZpY2UuY2xvc2UodGhpcy5jb25maXJtYXRpb24pO1xuICAgICAgICAgICAgdGhpcy5jb25maXJtRGVsZXRlKGl0ZW0pO1xuICAgICAgICAgICAgdGhpcy5jb25maXJtYXRpb24gPSBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIGNvbmZpcm1EZWxldGUoaXRlbTogVCk6IHZvaWQge1xuICAgIHRoaXMuaXRlbVNlcnZpY2VcbiAgICAgIC5kZWxldGUoaXRlbVt0aGlzLmtleV0sIHRoaXMuYWRkaXRpb25hbFBhcmFtKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRha2UoMSksXG4gICAgICAgIGZpbHRlcigoZGF0YSkgPT4gZGF0YS5zdGF0dXMgPT09IExvYWRTdGF0dXMuU1VDQ0VTUylcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoKGRhdGEpID0+IHRoaXMubm90aWZ5KHsgLi4uaXRlbSwgLi4uZGF0YS5pdGVtIH0pKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBub3RpZnkoaXRlbTogVCkge1xuICAgIHRoaXMubWVzc2FnZVNlcnZpY2UuYWRkKHtcbiAgICAgIG1lc3NhZ2U6IHtcbiAgICAgICAga2V5OiBgJHt0aGlzLmkxOG5Sb290fS5tZXNzYWdlcy5kZWxldGVkYCxcbiAgICAgICAgcGFyYW1zOiB7IGl0ZW0gfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbj8udW5zdWJzY3JpYmUoKTtcbiAgfVxufVxuIiwiPGJ1dHRvblxuICAqbmdJZj1cImN1cnJlbnQkIHwgYXN5bmMgYXMgaXRlbVwiXG4gIGNsYXNzPVwiYnV0dG9uIGFjdGl2ZVwiXG4gIFtkaXNhYmxlZF09XCJpc0luRWRpdE1vZGUkIHwgYXN5bmNcIlxuICAoY2xpY2spPVwiZGVsZXRlKGl0ZW0pXCJcbj5cbiAge3sgJ29yZ2FuaXphdGlvbi5kZWxldGUnIHwgY3hUcmFuc2xhdGUgfX1cbjwvYnV0dG9uPlxuIl19