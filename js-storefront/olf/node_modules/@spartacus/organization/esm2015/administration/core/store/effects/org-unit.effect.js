import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { Effect, ofType } from '@ngrx/effects';
import { normalizeHttpError, StateUtils, } from '@spartacus/core';
import { from, of } from 'rxjs';
import { catchError, groupBy, map, mergeMap, switchMap } from 'rxjs/operators';
import { B2BUserActions, OrganizationActions, OrgUnitActions, } from '../actions/index';
import * as i0 from "@angular/core";
import * as i1 from "@ngrx/effects";
import * as i2 from "../../connectors/org-unit/org-unit.connector";
export class OrgUnitEffects {
    // @Effect()
    // loadAddress$: Observable<
    //   | OrgUnitActions.LoadAddressSuccess
    //   | OrgUnitActions.LoadAddressesSuccess
    //   | OrgUnitActions.LoadAddressesFail
    // > = this.actions$.pipe(
    //   ofType(OrgUnitActions.LOAD_ADDRESSES),
    //   map((action: OrgUnitActions.LoadAddresses) => action.payload),
    //   switchMap(({ userId, orgUnitId }) => {
    //     return this.orgUnitConnector.getAddresses(userId, orgUnitId).pipe(
    //       switchMap((addresses: EntitiesModel<B2BAddress>) => {
    //         const { values, page } = StateUtils.normalizeListPage(addresses, 'id');
    //         return [
    //           new OrgUnitActions.LoadAddressSuccess(values),
    //           new OrgUnitActions.LoadAddressesSuccess({ page, orgUnitId }),
    //         ];
    //       }),
    //       catchError(error =>
    //         of(
    //           new OrgUnitActions.LoadAddressesFail({
    //             orgUnitId,
    //             error: normalizeHttpError(error),
    //           })
    //         )
    //       )
    //     );
    //   })
    // );
    constructor(actions$, orgUnitConnector) {
        this.actions$ = actions$;
        this.orgUnitConnector = orgUnitConnector;
        this.loadOrgUnit$ = this.actions$.pipe(ofType(OrgUnitActions.LOAD_ORG_UNIT), map((action) => action.payload), switchMap(({ userId, orgUnitId }) => {
            return this.orgUnitConnector.get(userId, orgUnitId).pipe(switchMap((orgUnit) => {
                const { values, page } = StateUtils.normalizeListPage({ values: orgUnit.addresses }, 'id');
                return [
                    new OrgUnitActions.LoadOrgUnitSuccess([orgUnit]),
                    new OrgUnitActions.LoadAddressSuccess(values),
                    new OrgUnitActions.LoadAddressesSuccess({ page, orgUnitId }),
                ];
            }), catchError((error) => of(new OrgUnitActions.LoadOrgUnitFail({
                orgUnitId,
                error: normalizeHttpError(error),
            }))));
        }));
        this.loadAvailableOrgUnits$ = this.actions$.pipe(ofType(OrgUnitActions.LOAD_UNIT_NODES), map((action) => action.payload), switchMap((payload) => this.orgUnitConnector.getList(payload.userId).pipe(map((orgUnitsList) => new OrgUnitActions.LoadOrgUnitNodesSuccess(orgUnitsList)), catchError((error) => of(new OrgUnitActions.LoadOrgUnitNodesFail({
            error: normalizeHttpError(error),
        }))))));
        this.createUnit$ = this.actions$.pipe(ofType(OrgUnitActions.CREATE_ORG_UNIT), map((action) => action.payload), switchMap((payload) => this.orgUnitConnector.create(payload.userId, payload.unit).pipe(switchMap((data) => [
            new OrgUnitActions.CreateUnitSuccess(data),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new OrgUnitActions.CreateUnitFail({
                unitCode: payload.unit.uid,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.updateUnit$ = this.actions$.pipe(ofType(OrgUnitActions.UPDATE_ORG_UNIT), map((action) => action.payload), switchMap((payload) => this.orgUnitConnector
            .update(payload.userId, payload.unitCode, payload.unit)
            .pipe(switchMap((_data) => [
            // Workaround for empty response
            new OrgUnitActions.UpdateUnitSuccess(payload.unit),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new OrgUnitActions.UpdateUnitFail({
                unitCode: payload.unit.uid,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.loadTree$ = this.actions$.pipe(ofType(OrgUnitActions.LOAD_UNIT_TREE), map((action) => action.payload), switchMap(({ userId }) => {
            return this.orgUnitConnector.getTree(userId).pipe(map((orgUnit) => new OrgUnitActions.LoadTreeSuccess(orgUnit)), catchError((error) => of(new OrgUnitActions.LoadTreeFail({
                error: normalizeHttpError(error),
            }))));
        }));
        this.loadApprovalProcesses$ = this.actions$.pipe(ofType(OrgUnitActions.LOAD_APPROVAL_PROCESSES), map((action) => action.payload), switchMap(({ userId }) => {
            return this.orgUnitConnector.getApprovalProcesses(userId).pipe(map((approvalProcesses) => new OrgUnitActions.LoadApprovalProcessesSuccess(approvalProcesses)), catchError((error) => of(new OrgUnitActions.LoadApprovalProcessesFail({
                error: normalizeHttpError(error),
            }))));
        }));
        this.loadUsers$ = this.actions$.pipe(ofType(OrgUnitActions.LOAD_ASSIGNED_USERS), map((action) => action.payload), groupBy(({ orgUnitId, roleId, params }) => StateUtils.serializeParams([orgUnitId, roleId], params)), mergeMap((group) => group.pipe(switchMap(({ userId, orgUnitId, roleId, params }) => {
            return this.orgUnitConnector
                .getUsers(userId, orgUnitId, roleId, params)
                .pipe(switchMap((users) => {
                const { values, page } = StateUtils.normalizeListPage(users, 'customerId');
                return [
                    new B2BUserActions.LoadB2BUserSuccess(values),
                    new OrgUnitActions.LoadAssignedUsersSuccess({
                        orgUnitId,
                        roleId,
                        page,
                        params,
                    }),
                ];
            }), catchError((error) => of(new OrgUnitActions.LoadAssignedUsersFail({
                orgUnitId,
                roleId,
                params,
                error: normalizeHttpError(error),
            }))));
        }))));
        this.assignRoleToUser = this.actions$.pipe(ofType(OrgUnitActions.ASSIGN_ROLE), map((action) => action.payload), switchMap(({ userId, orgCustomerId, roleId }) => this.orgUnitConnector.assignRole(userId, orgCustomerId, roleId).pipe(map(() => new OrgUnitActions.AssignRoleSuccess({
            uid: orgCustomerId,
            roleId,
            selected: true,
        })), catchError((error) => of(new OrgUnitActions.AssignRoleFail({
            orgCustomerId,
            error: normalizeHttpError(error),
        }))))));
        this.unassignRoleToUser$ = this.actions$.pipe(ofType(OrgUnitActions.UNASSIGN_ROLE), map((action) => action.payload), switchMap(({ userId, orgCustomerId, roleId }) => this.orgUnitConnector.unassignRole(userId, orgCustomerId, roleId).pipe(map(() => new OrgUnitActions.UnassignRoleSuccess({
            uid: orgCustomerId,
            roleId,
            selected: false,
        })), catchError((error) => of(new OrgUnitActions.UnassignRoleFail({
            orgCustomerId,
            error: normalizeHttpError(error),
        }))))));
        this.assignApprover = this.actions$.pipe(ofType(OrgUnitActions.ASSIGN_APPROVER), map((action) => action.payload), mergeMap(({ userId, orgUnitId, orgCustomerId, roleId }) => this.orgUnitConnector
            .assignApprover(userId, orgUnitId, orgCustomerId, roleId)
            .pipe(switchMap(() => [
            new OrgUnitActions.AssignApproverSuccess({
                uid: orgCustomerId,
                roleId,
                selected: true,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new OrgUnitActions.AssignApproverFail({
                orgCustomerId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.unassignApprover = this.actions$.pipe(ofType(OrgUnitActions.UNASSIGN_APPROVER), map((action) => action.payload), mergeMap(({ userId, orgUnitId, orgCustomerId, roleId }) => this.orgUnitConnector
            .unassignApprover(userId, orgUnitId, orgCustomerId, roleId)
            .pipe(switchMap(() => [
            new OrgUnitActions.UnassignApproverSuccess({
                uid: orgCustomerId,
                roleId,
                selected: false,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new OrgUnitActions.UnassignApproverFail({
                orgCustomerId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.createAddress$ = this.actions$.pipe(ofType(OrgUnitActions.CREATE_ADDRESS), map((action) => action.payload), switchMap((payload) => this.orgUnitConnector
            .createAddress(payload.userId, payload.orgUnitId, payload.address)
            .pipe(switchMap((data) => [
            new OrgUnitActions.CreateAddressSuccess(data),
            new OrgUnitActions.CreateAddressSuccess({ id: null }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new OrgUnitActions.CreateAddressFail({
                addressId: payload.address.id,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.updateAddress$ = this.actions$.pipe(ofType(OrgUnitActions.UPDATE_ADDRESS), map((action) => action.payload), switchMap(({ userId, orgUnitId, addressId, address }) => this.orgUnitConnector
            .updateAddress(userId, orgUnitId, addressId, address)
            .pipe(switchMap(() => [
            // commented out due to no response from backend on PATCH request
            // new OrgUnitActions.UpdateAddressSuccess(data),
            new OrgUnitActions.UpdateAddressSuccess(address),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new OrgUnitActions.UpdateAddressFail({
                addressId: address.id,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.deleteAddress$ = this.actions$.pipe(ofType(OrgUnitActions.DELETE_ADDRESS), map((action) => action.payload), switchMap((payload) => this.orgUnitConnector
            .deleteAddress(payload.userId, payload.orgUnitId, payload.addressId)
            .pipe(switchMap(() => [
            new OrgUnitActions.DeleteAddressSuccess({ id: payload.addressId }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new OrgUnitActions.DeleteAddressFail({
                addressId: payload.addressId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
    }
}
OrgUnitEffects.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: OrgUnitEffects, deps: [{ token: i1.Actions }, { token: i2.OrgUnitConnector }], target: i0.ɵɵFactoryTarget.Injectable });
OrgUnitEffects.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: OrgUnitEffects });
__decorate([
    Effect()
], OrgUnitEffects.prototype, "loadOrgUnit$", void 0);
__decorate([
    Effect()
], OrgUnitEffects.prototype, "loadAvailableOrgUnits$", void 0);
__decorate([
    Effect()
], OrgUnitEffects.prototype, "createUnit$", void 0);
__decorate([
    Effect()
], OrgUnitEffects.prototype, "updateUnit$", void 0);
__decorate([
    Effect()
], OrgUnitEffects.prototype, "loadTree$", void 0);
__decorate([
    Effect()
], OrgUnitEffects.prototype, "loadApprovalProcesses$", void 0);
__decorate([
    Effect()
], OrgUnitEffects.prototype, "loadUsers$", void 0);
__decorate([
    Effect()
], OrgUnitEffects.prototype, "assignRoleToUser", void 0);
__decorate([
    Effect()
], OrgUnitEffects.prototype, "unassignRoleToUser$", void 0);
__decorate([
    Effect()
], OrgUnitEffects.prototype, "assignApprover", void 0);
__decorate([
    Effect()
], OrgUnitEffects.prototype, "unassignApprover", void 0);
__decorate([
    Effect()
], OrgUnitEffects.prototype, "createAddress$", void 0);
__decorate([
    Effect()
], OrgUnitEffects.prototype, "updateAddress$", void 0);
__decorate([
    Effect()
], OrgUnitEffects.prototype, "deleteAddress$", void 0);
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: OrgUnitEffects, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.Actions }, { type: i2.OrgUnitConnector }]; }, propDecorators: { loadOrgUnit$: [], loadAvailableOrgUnits$: [], createUnit$: [], updateUnit$: [], loadTree$: [], loadApprovalProcesses$: [], loadUsers$: [], assignRoleToUser: [], unassignRoleToUser$: [], assignApprover: [], unassignApprover: [], createAddress$: [], updateAddress$: [], deleteAddress$: [] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3JnLXVuaXQuZWZmZWN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL29yZ2FuaXphdGlvbi9hZG1pbmlzdHJhdGlvbi9jb3JlL3N0b3JlL2VmZmVjdHMvb3JnLXVuaXQuZWZmZWN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBVyxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hELE9BQU8sRUFLTCxrQkFBa0IsRUFDbEIsVUFBVSxHQUNYLE1BQU0saUJBQWlCLENBQUM7QUFDekIsT0FBTyxFQUFFLElBQUksRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDNUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUcvRSxPQUFPLEVBQ0wsY0FBYyxFQUNkLG1CQUFtQixFQUNuQixjQUFjLEdBQ2YsTUFBTSxrQkFBa0IsQ0FBQzs7OztBQUcxQixNQUFNLE9BQU8sY0FBYztJQXFhekIsWUFBWTtJQUNaLDRCQUE0QjtJQUM1Qix3Q0FBd0M7SUFDeEMsMENBQTBDO0lBQzFDLHVDQUF1QztJQUN2QywwQkFBMEI7SUFDMUIsMkNBQTJDO0lBQzNDLG1FQUFtRTtJQUNuRSwyQ0FBMkM7SUFDM0MseUVBQXlFO0lBQ3pFLDhEQUE4RDtJQUM5RCxrRkFBa0Y7SUFDbEYsbUJBQW1CO0lBQ25CLDJEQUEyRDtJQUMzRCwwRUFBMEU7SUFDMUUsYUFBYTtJQUNiLFlBQVk7SUFDWiw0QkFBNEI7SUFDNUIsY0FBYztJQUNkLG1EQUFtRDtJQUNuRCx5QkFBeUI7SUFDekIsZ0RBQWdEO0lBQ2hELGVBQWU7SUFDZixZQUFZO0lBQ1osVUFBVTtJQUNWLFNBQVM7SUFDVCxPQUFPO0lBQ1AsS0FB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NEJoQixtQkFBbUIsTUE0Qm5CLGNBQWMsTUFpQ2QsZ0JBQWdCLE1BaUNoQixjQUFjLE1BOEJkLGNBQWMsTUErQmQsY0FBYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBFcnJvclJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWN0aW9ucywgRWZmZWN0LCBvZlR5cGUgfSBmcm9tICdAbmdyeC9lZmZlY3RzJztcbmltcG9ydCB7XG4gIEIyQkFwcHJvdmFsUHJvY2VzcyxcbiAgQjJCVW5pdCxcbiAgQjJCVXNlcixcbiAgRW50aXRpZXNNb2RlbCxcbiAgbm9ybWFsaXplSHR0cEVycm9yLFxuICBTdGF0ZVV0aWxzLFxufSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHsgZnJvbSwgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGNhdGNoRXJyb3IsIGdyb3VwQnksIG1hcCwgbWVyZ2VNYXAsIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE9yZ1VuaXRDb25uZWN0b3IgfSBmcm9tICcuLi8uLi9jb25uZWN0b3JzL29yZy11bml0L29yZy11bml0LmNvbm5lY3Rvcic7XG5pbXBvcnQgeyBCMkJVbml0Tm9kZSB9IGZyb20gJy4uLy4uL21vZGVsL3VuaXQtbm9kZS5tb2RlbCc7XG5pbXBvcnQge1xuICBCMkJVc2VyQWN0aW9ucyxcbiAgT3JnYW5pemF0aW9uQWN0aW9ucyxcbiAgT3JnVW5pdEFjdGlvbnMsXG59IGZyb20gJy4uL2FjdGlvbnMvaW5kZXgnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgT3JnVW5pdEVmZmVjdHMge1xuICBARWZmZWN0KClcbiAgbG9hZE9yZ1VuaXQkOiBPYnNlcnZhYmxlPFxuICAgIHwgT3JnVW5pdEFjdGlvbnMuTG9hZE9yZ1VuaXRTdWNjZXNzXG4gICAgfCBPcmdVbml0QWN0aW9ucy5Mb2FkQWRkcmVzc1N1Y2Nlc3NcbiAgICB8IE9yZ1VuaXRBY3Rpb25zLkxvYWRBZGRyZXNzZXNTdWNjZXNzXG4gICAgfCBPcmdVbml0QWN0aW9ucy5Mb2FkT3JnVW5pdEZhaWxcbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICBvZlR5cGUoT3JnVW5pdEFjdGlvbnMuTE9BRF9PUkdfVU5JVCksXG4gICAgbWFwKChhY3Rpb246IE9yZ1VuaXRBY3Rpb25zLkxvYWRPcmdVbml0KSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgc3dpdGNoTWFwKCh7IHVzZXJJZCwgb3JnVW5pdElkIH0pID0+IHtcbiAgICAgIHJldHVybiB0aGlzLm9yZ1VuaXRDb25uZWN0b3IuZ2V0KHVzZXJJZCwgb3JnVW5pdElkKS5waXBlKFxuICAgICAgICBzd2l0Y2hNYXAoKG9yZ1VuaXQ6IEIyQlVuaXQpID0+IHtcbiAgICAgICAgICBjb25zdCB7IHZhbHVlcywgcGFnZSB9ID0gU3RhdGVVdGlscy5ub3JtYWxpemVMaXN0UGFnZShcbiAgICAgICAgICAgIHsgdmFsdWVzOiBvcmdVbml0LmFkZHJlc3NlcyB9LFxuICAgICAgICAgICAgJ2lkJ1xuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Mb2FkT3JnVW5pdFN1Y2Nlc3MoW29yZ1VuaXRdKSxcbiAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Mb2FkQWRkcmVzc1N1Y2Nlc3ModmFsdWVzKSxcbiAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Mb2FkQWRkcmVzc2VzU3VjY2Vzcyh7IHBhZ2UsIG9yZ1VuaXRJZCB9KSxcbiAgICAgICAgICBdO1xuICAgICAgICB9KSxcbiAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgIG9mKFxuICAgICAgICAgICAgbmV3IE9yZ1VuaXRBY3Rpb25zLkxvYWRPcmdVbml0RmFpbCh7XG4gICAgICAgICAgICAgIG9yZ1VuaXRJZCxcbiAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9KVxuICApO1xuXG4gIEBFZmZlY3QoKVxuICBsb2FkQXZhaWxhYmxlT3JnVW5pdHMkOiBPYnNlcnZhYmxlPFxuICAgIE9yZ1VuaXRBY3Rpb25zLkxvYWRPcmdVbml0Tm9kZXNTdWNjZXNzIHwgT3JnVW5pdEFjdGlvbnMuTG9hZE9yZ1VuaXROb2Rlc0ZhaWxcbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICBvZlR5cGUoT3JnVW5pdEFjdGlvbnMuTE9BRF9VTklUX05PREVTKSxcbiAgICBtYXAoKGFjdGlvbjogT3JnVW5pdEFjdGlvbnMuTG9hZE9yZ1VuaXROb2RlcykgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgIHN3aXRjaE1hcCgocGF5bG9hZCkgPT5cbiAgICAgIHRoaXMub3JnVW5pdENvbm5lY3Rvci5nZXRMaXN0KHBheWxvYWQudXNlcklkKS5waXBlKFxuICAgICAgICBtYXAoXG4gICAgICAgICAgKG9yZ1VuaXRzTGlzdDogQjJCVW5pdE5vZGVbXSkgPT5cbiAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Mb2FkT3JnVW5pdE5vZGVzU3VjY2VzcyhvcmdVbml0c0xpc3QpXG4gICAgICAgICksXG4gICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICBvZihcbiAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Mb2FkT3JnVW5pdE5vZGVzRmFpbCh7XG4gICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgQEVmZmVjdCgpXG4gIGNyZWF0ZVVuaXQkOiBPYnNlcnZhYmxlPFxuICAgIHwgT3JnVW5pdEFjdGlvbnMuQ3JlYXRlVW5pdEZhaWxcbiAgICB8IE9yZ1VuaXRBY3Rpb25zLkNyZWF0ZVVuaXRTdWNjZXNzXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShPcmdVbml0QWN0aW9ucy5DUkVBVEVfT1JHX1VOSVQpLFxuICAgIG1hcCgoYWN0aW9uOiBPcmdVbml0QWN0aW9ucy5DcmVhdGVVbml0KSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgc3dpdGNoTWFwKChwYXlsb2FkKSA9PlxuICAgICAgdGhpcy5vcmdVbml0Q29ubmVjdG9yLmNyZWF0ZShwYXlsb2FkLnVzZXJJZCwgcGF5bG9hZC51bml0KS5waXBlKFxuICAgICAgICBzd2l0Y2hNYXAoKGRhdGEpID0+IFtcbiAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuQ3JlYXRlVW5pdFN1Y2Nlc3MoZGF0YSksXG4gICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgIF0pLFxuICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuQ3JlYXRlVW5pdEZhaWwoe1xuICAgICAgICAgICAgICB1bml0Q29kZTogcGF5bG9hZC51bml0LnVpZCxcbiAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgIF0pXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgQEVmZmVjdCgpXG4gIHVwZGF0ZVVuaXQkOiBPYnNlcnZhYmxlPFxuICAgIHwgT3JnVW5pdEFjdGlvbnMuVXBkYXRlVW5pdFN1Y2Nlc3NcbiAgICB8IE9yZ1VuaXRBY3Rpb25zLlVwZGF0ZVVuaXRGYWlsXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShPcmdVbml0QWN0aW9ucy5VUERBVEVfT1JHX1VOSVQpLFxuICAgIG1hcCgoYWN0aW9uOiBPcmdVbml0QWN0aW9ucy5VcGRhdGVVbml0KSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgc3dpdGNoTWFwKChwYXlsb2FkKSA9PlxuICAgICAgdGhpcy5vcmdVbml0Q29ubmVjdG9yXG4gICAgICAgIC51cGRhdGUocGF5bG9hZC51c2VySWQsIHBheWxvYWQudW5pdENvZGUsIHBheWxvYWQudW5pdClcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgc3dpdGNoTWFwKChfZGF0YSkgPT4gW1xuICAgICAgICAgICAgLy8gV29ya2Fyb3VuZCBmb3IgZW1wdHkgcmVzcG9uc2VcbiAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5VcGRhdGVVbml0U3VjY2VzcyhwYXlsb2FkLnVuaXQpLFxuICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgXSksXG4gICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5VcGRhdGVVbml0RmFpbCh7XG4gICAgICAgICAgICAgICAgdW5pdENvZGU6IHBheWxvYWQudW5pdC51aWQsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgKVxuICApO1xuXG4gIEBFZmZlY3QoKVxuICBsb2FkVHJlZSQ6IE9ic2VydmFibGU8XG4gICAgT3JnVW5pdEFjdGlvbnMuTG9hZFRyZWVTdWNjZXNzIHwgT3JnVW5pdEFjdGlvbnMuTG9hZFRyZWVGYWlsXG4gID4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgb2ZUeXBlKE9yZ1VuaXRBY3Rpb25zLkxPQURfVU5JVF9UUkVFKSxcbiAgICBtYXAoKGFjdGlvbjogT3JnVW5pdEFjdGlvbnMuTG9hZE9yZ1VuaXQpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICBzd2l0Y2hNYXAoKHsgdXNlcklkIH0pID0+IHtcbiAgICAgIHJldHVybiB0aGlzLm9yZ1VuaXRDb25uZWN0b3IuZ2V0VHJlZSh1c2VySWQpLnBpcGUoXG4gICAgICAgIG1hcChcbiAgICAgICAgICAob3JnVW5pdDogQjJCVW5pdE5vZGUpID0+IG5ldyBPcmdVbml0QWN0aW9ucy5Mb2FkVHJlZVN1Y2Nlc3Mob3JnVW5pdClcbiAgICAgICAgKSxcbiAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgIG9mKFxuICAgICAgICAgICAgbmV3IE9yZ1VuaXRBY3Rpb25zLkxvYWRUcmVlRmFpbCh7XG4gICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfSlcbiAgKTtcblxuICBARWZmZWN0KClcbiAgbG9hZEFwcHJvdmFsUHJvY2Vzc2VzJDogT2JzZXJ2YWJsZTxcbiAgICB8IE9yZ1VuaXRBY3Rpb25zLkxvYWRBcHByb3ZhbFByb2Nlc3Nlc1N1Y2Nlc3NcbiAgICB8IE9yZ1VuaXRBY3Rpb25zLkxvYWRBcHByb3ZhbFByb2Nlc3Nlc0ZhaWxcbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICBvZlR5cGUoT3JnVW5pdEFjdGlvbnMuTE9BRF9BUFBST1ZBTF9QUk9DRVNTRVMpLFxuICAgIG1hcCgoYWN0aW9uOiBPcmdVbml0QWN0aW9ucy5Mb2FkT3JnVW5pdCkgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgIHN3aXRjaE1hcCgoeyB1c2VySWQgfSkgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMub3JnVW5pdENvbm5lY3Rvci5nZXRBcHByb3ZhbFByb2Nlc3Nlcyh1c2VySWQpLnBpcGUoXG4gICAgICAgIG1hcChcbiAgICAgICAgICAoYXBwcm92YWxQcm9jZXNzZXM6IEIyQkFwcHJvdmFsUHJvY2Vzc1tdKSA9PlxuICAgICAgICAgICAgbmV3IE9yZ1VuaXRBY3Rpb25zLkxvYWRBcHByb3ZhbFByb2Nlc3Nlc1N1Y2Nlc3MoYXBwcm92YWxQcm9jZXNzZXMpXG4gICAgICAgICksXG4gICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICBvZihcbiAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Mb2FkQXBwcm92YWxQcm9jZXNzZXNGYWlsKHtcbiAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9KVxuICApO1xuXG4gIEBFZmZlY3QoKVxuICBsb2FkVXNlcnMkOiBPYnNlcnZhYmxlPFxuICAgIHwgT3JnVW5pdEFjdGlvbnMuTG9hZEFzc2lnbmVkVXNlcnNTdWNjZXNzXG4gICAgfCBPcmdVbml0QWN0aW9ucy5Mb2FkQXNzaWduZWRVc2Vyc0ZhaWxcbiAgICB8IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyU3VjY2Vzc1xuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShPcmdVbml0QWN0aW9ucy5MT0FEX0FTU0lHTkVEX1VTRVJTKSxcbiAgICBtYXAoKGFjdGlvbjogT3JnVW5pdEFjdGlvbnMuTG9hZEFzc2lnbmVkVXNlcnMpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICBncm91cEJ5KCh7IG9yZ1VuaXRJZCwgcm9sZUlkLCBwYXJhbXMgfSkgPT5cbiAgICAgIFN0YXRlVXRpbHMuc2VyaWFsaXplUGFyYW1zKFtvcmdVbml0SWQsIHJvbGVJZF0sIHBhcmFtcylcbiAgICApLFxuICAgIG1lcmdlTWFwKChncm91cCkgPT5cbiAgICAgIGdyb3VwLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcCgoeyB1c2VySWQsIG9yZ1VuaXRJZCwgcm9sZUlkLCBwYXJhbXMgfSkgPT4ge1xuICAgICAgICAgIHJldHVybiB0aGlzLm9yZ1VuaXRDb25uZWN0b3JcbiAgICAgICAgICAgIC5nZXRVc2Vycyh1c2VySWQsIG9yZ1VuaXRJZCwgcm9sZUlkLCBwYXJhbXMpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgc3dpdGNoTWFwKCh1c2VyczogRW50aXRpZXNNb2RlbDxCMkJVc2VyPikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgdmFsdWVzLCBwYWdlIH0gPSBTdGF0ZVV0aWxzLm5vcm1hbGl6ZUxpc3RQYWdlKFxuICAgICAgICAgICAgICAgICAgdXNlcnMsXG4gICAgICAgICAgICAgICAgICAnY3VzdG9tZXJJZCdcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJTdWNjZXNzKHZhbHVlcyksXG4gICAgICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuTG9hZEFzc2lnbmVkVXNlcnNTdWNjZXNzKHtcbiAgICAgICAgICAgICAgICAgICAgb3JnVW5pdElkLFxuICAgICAgICAgICAgICAgICAgICByb2xlSWQsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2UsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcyxcbiAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICAgICAgb2YoXG4gICAgICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuTG9hZEFzc2lnbmVkVXNlcnNGYWlsKHtcbiAgICAgICAgICAgICAgICAgICAgb3JnVW5pdElkLFxuICAgICAgICAgICAgICAgICAgICByb2xlSWQsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcyxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSlcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgQEVmZmVjdCgpXG4gIGFzc2lnblJvbGVUb1VzZXI6IE9ic2VydmFibGU8XG4gICAgT3JnVW5pdEFjdGlvbnMuQXNzaWduUm9sZVN1Y2Nlc3MgfCBPcmdVbml0QWN0aW9ucy5Bc3NpZ25Sb2xlRmFpbFxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShPcmdVbml0QWN0aW9ucy5BU1NJR05fUk9MRSksXG4gICAgbWFwKChhY3Rpb246IE9yZ1VuaXRBY3Rpb25zLkFzc2lnblJvbGUpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICBzd2l0Y2hNYXAoKHsgdXNlcklkLCBvcmdDdXN0b21lcklkLCByb2xlSWQgfSkgPT5cbiAgICAgIHRoaXMub3JnVW5pdENvbm5lY3Rvci5hc3NpZ25Sb2xlKHVzZXJJZCwgb3JnQ3VzdG9tZXJJZCwgcm9sZUlkKS5waXBlKFxuICAgICAgICBtYXAoXG4gICAgICAgICAgKCkgPT5cbiAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Bc3NpZ25Sb2xlU3VjY2Vzcyh7XG4gICAgICAgICAgICAgIHVpZDogb3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgcm9sZUlkLFxuICAgICAgICAgICAgICBzZWxlY3RlZDogdHJ1ZSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICksXG4gICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICBvZihcbiAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Bc3NpZ25Sb2xlRmFpbCh7XG4gICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgQEVmZmVjdCgpXG4gIHVuYXNzaWduUm9sZVRvVXNlciQ6IE9ic2VydmFibGU8XG4gICAgT3JnVW5pdEFjdGlvbnMuVW5hc3NpZ25Sb2xlU3VjY2VzcyB8IE9yZ1VuaXRBY3Rpb25zLlVuYXNzaWduUm9sZUZhaWxcbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICBvZlR5cGUoT3JnVW5pdEFjdGlvbnMuVU5BU1NJR05fUk9MRSksXG4gICAgbWFwKChhY3Rpb246IE9yZ1VuaXRBY3Rpb25zLlVuYXNzaWduUm9sZSkgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgIHN3aXRjaE1hcCgoeyB1c2VySWQsIG9yZ0N1c3RvbWVySWQsIHJvbGVJZCB9KSA9PlxuICAgICAgdGhpcy5vcmdVbml0Q29ubmVjdG9yLnVuYXNzaWduUm9sZSh1c2VySWQsIG9yZ0N1c3RvbWVySWQsIHJvbGVJZCkucGlwZShcbiAgICAgICAgbWFwKFxuICAgICAgICAgICgpID0+XG4gICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuVW5hc3NpZ25Sb2xlU3VjY2Vzcyh7XG4gICAgICAgICAgICAgIHVpZDogb3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgcm9sZUlkLFxuICAgICAgICAgICAgICBzZWxlY3RlZDogZmFsc2UsXG4gICAgICAgICAgICB9KVxuICAgICAgICApLFxuICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgb2YoXG4gICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuVW5hc3NpZ25Sb2xlRmFpbCh7XG4gICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgQEVmZmVjdCgpXG4gIGFzc2lnbkFwcHJvdmVyOiBPYnNlcnZhYmxlPFxuICAgIHwgT3JnVW5pdEFjdGlvbnMuQXNzaWduQXBwcm92ZXJTdWNjZXNzXG4gICAgfCBPcmdVbml0QWN0aW9ucy5Bc3NpZ25BcHByb3ZlckZhaWxcbiAgICB8IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhXG4gID4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgb2ZUeXBlKE9yZ1VuaXRBY3Rpb25zLkFTU0lHTl9BUFBST1ZFUiksXG4gICAgbWFwKChhY3Rpb246IE9yZ1VuaXRBY3Rpb25zLkFzc2lnbkFwcHJvdmVyKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgbWVyZ2VNYXAoKHsgdXNlcklkLCBvcmdVbml0SWQsIG9yZ0N1c3RvbWVySWQsIHJvbGVJZCB9KSA9PlxuICAgICAgdGhpcy5vcmdVbml0Q29ubmVjdG9yXG4gICAgICAgIC5hc3NpZ25BcHByb3Zlcih1c2VySWQsIG9yZ1VuaXRJZCwgb3JnQ3VzdG9tZXJJZCwgcm9sZUlkKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKCkgPT4gW1xuICAgICAgICAgICAgbmV3IE9yZ1VuaXRBY3Rpb25zLkFzc2lnbkFwcHJvdmVyU3VjY2Vzcyh7XG4gICAgICAgICAgICAgIHVpZDogb3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgcm9sZUlkLFxuICAgICAgICAgICAgICBzZWxlY3RlZDogdHJ1ZSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgXSksXG4gICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Bc3NpZ25BcHByb3ZlckZhaWwoe1xuICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgKVxuICApO1xuXG4gIEBFZmZlY3QoKVxuICB1bmFzc2lnbkFwcHJvdmVyOiBPYnNlcnZhYmxlPFxuICAgIHwgT3JnVW5pdEFjdGlvbnMuVW5hc3NpZ25BcHByb3ZlclN1Y2Nlc3NcbiAgICB8IE9yZ1VuaXRBY3Rpb25zLlVuYXNzaWduQXBwcm92ZXJGYWlsXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShPcmdVbml0QWN0aW9ucy5VTkFTU0lHTl9BUFBST1ZFUiksXG4gICAgbWFwKChhY3Rpb246IE9yZ1VuaXRBY3Rpb25zLlVuYXNzaWduQXBwcm92ZXIpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICBtZXJnZU1hcCgoeyB1c2VySWQsIG9yZ1VuaXRJZCwgb3JnQ3VzdG9tZXJJZCwgcm9sZUlkIH0pID0+XG4gICAgICB0aGlzLm9yZ1VuaXRDb25uZWN0b3JcbiAgICAgICAgLnVuYXNzaWduQXBwcm92ZXIodXNlcklkLCBvcmdVbml0SWQsIG9yZ0N1c3RvbWVySWQsIHJvbGVJZClcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgc3dpdGNoTWFwKCgpID0+IFtcbiAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5VbmFzc2lnbkFwcHJvdmVyU3VjY2Vzcyh7XG4gICAgICAgICAgICAgIHVpZDogb3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgcm9sZUlkLFxuICAgICAgICAgICAgICBzZWxlY3RlZDogZmFsc2UsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgIF0pLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuVW5hc3NpZ25BcHByb3ZlckZhaWwoe1xuICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgKVxuICApO1xuXG4gIEBFZmZlY3QoKVxuICBjcmVhdGVBZGRyZXNzJDogT2JzZXJ2YWJsZTxcbiAgICB8IE9yZ1VuaXRBY3Rpb25zLkNyZWF0ZUFkZHJlc3NTdWNjZXNzXG4gICAgfCBPcmdVbml0QWN0aW9ucy5DcmVhdGVBZGRyZXNzRmFpbFxuICAgIHwgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGFcbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICBvZlR5cGUoT3JnVW5pdEFjdGlvbnMuQ1JFQVRFX0FERFJFU1MpLFxuICAgIG1hcCgoYWN0aW9uOiBPcmdVbml0QWN0aW9ucy5DcmVhdGVBZGRyZXNzKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgc3dpdGNoTWFwKChwYXlsb2FkKSA9PlxuICAgICAgdGhpcy5vcmdVbml0Q29ubmVjdG9yXG4gICAgICAgIC5jcmVhdGVBZGRyZXNzKHBheWxvYWQudXNlcklkLCBwYXlsb2FkLm9yZ1VuaXRJZCwgcGF5bG9hZC5hZGRyZXNzKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKGRhdGEpID0+IFtcbiAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5DcmVhdGVBZGRyZXNzU3VjY2VzcyhkYXRhKSxcbiAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5DcmVhdGVBZGRyZXNzU3VjY2Vzcyh7IGlkOiBudWxsIH0pLFxuICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgXSksXG4gICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5DcmVhdGVBZGRyZXNzRmFpbCh7XG4gICAgICAgICAgICAgICAgYWRkcmVzc0lkOiBwYXlsb2FkLmFkZHJlc3MuaWQsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgKVxuICApO1xuXG4gIEBFZmZlY3QoKVxuICB1cGRhdGVBZGRyZXNzJDogT2JzZXJ2YWJsZTxcbiAgICB8IE9yZ1VuaXRBY3Rpb25zLlVwZGF0ZUFkZHJlc3NTdWNjZXNzXG4gICAgfCBPcmdVbml0QWN0aW9ucy5VcGRhdGVBZGRyZXNzRmFpbFxuICAgIHwgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGFcbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICBvZlR5cGUoT3JnVW5pdEFjdGlvbnMuVVBEQVRFX0FERFJFU1MpLFxuICAgIG1hcCgoYWN0aW9uOiBPcmdVbml0QWN0aW9ucy5VcGRhdGVBZGRyZXNzKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgc3dpdGNoTWFwKCh7IHVzZXJJZCwgb3JnVW5pdElkLCBhZGRyZXNzSWQsIGFkZHJlc3MgfSkgPT5cbiAgICAgIHRoaXMub3JnVW5pdENvbm5lY3RvclxuICAgICAgICAudXBkYXRlQWRkcmVzcyh1c2VySWQsIG9yZ1VuaXRJZCwgYWRkcmVzc0lkLCBhZGRyZXNzKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKCkgPT4gW1xuICAgICAgICAgICAgLy8gY29tbWVudGVkIG91dCBkdWUgdG8gbm8gcmVzcG9uc2UgZnJvbSBiYWNrZW5kIG9uIFBBVENIIHJlcXVlc3RcbiAgICAgICAgICAgIC8vIG5ldyBPcmdVbml0QWN0aW9ucy5VcGRhdGVBZGRyZXNzU3VjY2VzcyhkYXRhKSxcbiAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5VcGRhdGVBZGRyZXNzU3VjY2VzcyhhZGRyZXNzKSxcbiAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgIF0pLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuVXBkYXRlQWRkcmVzc0ZhaWwoe1xuICAgICAgICAgICAgICAgIGFkZHJlc3NJZDogYWRkcmVzcy5pZCxcbiAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgXSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICApXG4gICk7XG5cbiAgQEVmZmVjdCgpXG4gIGRlbGV0ZUFkZHJlc3MkOiBPYnNlcnZhYmxlPFxuICAgIHwgT3JnVW5pdEFjdGlvbnMuRGVsZXRlQWRkcmVzc1N1Y2Nlc3NcbiAgICB8IE9yZ1VuaXRBY3Rpb25zLkRlbGV0ZUFkZHJlc3NGYWlsXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShPcmdVbml0QWN0aW9ucy5ERUxFVEVfQUREUkVTUyksXG4gICAgbWFwKChhY3Rpb246IE9yZ1VuaXRBY3Rpb25zLkRlbGV0ZUFkZHJlc3MpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICBzd2l0Y2hNYXAoKHBheWxvYWQpID0+XG4gICAgICB0aGlzLm9yZ1VuaXRDb25uZWN0b3JcbiAgICAgICAgLmRlbGV0ZUFkZHJlc3MocGF5bG9hZC51c2VySWQsIHBheWxvYWQub3JnVW5pdElkLCBwYXlsb2FkLmFkZHJlc3NJZClcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgc3dpdGNoTWFwKCgpID0+IFtcbiAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5EZWxldGVBZGRyZXNzU3VjY2Vzcyh7IGlkOiBwYXlsb2FkLmFkZHJlc3NJZCB9KSxcbiAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgIF0pLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuRGVsZXRlQWRkcmVzc0ZhaWwoe1xuICAgICAgICAgICAgICAgIGFkZHJlc3NJZDogcGF5bG9hZC5hZGRyZXNzSWQsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgKVxuICApO1xuXG4gIC8vIEBFZmZlY3QoKVxuICAvLyBsb2FkQWRkcmVzcyQ6IE9ic2VydmFibGU8XG4gIC8vICAgfCBPcmdVbml0QWN0aW9ucy5Mb2FkQWRkcmVzc1N1Y2Nlc3NcbiAgLy8gICB8IE9yZ1VuaXRBY3Rpb25zLkxvYWRBZGRyZXNzZXNTdWNjZXNzXG4gIC8vICAgfCBPcmdVbml0QWN0aW9ucy5Mb2FkQWRkcmVzc2VzRmFpbFxuICAvLyA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAvLyAgIG9mVHlwZShPcmdVbml0QWN0aW9ucy5MT0FEX0FERFJFU1NFUyksXG4gIC8vICAgbWFwKChhY3Rpb246IE9yZ1VuaXRBY3Rpb25zLkxvYWRBZGRyZXNzZXMpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgLy8gICBzd2l0Y2hNYXAoKHsgdXNlcklkLCBvcmdVbml0SWQgfSkgPT4ge1xuICAvLyAgICAgcmV0dXJuIHRoaXMub3JnVW5pdENvbm5lY3Rvci5nZXRBZGRyZXNzZXModXNlcklkLCBvcmdVbml0SWQpLnBpcGUoXG4gIC8vICAgICAgIHN3aXRjaE1hcCgoYWRkcmVzc2VzOiBFbnRpdGllc01vZGVsPEIyQkFkZHJlc3M+KSA9PiB7XG4gIC8vICAgICAgICAgY29uc3QgeyB2YWx1ZXMsIHBhZ2UgfSA9IFN0YXRlVXRpbHMubm9ybWFsaXplTGlzdFBhZ2UoYWRkcmVzc2VzLCAnaWQnKTtcbiAgLy8gICAgICAgICByZXR1cm4gW1xuICAvLyAgICAgICAgICAgbmV3IE9yZ1VuaXRBY3Rpb25zLkxvYWRBZGRyZXNzU3VjY2Vzcyh2YWx1ZXMpLFxuICAvLyAgICAgICAgICAgbmV3IE9yZ1VuaXRBY3Rpb25zLkxvYWRBZGRyZXNzZXNTdWNjZXNzKHsgcGFnZSwgb3JnVW5pdElkIH0pLFxuICAvLyAgICAgICAgIF07XG4gIC8vICAgICAgIH0pLFxuICAvLyAgICAgICBjYXRjaEVycm9yKGVycm9yID0+XG4gIC8vICAgICAgICAgb2YoXG4gIC8vICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuTG9hZEFkZHJlc3Nlc0ZhaWwoe1xuICAvLyAgICAgICAgICAgICBvcmdVbml0SWQsXG4gIC8vICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAvLyAgICAgICAgICAgfSlcbiAgLy8gICAgICAgICApXG4gIC8vICAgICAgIClcbiAgLy8gICAgICk7XG4gIC8vICAgfSlcbiAgLy8gKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGFjdGlvbnMkOiBBY3Rpb25zLFxuICAgIHByaXZhdGUgb3JnVW5pdENvbm5lY3RvcjogT3JnVW5pdENvbm5lY3RvclxuICApIHt9XG59XG4iXX0=