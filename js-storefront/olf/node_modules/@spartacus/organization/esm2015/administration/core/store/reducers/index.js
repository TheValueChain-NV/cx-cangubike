import { InjectionToken } from '@angular/core';
import { combineReducers, } from '@ngrx/store';
import { AuthActions, SiteContextActions, StateUtils, } from '@spartacus/core';
import { OrganizationActions } from '../actions';
import { ADDRESS_ENTITIES, ADDRESS_LIST, B2B_USER_APPROVERS, B2B_USER_ENTITIES, B2B_USER_FEATURE, B2B_USER_PERMISSIONS, B2B_USER_USER_GROUPS, BUDGET_ENTITIES, BUDGET_FEATURE, BUDGET_LIST, COST_CENTER_ASSIGNED_BUDGETS, COST_CENTER_ENTITIES, COST_CENTER_FEATURE, COST_CENTER_LIST, ORG_UNIT_APPROVAL_PROCESSES_ENTITIES, ORG_UNIT_ASSIGNED_USERS, ORG_UNIT_ENTITIES, ORG_UNIT_FEATURE, ORG_UNIT_NODE_LIST, ORG_UNIT_TREE_ENTITY, PERMISSION_ENTITIES, PERMISSION_FEATURE, PERMISSION_LIST, PERMISSION_TYPES_LIST, USER_GROUP_AVAILABLE_CUSTOMERS, USER_GROUP_ENTITIES, USER_GROUP_FEATURE, USER_GROUP_LIST, USER_GROUP_PERMISSIONS, USER_LIST, } from '../organization-state';
import { b2bUserApproverListReducer, b2bUserEntitiesReducer, b2bUserPermissionListReducer, b2bUserUserGroupListReducer, userListReducer, } from './b2b-user.reducer';
import { budgetsEntitiesReducer, budgetsListReducer } from './budget.reducer';
import { costCenterAssignedBudgetsListReducer, costCentersEntitiesReducer, costCentersListReducer, } from './cost-center.reducer';
import { orgUnitAddressListReducer, orgUnitEntitiesReducer, orgUnitUserListReducer, } from './org-unit.reducer';
import { permissionsEntitiesReducer, permissionsListReducer, } from './permission.reducer';
import { userGroupAvailableOrderApprovalPermissionsListReducer, userGroupAvailablOrgCustomersListReducer, userGroupEntitiesReducer, userGroupsListReducer, } from './user-group.reducer';
export function getReducers() {
    return {
        [BUDGET_FEATURE]: combineReducers({
            entities: StateUtils.entityLoaderReducer(BUDGET_ENTITIES, budgetsEntitiesReducer),
            list: StateUtils.entityLoaderReducer(BUDGET_LIST, budgetsListReducer),
        }),
        [PERMISSION_FEATURE]: combineReducers({
            entities: StateUtils.entityLoaderReducer(PERMISSION_ENTITIES, permissionsEntitiesReducer),
            list: StateUtils.entityLoaderReducer(PERMISSION_LIST, permissionsListReducer),
            permissionTypes: StateUtils.entityLoaderReducer(PERMISSION_TYPES_LIST),
        }),
        [ORG_UNIT_FEATURE]: combineReducers({
            entities: StateUtils.entityLoaderReducer(ORG_UNIT_ENTITIES, orgUnitEntitiesReducer),
            availableOrgUnitNodes: StateUtils.entityLoaderReducer(ORG_UNIT_NODE_LIST),
            tree: StateUtils.entityLoaderReducer(ORG_UNIT_TREE_ENTITY),
            approvalProcesses: StateUtils.entityLoaderReducer(ORG_UNIT_APPROVAL_PROCESSES_ENTITIES),
            users: StateUtils.entityLoaderReducer(ORG_UNIT_ASSIGNED_USERS, orgUnitUserListReducer),
            addressList: StateUtils.entityLoaderReducer(ADDRESS_LIST, orgUnitAddressListReducer),
            addressEntities: StateUtils.entityLoaderReducer(ADDRESS_ENTITIES),
        }),
        [USER_GROUP_FEATURE]: combineReducers({
            entities: StateUtils.entityLoaderReducer(USER_GROUP_ENTITIES, userGroupEntitiesReducer),
            list: StateUtils.entityLoaderReducer(USER_GROUP_LIST, userGroupsListReducer),
            permissions: StateUtils.entityLoaderReducer(USER_GROUP_PERMISSIONS, userGroupAvailableOrderApprovalPermissionsListReducer),
            customers: StateUtils.entityLoaderReducer(USER_GROUP_AVAILABLE_CUSTOMERS, userGroupAvailablOrgCustomersListReducer),
        }),
        [COST_CENTER_FEATURE]: combineReducers({
            entities: StateUtils.entityLoaderReducer(COST_CENTER_ENTITIES, costCentersEntitiesReducer),
            list: StateUtils.entityLoaderReducer(COST_CENTER_LIST, costCentersListReducer),
            budgets: StateUtils.entityLoaderReducer(COST_CENTER_ASSIGNED_BUDGETS, costCenterAssignedBudgetsListReducer),
        }),
        [B2B_USER_FEATURE]: combineReducers({
            entities: StateUtils.entityLoaderReducer(B2B_USER_ENTITIES, b2bUserEntitiesReducer),
            list: StateUtils.entityLoaderReducer(USER_LIST, userListReducer),
            approvers: StateUtils.entityLoaderReducer(B2B_USER_APPROVERS, b2bUserApproverListReducer),
            permissions: StateUtils.entityLoaderReducer(B2B_USER_PERMISSIONS, b2bUserPermissionListReducer),
            userGroups: StateUtils.entityLoaderReducer(B2B_USER_USER_GROUPS, b2bUserUserGroupListReducer),
        }),
    };
}
export const reducerToken = new InjectionToken('OrganizationReducers');
export const reducerProvider = {
    provide: reducerToken,
    useFactory: getReducers,
};
export function clearOrganizationState(reducer) {
    return function (state, action) {
        if (action.type === OrganizationActions.CLEAR_ORGANIZATION_DATA) {
            state = undefined;
        }
        if (action.type === AuthActions.LOGOUT) {
            state = undefined;
        }
        if (action.type === SiteContextActions.LANGUAGE_CHANGE) {
            state = undefined;
        }
        return reducer(state, action);
    };
}
export const metaReducers = [clearOrganizationState];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvb3JnYW5pemF0aW9uL2FkbWluaXN0cmF0aW9uL2NvcmUvc3RvcmUvcmVkdWNlcnMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGNBQWMsRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBSUwsZUFBZSxHQUVoQixNQUFNLGFBQWEsQ0FBQztBQUNyQixPQUFPLEVBRUwsV0FBVyxFQU9YLGtCQUFrQixFQUNsQixVQUFVLEdBQ1gsTUFBTSxpQkFBaUIsQ0FBQztBQUt6QixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDakQsT0FBTyxFQUNMLGdCQUFnQixFQUNoQixZQUFZLEVBQ1osa0JBQWtCLEVBQ2xCLGlCQUFpQixFQUNqQixnQkFBZ0IsRUFDaEIsb0JBQW9CLEVBQ3BCLG9CQUFvQixFQUNwQixlQUFlLEVBQ2YsY0FBYyxFQUNkLFdBQVcsRUFDWCw0QkFBNEIsRUFDNUIsb0JBQW9CLEVBQ3BCLG1CQUFtQixFQUNuQixnQkFBZ0IsRUFFaEIsb0NBQW9DLEVBQ3BDLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsZ0JBQWdCLEVBQ2hCLGtCQUFrQixFQUNsQixvQkFBb0IsRUFDcEIsbUJBQW1CLEVBQ25CLGtCQUFrQixFQUNsQixlQUFlLEVBQ2YscUJBQXFCLEVBQ3JCLDhCQUE4QixFQUM5QixtQkFBbUIsRUFDbkIsa0JBQWtCLEVBQ2xCLGVBQWUsRUFDZixzQkFBc0IsRUFDdEIsU0FBUyxHQUNWLE1BQU0sdUJBQXVCLENBQUM7QUFDL0IsT0FBTyxFQUNMLDBCQUEwQixFQUMxQixzQkFBc0IsRUFDdEIsNEJBQTRCLEVBQzVCLDJCQUEyQixFQUMzQixlQUFlLEdBQ2hCLE1BQU0sb0JBQW9CLENBQUM7QUFDNUIsT0FBTyxFQUFFLHNCQUFzQixFQUFFLGtCQUFrQixF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Q29udGVudCI6WyJpbXBvcnQgeyBJbmplY3Rpb25Ub2tlbiwgUHJvdmlkZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIEFjdGlvbixcbiAgQWN0aW9uUmVkdWNlcixcbiAgQWN0aW9uUmVkdWNlck1hcCxcbiAgY29tYmluZVJlZHVjZXJzLFxuICBNZXRhUmVkdWNlcixcbn0gZnJvbSAnQG5ncngvc3RvcmUnO1xuaW1wb3J0IHtcbiAgQWRkcmVzcyxcbiAgQXV0aEFjdGlvbnMsXG4gIEIyQkFwcHJvdmFsUHJvY2VzcyxcbiAgQjJCVW5pdCxcbiAgQjJCVXNlcixcbiAgQ29zdENlbnRlcixcbiAgTGlzdE1vZGVsLFxuICBPcmRlckFwcHJvdmFsUGVybWlzc2lvblR5cGUsXG4gIFNpdGVDb250ZXh0QWN0aW9ucyxcbiAgU3RhdGVVdGlscyxcbn0gZnJvbSAnQHNwYXJ0YWN1cy9jb3JlJztcbmltcG9ydCB7IEJ1ZGdldCB9IGZyb20gJy4uLy4uL21vZGVsL2J1ZGdldC5tb2RlbCc7XG5pbXBvcnQgeyBQZXJtaXNzaW9uIH0gZnJvbSAnLi4vLi4vbW9kZWwvcGVybWlzc2lvbi5tb2RlbCc7XG5pbXBvcnQgeyBCMkJVbml0Tm9kZSB9IGZyb20gJy4uLy4uL21vZGVsL3VuaXQtbm9kZS5tb2RlbCc7XG5pbXBvcnQgeyBVc2VyR3JvdXAgfSBmcm9tICcuLi8uLi9tb2RlbC91c2VyLWdyb3VwLm1vZGVsJztcbmltcG9ydCB7IE9yZ2FuaXphdGlvbkFjdGlvbnMgfSBmcm9tICcuLi9hY3Rpb25zJztcbmltcG9ydCB7XG4gIEFERFJFU1NfRU5USVRJRVMsXG4gIEFERFJFU1NfTElTVCxcbiAgQjJCX1VTRVJfQVBQUk9WRVJTLFxuICBCMkJfVVNFUl9FTlRJVElFUyxcbiAgQjJCX1VTRVJfRkVBVFVSRSxcbiAgQjJCX1VTRVJfUEVSTUlTU0lPTlMsXG4gIEIyQl9VU0VSX1VTRVJfR1JPVVBTLFxuICBCVURHRVRfRU5USVRJRVMsXG4gIEJVREdFVF9GRUFUVVJFLFxuICBCVURHRVRfTElTVCxcbiAgQ09TVF9DRU5URVJfQVNTSUdORURfQlVER0VUUyxcbiAgQ09TVF9DRU5URVJfRU5USVRJRVMsXG4gIENPU1RfQ0VOVEVSX0ZFQVRVUkUsXG4gIENPU1RfQ0VOVEVSX0xJU1QsXG4gIE9yZ2FuaXphdGlvblN0YXRlLFxuICBPUkdfVU5JVF9BUFBST1ZBTF9QUk9DRVNTRVNfRU5USVRJRVMsXG4gIE9SR19VTklUX0FTU0lHTkVEX1VTRVJTLFxuICBPUkdfVU5JVF9FTlRJVElFUyxcbiAgT1JHX1VOSVRfRkVBVFVSRSxcbiAgT1JHX1VOSVRfTk9ERV9MSVNULFxuICBPUkdfVU5JVF9UUkVFX0VOVElUWSxcbiAgUEVSTUlTU0lPTl9FTlRJVElFUyxcbiAgUEVSTUlTU0lPTl9GRUFUVVJFLFxuICBQRVJNSVNTSU9OX0xJU1QsXG4gIFBFUk1JU1NJT05fVFlQRVNfTElTVCxcbiAgVVNFUl9HUk9VUF9BVkFJTEFCTEVfQ1VTVE9NRVJTLFxuICBVU0VSX0dST1VQX0VOVElUSUVTLFxuICBVU0VSX0dST1VQX0ZFQVRVUkUsXG4gIFVTRVJfR1JPVVBfTElTVCxcbiAgVVNFUl9HUk9VUF9QRVJNSVNTSU9OUyxcbiAgVVNFUl9MSVNULFxufSBmcm9tICcuLi9vcmdhbml6YXRpb24tc3RhdGUnO1xuaW1wb3J0IHtcbiAgYjJiVXNlckFwcHJvdmVyTGlzdFJlZHVjZXIsXG4gIGIyYlVzZXJFbnRpdGllc1JlZHVjZXIsXG4gIGIyYlVzZXJQZXJtaXNzaW9uTGlzdFJlZHVjZXIsXG4gIGIyYlVzZXJVc2VyR3JvdXBMaXN0UmVkdWNlcixcbiAgdXNlckxpc3RSZWR1Y2VyLFxufSBmcm9tICcuL2IyYi11c2VyLnJlZHVjZXInO1xuaW1wb3J0IHsgYnVkZ2V0c0VudGl0aWVzUmVkdWNlciwgYnVkZ2V0c0xpc3RSZWR1Y2VyIH0gZnJvbSAnLi9idWRnZXQucmVkdWNlcic7XG5pbXBvcnQge1xuICBjb3N0Q2VudGVyQXNzaWduZWRCdWRnZXRzTGlzdFJlZHVjZXIsXG4gIGNvc3RDZW50ZXJzRW50aXRpZXNSZWR1Y2VyLFxuICBjb3N0Q2VudGVyc0xpc3RSZWR1Y2VyLFxufSBmcm9tICcuL2Nvc3QtY2VudGVyLnJlZHVjZXInO1xuaW1wb3J0IHtcbiAgb3JnVW5pdEFkZHJlc3NMaXN0UmVkdWNlcixcbiAgb3JnVW5pdEVudGl0aWVzUmVkdWNlcixcbiAgb3JnVW5pdFVzZXJMaXN0UmVkdWNlcixcbn0gZnJvbSAnLi9vcmctdW5pdC5yZWR1Y2VyJztcbmltcG9ydCB7XG4gIHBlcm1pc3Npb25zRW50aXRpZXNSZWR1Y2VyLFxuICBwZXJtaXNzaW9uc0xpc3RSZWR1Y2VyLFxufSBmcm9tICcuL3Blcm1pc3Npb24ucmVkdWNlcic7XG5pbXBvcnQge1xuICB1c2VyR3JvdXBBdmFpbGFibGVPcmRlckFwcHJvdmFsUGVybWlzc2lvbnNMaXN0UmVkdWNlcixcbiAgdXNlckdyb3VwQXZhaWxhYmxPcmdDdXN0b21lcnNMaXN0UmVkdWNlcixcbiAgdXNlckdyb3VwRW50aXRpZXNSZWR1Y2VyLFxuICB1c2VyR3JvdXBzTGlzdFJlZHVjZXIsXG59IGZyb20gJy4vdXNlci1ncm91cC5yZWR1Y2VyJztcblxuZXhwb3J0IGZ1bmN0aW9uIGdldFJlZHVjZXJzKCk6IEFjdGlvblJlZHVjZXJNYXA8T3JnYW5pemF0aW9uU3RhdGU+IHtcbiAgcmV0dXJuIHtcbiAgICBbQlVER0VUX0ZFQVRVUkVdOiBjb21iaW5lUmVkdWNlcnMoe1xuICAgICAgZW50aXRpZXM6IFN0YXRlVXRpbHMuZW50aXR5TG9hZGVyUmVkdWNlcjxCdWRnZXQ+KFxuICAgICAgICBCVURHRVRfRU5USVRJRVMsXG4gICAgICAgIGJ1ZGdldHNFbnRpdGllc1JlZHVjZXJcbiAgICAgICksXG4gICAgICBsaXN0OiBTdGF0ZVV0aWxzLmVudGl0eUxvYWRlclJlZHVjZXI8TGlzdE1vZGVsPihcbiAgICAgICAgQlVER0VUX0xJU1QsXG4gICAgICAgIGJ1ZGdldHNMaXN0UmVkdWNlclxuICAgICAgKSxcbiAgICB9KSxcbiAgICBbUEVSTUlTU0lPTl9GRUFUVVJFXTogY29tYmluZVJlZHVjZXJzKHtcbiAgICAgIGVudGl0aWVzOiBTdGF0ZVV0aWxzLmVudGl0eUxvYWRlclJlZHVjZXI8UGVybWlzc2lvbj4oXG4gICAgICAgIFBFUk1JU1NJT05fRU5USVRJRVMsXG4gICAgICAgIHBlcm1pc3Npb25zRW50aXRpZXNSZWR1Y2VyXG4gICAgICApLFxuICAgICAgbGlzdDogU3RhdGVVdGlscy5lbnRpdHlMb2FkZXJSZWR1Y2VyPExpc3RNb2RlbD4oXG4gICAgICAgIFBFUk1JU1NJT05fTElTVCxcbiAgICAgICAgcGVybWlzc2lvbnNMaXN0UmVkdWNlclxuICAgICAgKSxcbiAgICAgIHBlcm1pc3Npb25UeXBlczogU3RhdGVVdGlscy5lbnRpdHlMb2FkZXJSZWR1Y2VyPFxuICAgICAgICBPcmRlckFwcHJvdmFsUGVybWlzc2lvblR5cGVbXVxuICAgICAgPihQRVJNSVNTSU9OX1RZUEVTX0xJU1QpLFxuICAgIH0pLFxuICAgIFtPUkdfVU5JVF9GRUFUVVJFXTogY29tYmluZVJlZHVjZXJzKHtcbiAgICAgIGVudGl0aWVzOiBTdGF0ZVV0aWxzLmVudGl0eUxvYWRlclJlZHVjZXI8QjJCVW5pdD4oXG4gICAgICAgIE9SR19VTklUX0VOVElUSUVTLFxuICAgICAgICBvcmdVbml0RW50aXRpZXNSZWR1Y2VyXG4gICAgICApLFxuICAgICAgYXZhaWxhYmxlT3JnVW5pdE5vZGVzOlxuICAgICAgICBTdGF0ZVV0aWxzLmVudGl0eUxvYWRlclJlZHVjZXI8QjJCVW5pdE5vZGVbXT4oT1JHX1VOSVRfTk9ERV9MSVNUKSxcbiAgICAgIHRyZWU6IFN0YXRlVXRpbHMuZW50aXR5TG9hZGVyUmVkdWNlcjxCMkJVbml0Tm9kZT4oT1JHX1VOSVRfVFJFRV9FTlRJVFkpLFxuICAgICAgYXBwcm92YWxQcm9jZXNzZXM6IFN0YXRlVXRpbHMuZW50aXR5TG9hZGVyUmVkdWNlcjxCMkJBcHByb3ZhbFByb2Nlc3NbXT4oXG4gICAgICAgIE9SR19VTklUX0FQUFJPVkFMX1BST0NFU1NFU19FTlRJVElFU1xuICAgICAgKSxcbiAgICAgIHVzZXJzOiBTdGF0ZVV0aWxzLmVudGl0eUxvYWRlclJlZHVjZXI8TGlzdE1vZGVsPihcbiAgICAgICAgT1JHX1VOSVRfQVNTSUdORURfVVNFUlMsXG4gICAgICAgIG9yZ1VuaXRVc2VyTGlzdFJlZHVjZXJcbiAgICAgICksXG4gICAgICBhZGRyZXNzTGlzdDogU3RhdGVVdGlscy5lbnRpdHlMb2FkZXJSZWR1Y2VyPExpc3RNb2RlbD4oXG4gICAgICAgIEFERFJFU1NfTElTVCxcbiAgICAgICAgb3JnVW5pdEFkZHJlc3NMaXN0UmVkdWNlclxuICAgICAgKSxcbiAgICAgIGFkZHJlc3NFbnRpdGllczpcbiAgICAgICAgU3RhdGVVdGlscy5lbnRpdHlMb2FkZXJSZWR1Y2VyPEFkZHJlc3M+KEFERFJFU1NfRU5USVRJRVMpLFxuICAgIH0pLFxuICAgIFtVU0VSX0dST1VQX0ZFQVRVUkVdOiBjb21iaW5lUmVkdWNlcnMoe1xuICAgICAgZW50aXRpZXM6IFN0YXRlVXRpbHMuZW50aXR5TG9hZGVyUmVkdWNlcjxVc2VyR3JvdXA+KFxuICAgICAgICBVU0VSX0dST1VQX0VOVElUSUVTLFxuICAgICAgICB1c2VyR3JvdXBFbnRpdGllc1JlZHVjZXJcbiAgICAgICksXG4gICAgICBsaXN0OiBTdGF0ZVV0aWxzLmVudGl0eUxvYWRlclJlZHVjZXI8TGlzdE1vZGVsPihcbiAgICAgICAgVVNFUl9HUk9VUF9MSVNULFxuICAgICAgICB1c2VyR3JvdXBzTGlzdFJlZHVjZXJcbiAgICAgICksXG4gICAgICBwZXJtaXNzaW9uczogU3RhdGVVdGlscy5lbnRpdHlMb2FkZXJSZWR1Y2VyPExpc3RNb2RlbD4oXG4gICAgICAgIFVTRVJfR1JPVVBfUEVSTUlTU0lPTlMsXG4gICAgICAgIHVzZXJHcm91cEF2YWlsYWJsZU9yZGVyQXBwcm92YWxQZXJtaXNzaW9uc0xpc3RSZWR1Y2VyXG4gICAgICApLFxuICAgICAgY3VzdG9tZXJzOiBTdGF0ZVV0aWxzLmVudGl0eUxvYWRlclJlZHVjZXI8TGlzdE1vZGVsPihcbiAgICAgICAgVVNFUl9HUk9VUF9BVkFJTEFCTEVfQ1VTVE9NRVJTLFxuICAgICAgICB1c2VyR3JvdXBBdmFpbGFibE9yZ0N1c3RvbWVyc0xpc3RSZWR1Y2VyXG4gICAgICApLFxuICAgIH0pLFxuICAgIFtDT1NUX0NFTlRFUl9GRUFUVVJFXTogY29tYmluZVJlZHVjZXJzKHtcbiAgICAgIGVudGl0aWVzOiBTdGF0ZVV0aWxzLmVudGl0eUxvYWRlclJlZHVjZXI8Q29zdENlbnRlcj4oXG4gICAgICAgIENPU1RfQ0VOVEVSX0VOVElUSUVTLFxuICAgICAgICBjb3N0Q2VudGVyc0VudGl0aWVzUmVkdWNlclxuICAgICAgKSxcbiAgICAgIGxpc3Q6IFN0YXRlVXRpbHMuZW50aXR5TG9hZGVyUmVkdWNlcjxMaXN0TW9kZWw+KFxuICAgICAgICBDT1NUX0NFTlRFUl9MSVNULFxuICAgICAgICBjb3N0Q2VudGVyc0xpc3RSZWR1Y2VyXG4gICAgICApLFxuICAgICAgYnVkZ2V0czogU3RhdGVVdGlscy5lbnRpdHlMb2FkZXJSZWR1Y2VyPExpc3RNb2RlbD4oXG4gICAgICAgIENPU1RfQ0VOVEVSX0FTU0lHTkVEX0JVREdFVFMsXG4gICAgICAgIGNvc3RDZW50ZXJBc3NpZ25lZEJ1ZGdldHNMaXN0UmVkdWNlclxuICAgICAgKSxcbiAgICB9KSxcbiAgICBbQjJCX1VTRVJfRkVBVFVSRV06IGNvbWJpbmVSZWR1Y2Vycyh7XG4gICAgICBlbnRpdGllczogU3RhdGVVdGlscy5lbnRpdHlMb2FkZXJSZWR1Y2VyPEIyQlVzZXI+KFxuICAgICAgICBCMkJfVVNFUl9FTlRJVElFUyxcbiAgICAgICAgYjJiVXNlckVudGl0aWVzUmVkdWNlclxuICAgICAgKSxcbiAgICAgIGxpc3Q6IFN0YXRlVXRpbHMuZW50aXR5TG9hZGVyUmVkdWNlcjxMaXN0TW9kZWw+KFxuICAgICAgICBVU0VSX0xJU1QsXG4gICAgICAgIHVzZXJMaXN0UmVkdWNlclxuICAgICAgKSxcbiAgICAgIGFwcHJvdmVyczogU3RhdGVVdGlscy5lbnRpdHlMb2FkZXJSZWR1Y2VyPExpc3RNb2RlbD4oXG4gICAgICAgIEIyQl9VU0VSX0FQUFJPVkVSUyxcbiAgICAgICAgYjJiVXNlckFwcHJvdmVyTGlzdFJlZHVjZXJcbiAgICAgICksXG4gICAgICBwZXJtaXNzaW9uczogU3RhdGVVdGlscy5lbnRpdHlMb2FkZXJSZWR1Y2VyPExpc3RNb2RlbD4oXG4gICAgICAgIEIyQl9VU0VSX1BFUk1JU1NJT05TLFxuICAgICAgICBiMmJVc2VyUGVybWlzc2lvbkxpc3RSZWR1Y2VyXG4gICAgICApLFxuICAgICAgdXNlckdyb3VwczogU3RhdGVVdGlscy5lbnRpdHlMb2FkZXJSZWR1Y2VyPExpc3RNb2RlbD4oXG4gICAgICAgIEIyQl9VU0VSX1VTRVJfR1JPVVBTLFxuICAgICAgICBiMmJVc2VyVXNlckdyb3VwTGlzdFJlZHVjZXJcbiAgICAgICksXG4gICAgfSksXG4gIH07XG59XG5cbmV4cG9ydCBjb25zdCByZWR1Y2VyVG9rZW46IEluamVjdGlvblRva2VuPEFjdGlvblJlZHVjZXJNYXA8T3JnYW5pemF0aW9uU3RhdGU+PiA9XG4gIG5ldyBJbmplY3Rpb25Ub2tlbjxBY3Rpb25SZWR1Y2VyTWFwPE9yZ2FuaXphdGlvblN0YXRlPj4oXG4gICAgJ09yZ2FuaXphdGlvblJlZHVjZXJzJ1xuICApO1xuXG5leHBvcnQgY29uc3QgcmVkdWNlclByb3ZpZGVyOiBQcm92aWRlciA9IHtcbiAgcHJvdmlkZTogcmVkdWNlclRva2VuLFxuICB1c2VGYWN0b3J5OiBnZXRSZWR1Y2Vycyxcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBjbGVhck9yZ2FuaXphdGlvblN0YXRlKFxuICByZWR1Y2VyOiBBY3Rpb25SZWR1Y2VyPE9yZ2FuaXphdGlvblN0YXRlLCBBY3Rpb24+XG4pOiBBY3Rpb25SZWR1Y2VyPE9yZ2FuaXphdGlvblN0YXRlLCBBY3Rpb24+IHtcbiAgcmV0dXJuIGZ1bmN0aW9uIChzdGF0ZSwgYWN0aW9uKSB7XG4gICAgaWYgKGFjdGlvbi50eXBlID09PSBPcmdhbml6YXRpb25BY3Rpb25zLkNMRUFSX09SR0FOSVpBVElPTl9EQVRBKSB7XG4gICAgICBzdGF0ZSA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgaWYgKGFjdGlvbi50eXBlID09PSBBdXRoQWN0aW9ucy5MT0dPVVQpIHtcbiAgICAgIHN0YXRlID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBpZiAoYWN0aW9uLnR5cGUgPT09IFNpdGVDb250ZXh0QWN0aW9ucy5MQU5HVUFHRV9DSEFOR0UpIHtcbiAgICAgIHN0YXRlID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHJldHVybiByZWR1Y2VyKHN0YXRlLCBhY3Rpb24pO1xuICB9O1xufVxuXG5leHBvcnQgY29uc3QgbWV0YVJlZHVjZXJzOiBNZXRhUmVkdWNlcjxhbnk+W10gPSBbY2xlYXJPcmdhbml6YXRpb25TdGF0ZV07XG4iXX0=