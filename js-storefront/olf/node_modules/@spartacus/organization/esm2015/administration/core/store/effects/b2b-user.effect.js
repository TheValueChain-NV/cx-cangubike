import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { Effect, ofType } from '@ngrx/effects';
import { AuthActions, B2BUserRole, normalizeHttpError, StateUtils, } from '@spartacus/core';
import { from, of } from 'rxjs';
import { catchError, groupBy, map, mergeMap, switchMap, take, tap, withLatestFrom, } from 'rxjs/operators';
import { B2BUserActions, OrganizationActions, OrgUnitActions, PermissionActions, UserGroupActions, } from '../actions/index';
import * as i0 from "@angular/core";
import * as i1 from "@ngrx/effects";
import * as i2 from "../../connectors/b2b-user/b2b-user.connector";
import * as i3 from "@spartacus/core";
export class B2BUserEffects {
    constructor(actions$, b2bUserConnector, routingService, userService, userIdService) {
        this.actions$ = actions$;
        this.b2bUserConnector = b2bUserConnector;
        this.routingService = routingService;
        this.userService = userService;
        this.userIdService = userIdService;
        this.loadB2BUser$ = this.actions$.pipe(ofType(B2BUserActions.LOAD_B2B_USER), map((action) => action.payload), switchMap(({ userId, orgCustomerId }) => {
            return this.b2bUserConnector.get(userId, orgCustomerId).pipe(map((b2bUser) => {
                return new B2BUserActions.LoadB2BUserSuccess([b2bUser]);
            }), catchError((error) => of(new B2BUserActions.LoadB2BUserFail({
                orgCustomerId,
                error: normalizeHttpError(error),
            }))));
        }));
        this.createB2BUser$ = this.actions$.pipe(ofType(B2BUserActions.CREATE_B2B_USER), map((action) => action.payload), switchMap(({ userId, orgCustomer }) => this.b2bUserConnector.create(userId, orgCustomer).pipe(switchMap((data) => {
            const isAssignedToApprovers = orgCustomer.isAssignedToApprovers;
            // TODO Workaround for not known customerId while user creation (redireciton)
            return this.routingService.getRouterState().pipe(take(1), tap((route) => this.redirectToDetails(route, data)), switchMap(() => {
                const successActions = [
                    new B2BUserActions.CreateB2BUserSuccess(data),
                    new B2BUserActions.CreateB2BUserSuccess({ customerId: null }),
                    new OrganizationActions.OrganizationClearData(),
                ];
                if (isAssignedToApprovers) {
                    successActions.splice(1, 0, new OrgUnitActions.AssignApprover({
                        userId,
                        orgUnitId: orgCustomer.orgUnit.uid,
                        orgCustomerId: data.customerId,
                        roleId: B2BUserRole.APPROVER,
                    }));
                }
                return successActions;
            }));
        }), catchError((error) => from([
            new B2BUserActions.CreateB2BUserFail({
                orgCustomerId: orgCustomer.customerId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.updateB2BUser$ = this.actions$.pipe(ofType(B2BUserActions.UPDATE_B2B_USER), map((action) => action.payload), switchMap(({ userId, orgCustomerId, orgCustomer }) => {
            const isAssignedToApprovers = orgCustomer.isAssignedToApprovers;
            return this.b2bUserConnector
                .update(userId, orgCustomerId, orgCustomer)
                .pipe(switchMap((_data) => {
                const successActions = [
                    // TODO: change for 'payload: data' when backend API start to return user data on PATCH
                    new B2BUserActions.UpdateB2BUserSuccess(orgCustomer),
                ];
                if (isAssignedToApprovers) {
                    successActions.push(new OrgUnitActions.AssignApprover({
                        userId,
                        orgUnitId: orgCustomer.orgUnit.uid,
                        orgCustomerId,
                        roleId: B2BUserRole.APPROVER,
                    }));
                }
                return successActions;
            }), catchError((error) => from([
                new B2BUserActions.UpdateB2BUserFail({
                    orgCustomerId: orgCustomer.customerId,
                    error: normalizeHttpError(error),
                }),
                new OrganizationActions.OrganizationClearData(),
            ])));
        }));
        this.checkSelfEmailUpdate$ = this.actions$.pipe(ofType(B2BUserActions.UPDATE_B2B_USER_SUCCESS), map((action) => action.payload), withLatestFrom(this.userService.get(), this.userIdService.getUserId()), switchMap(([payload, currentUser]) => {
            const currentUserEmailMatch = payload.customerId === currentUser.customerId &&
                payload.email !== currentUser.displayUid;
            if (currentUserEmailMatch) {
                this.routingService.go({ cxRoute: 'login' });
            }
            return currentUserEmailMatch
                ? [new AuthActions.Logout()]
                : [new OrganizationActions.OrganizationClearData()];
        }));
        this.loadB2BUsers$ = this.actions$.pipe(ofType(B2BUserActions.LOAD_B2B_USERS), map((action) => action.payload), switchMap((payload) => this.b2bUserConnector.getList(payload.userId, payload.params).pipe(switchMap((b2bUsers) => {
            const { values, page } = StateUtils.normalizeListPage(b2bUsers, 'customerId');
            return [
                new B2BUserActions.LoadB2BUserSuccess(values),
                new B2BUserActions.LoadB2BUsersSuccess({
                    page,
                    params: payload.params,
                }),
            ];
        }), catchError((error) => of(new B2BUserActions.LoadB2BUsersFail({
            params: payload.params,
            error: normalizeHttpError(error),
        }))))));
        this.loadB2BUserApprovers$ = this.actions$.pipe(ofType(B2BUserActions.LOAD_B2B_USER_APPROVERS), map((action) => action.payload), groupBy(({ orgCustomerId, params }) => StateUtils.serializeParams(orgCustomerId, params)), mergeMap((group) => group.pipe(switchMap((payload) => this.b2bUserConnector
            .getApprovers(payload.userId, payload.orgCustomerId, payload.params)
            .pipe(switchMap((approvers) => {
            const { values, page } = StateUtils.normalizeListPage(approvers, 'customerId');
            return [
                new B2BUserActions.LoadB2BUserSuccess(values),
                new B2BUserActions.LoadB2BUserApproversSuccess({
                    orgCustomerId: payload.orgCustomerId,
                    page,
                    params: payload.params,
                }),
            ];
        }), catchError((error) => of(new B2BUserActions.LoadB2BUserApproversFail({
            orgCustomerId: payload.orgCustomerId,
            params: payload.params,
            error: normalizeHttpError(error),
        }))))))));
        this.loadB2BUserPermissions$ = this.actions$.pipe(ofType(B2BUserActions.LOAD_B2B_USER_PERMISSIONS), map((action) => action.payload), groupBy(({ orgCustomerId, params }) => StateUtils.serializeParams(orgCustomerId, params)), mergeMap((group) => group.pipe(switchMap((payload) => this.b2bUserConnector
            .getPermissions(payload.userId, payload.orgCustomerId, payload.params)
            .pipe(switchMap((permissions) => {
            const { values, page } = StateUtils.normalizeListPage(permissions, 'code');
            return [
                new PermissionActions.LoadPermissionSuccess(values),
                new B2BUserActions.LoadB2BUserPermissionsSuccess({
                    orgCustomerId: payload.orgCustomerId,
                    page,
                    params: payload.params,
                }),
            ];
        }), catchError((error) => of(new B2BUserActions.LoadB2BUserPermissionsFail({
            orgCustomerId: payload.orgCustomerId,
            params: payload.params,
            error: normalizeHttpError(error),
        }))))))));
        this.loadB2BUserUserGroups$ = this.actions$.pipe(ofType(B2BUserActions.LOAD_B2B_USER_USER_GROUPS), map((action) => action.payload), groupBy(({ orgCustomerId, params }) => StateUtils.serializeParams(orgCustomerId, params)), mergeMap((group) => group.pipe(switchMap((payload) => this.b2bUserConnector
            .getUserGroups(payload.userId, payload.orgCustomerId, payload.params)
            .pipe(switchMap((userGroups) => {
            const { values, page } = StateUtils.normalizeListPage(userGroups, 'uid');
            return [
                new UserGroupActions.LoadUserGroupSuccess(values),
                new B2BUserActions.LoadB2BUserUserGroupsSuccess({
                    orgCustomerId: payload.orgCustomerId,
                    page,
                    params: payload.params,
                }),
            ];
        }), catchError((error) => of(new B2BUserActions.LoadB2BUserUserGroupsFail({
            orgCustomerId: payload.orgCustomerId,
            params: payload.params,
            error: normalizeHttpError(error),
        }))))))));
        this.assignApproverToB2BUser$ = this.actions$.pipe(ofType(B2BUserActions.ASSIGN_B2B_USER_APPROVER), map((action) => action.payload), mergeMap((payload) => this.b2bUserConnector
            .assignApprover(payload.userId, payload.orgCustomerId, payload.approverId)
            .pipe(switchMap((data) => [
            new B2BUserActions.AssignB2BUserApproverSuccess({
                // Occ returned email, but we use customerId in store
                approverId: payload.approverId,
                selected: data.selected,
            }),
            // Clearing data in this case causes unexpected behavior (#10468)
            // new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new B2BUserActions.AssignB2BUserApproverFail({
                orgCustomerId: payload.orgCustomerId,
                approverId: payload.approverId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.unassignApproverFromB2BUser$ = this.actions$.pipe(ofType(B2BUserActions.UNASSIGN_B2B_USER_APPROVER), map((action) => action.payload), mergeMap((payload) => this.b2bUserConnector
            .unassignApprover(payload.userId, payload.orgCustomerId, payload.approverId)
            .pipe(switchMap((data) => [
            new B2BUserActions.UnassignB2BUserApproverSuccess({
                // Occ returned email, but we use customerId in store
                approverId: payload.approverId,
                selected: data.selected,
            }),
            // Clearing data in this case causes unexpected behavior (#10468)
            // new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new B2BUserActions.UnassignB2BUserApproverFail({
                orgCustomerId: payload.orgCustomerId,
                approverId: payload.approverId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.assignPermissionToB2BUser$ = this.actions$.pipe(ofType(B2BUserActions.ASSIGN_B2B_USER_PERMISSION), map((action) => action.payload), mergeMap((payload) => this.b2bUserConnector
            .assignPermission(payload.userId, payload.orgCustomerId, payload.permissionId)
            .pipe(switchMap((data) => [
            new B2BUserActions.AssignB2BUserPermissionSuccess({
                permissionId: data.id,
                selected: data.selected,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new B2BUserActions.AssignB2BUserPermissionFail({
                orgCustomerId: payload.orgCustomerId,
                permissionId: payload.permissionId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.unassignPermissionFromB2BUser$ = this.actions$.pipe(ofType(B2BUserActions.UNASSIGN_B2B_USER_PERMISSION), map((action) => action.payload), mergeMap((payload) => this.b2bUserConnector
            .unassignPermission(payload.userId, payload.orgCustomerId, payload.permissionId)
            .pipe(switchMap((data) => [
            new B2BUserActions.UnassignB2BUserPermissionSuccess({
                permissionId: data.id,
                selected: data.selected,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new B2BUserActions.UnassignB2BUserPermissionFail({
                orgCustomerId: payload.orgCustomerId,
                permissionId: payload.permissionId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.assignUserGroupToB2BUser$ = this.actions$.pipe(ofType(B2BUserActions.ASSIGN_B2B_USER_USER_GROUP), map((action) => action.payload), mergeMap((payload) => this.b2bUserConnector
            .assignUserGroup(payload.userId, payload.orgCustomerId, payload.userGroupId)
            .pipe(switchMap((data) => [
            new B2BUserActions.AssignB2BUserUserGroupSuccess({
                uid: data.id,
                selected: data.selected,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new B2BUserActions.AssignB2BUserUserGroupFail({
                orgCustomerId: payload.orgCustomerId,
                userGroupId: payload.userGroupId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.unassignUserGroupFromB2BUser$ = this.actions$.pipe(ofType(B2BUserActions.UNASSIGN_B2B_USER_USER_GROUP), map((action) => action.payload), mergeMap((payload) => this.b2bUserConnector
            .unassignUserGroup(payload.userId, payload.orgCustomerId, payload.userGroupId)
            .pipe(switchMap(
        // TODO: Workaround because occ doesn't respond here
        // (data) =>
        //   new B2BUserActions.DeleteB2BUserUserGroupSuccess({
        //     uid: data.id,
        //     selected: data.selected,
        //   })
        () => [
            new B2BUserActions.UnassignB2BUserUserGroupSuccess({
                uid: payload.userGroupId,
                selected: false,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new B2BUserActions.UnassignB2BUserUserGroupFail({
                orgCustomerId: payload.orgCustomerId,
                userGroupId: payload.userGroupId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
    }
    redirectToDetails(route, data) {
        var _a, _b, _c;
        if (((_c = (_b = (_a = route) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.context) === null || _c === void 0 ? void 0 : _c.id) !== '/organization/units') {
            this.routingService.go({
                cxRoute: 'orgUserDetails',
                params: data,
            });
        }
    }
}
B2BUserEffects.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: B2BUserEffects, deps: [{ token: i1.Actions }, { token: i2.B2BUserConnector }, { token: i3.RoutingService }, { token: i3.UserService }, { token: i3.UserIdService }], target: i0.ɵɵFactoryTarget.Injectable });
B2BUserEffects.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: B2BUserEffects });
__decorate([
    Effect()
], B2BUserEffects.prototype, "loadB2BUser$", void 0);
__decorate([
    Effect()
], B2BUserEffects.prototype, "createB2BUser$", void 0);
__decorate([
    Effect()
], B2BUserEffects.prototype, "updateB2BUser$", void 0);
__decorate([
    Effect()
], B2BUserEffects.prototype, "checkSelfEmailUpdate$", void 0);
__decorate([
    Effect()
], B2BUserEffects.prototype, "loadB2BUsers$", void 0);
__decorate([
    Effect()
], B2BUserEffects.prototype, "loadB2BUserApprovers$", void 0);
__decorate([
    Effect()
], B2BUserEffects.prototype, "loadB2BUserPermissions$", void 0);
__decorate([
    Effect()
], B2BUserEffects.prototype, "loadB2BUserUserGroups$", void 0);
__decorate([
    Effect()
], B2BUserEffects.prototype, "assignApproverToB2BUser$", void 0);
__decorate([
    Effect()
], B2BUserEffects.prototype, "unassignApproverFromB2BUser$", void 0);
__decorate([
    Effect()
], B2BUserEffects.prototype, "assignPermissionToB2BUser$", void 0);
__decorate([
    Effect()
], B2BUserEffects.prototype, "unassignPermissionFromB2BUser$", void 0);
__decorate([
    Effect()
], B2BUserEffects.prototype, "assignUserGroupToB2BUser$", void 0);
__decorate([
    Effect()
], B2BUserEffects.prototype, "unassignUserGroupFromB2BUser$", void 0);
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: B2BUserEffects, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.Actions }, { type: i2.B2BUserConnector }, { type: i3.RoutingService }, { type: i3.UserService }, { type: i3.UserIdService }]; }, propDecorators: { loadB2BUser$: [], createB2BUser$: [], updateB2BUser$: [], checkSelfEmailUpdate$: [], loadB2BUsers$: [], loadB2BUserApprovers$: [], loadB2BUserPermissions$: [], loadB2BUserUserGroups$: [], assignApproverToB2BUser$: [], unassignApproverFromB2BUser$: [], assignPermissionToB2BUser$: [], unassignPermissionFromB2BUser$: [], assignUserGroupToB2BUser$: [], unassignUserGroupFromB2BUser$: [] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYjJiLXVzZXIuZWZmZWN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL29yZ2FuaXphdGlvbi9hZG1pbmlzdHJhdGlvbi9jb3JlL3N0b3JlL2VmZmVjdHMvYjJiLXVzZXIuZWZmZWN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBVyxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hELE9BQU8sRUFDTCxXQUFXLEVBRVgsV0FBVyxFQUVYLGtCQUFrQixFQUVsQixVQUFVLEdBSVgsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QixPQUFPLEVBQUUsSUFBSSxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1QyxPQUFPLEVBQ0wsVUFBVSxFQUNWLE9BQU8sRUFDUCxHQUFHLEVBQ0gsUUFBUSxFQUNSLFNBQVMsRUFDVCxJQUFJLEVBQ0osR0FBRyxFQUNILGNBQWMsR0FDZixNQUFNLGdCQUFnQixDQUFDO0FBSXhCLE9BQU8sRUFDTCxjQUFjLEVBQ2QsbUJBQW1CLEVBQ25CLGNBQWMsRUFDZCxpQkFBaUIsRUFDakIsZ0JBQWdCLEdBQ2pCLE1BQU0sa0JBQWtCLENBQUM7Ozs7O0FBRzFCLE1BQU0sT0FBTyxjQUFjO0lBOGlCekIsWUFDVSxRQUFpQixFQUNqQixnQkFBa0MsRUFDbEMsY0FBOEIsRUFDOUIsV0FBd0IsRUFDeEIsYUFBNEI7UUFKNUIsYUFBUSxHQUFSLFFBQVEsQ0FBUztRQUNqQixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUN4QixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQWpqQnRDLGlCQUFZLEdBRVIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQ3BC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dCI6WyJpbXBvcnQgeyBIdHRwRXJyb3JSZXNwb25zZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFjdGlvbnMsIEVmZmVjdCwgb2ZUeXBlIH0gZnJvbSAnQG5ncngvZWZmZWN0cyc7XG5pbXBvcnQge1xuICBBdXRoQWN0aW9ucyxcbiAgQjJCVXNlcixcbiAgQjJCVXNlclJvbGUsXG4gIEVudGl0aWVzTW9kZWwsXG4gIG5vcm1hbGl6ZUh0dHBFcnJvcixcbiAgUm91dGluZ1NlcnZpY2UsXG4gIFN0YXRlVXRpbHMsXG4gIFVzZXIsXG4gIFVzZXJJZFNlcnZpY2UsXG4gIFVzZXJTZXJ2aWNlLFxufSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHsgZnJvbSwgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7XG4gIGNhdGNoRXJyb3IsXG4gIGdyb3VwQnksXG4gIG1hcCxcbiAgbWVyZ2VNYXAsXG4gIHN3aXRjaE1hcCxcbiAgdGFrZSxcbiAgdGFwLFxuICB3aXRoTGF0ZXN0RnJvbSxcbn0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQjJCVXNlckNvbm5lY3RvciB9IGZyb20gJy4uLy4uL2Nvbm5lY3RvcnMvYjJiLXVzZXIvYjJiLXVzZXIuY29ubmVjdG9yJztcbmltcG9ydCB7IFBlcm1pc3Npb24gfSBmcm9tICcuLi8uLi9tb2RlbC9wZXJtaXNzaW9uLm1vZGVsJztcbmltcG9ydCB7IFVzZXJHcm91cCB9IGZyb20gJy4uLy4uL21vZGVsL3VzZXItZ3JvdXAubW9kZWwnO1xuaW1wb3J0IHtcbiAgQjJCVXNlckFjdGlvbnMsXG4gIE9yZ2FuaXphdGlvbkFjdGlvbnMsXG4gIE9yZ1VuaXRBY3Rpb25zLFxuICBQZXJtaXNzaW9uQWN0aW9ucyxcbiAgVXNlckdyb3VwQWN0aW9ucyxcbn0gZnJvbSAnLi4vYWN0aW9ucy9pbmRleCc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBCMkJVc2VyRWZmZWN0cyB7XG4gIEBFZmZlY3QoKVxuICBsb2FkQjJCVXNlciQ6IE9ic2VydmFibGU8XG4gICAgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJTdWNjZXNzIHwgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJGYWlsXG4gID4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgb2ZUeXBlKEIyQlVzZXJBY3Rpb25zLkxPQURfQjJCX1VTRVIpLFxuICAgIG1hcCgoYWN0aW9uOiBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlcikgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgIHN3aXRjaE1hcCgoeyB1c2VySWQsIG9yZ0N1c3RvbWVySWQgfSkgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuYjJiVXNlckNvbm5lY3Rvci5nZXQodXNlcklkLCBvcmdDdXN0b21lcklkKS5waXBlKFxuICAgICAgICBtYXAoKGIyYlVzZXI6IEIyQlVzZXIpID0+IHtcbiAgICAgICAgICByZXR1cm4gbmV3IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyU3VjY2VzcyhbYjJiVXNlcl0pO1xuICAgICAgICB9KSxcbiAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgIG9mKFxuICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyRmFpbCh7XG4gICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfSlcbiAgKTtcblxuICBARWZmZWN0KClcbiAgY3JlYXRlQjJCVXNlciQ6IE9ic2VydmFibGU8XG4gICAgfCBCMkJVc2VyQWN0aW9ucy5DcmVhdGVCMkJVc2VyU3VjY2Vzc1xuICAgIHwgQjJCVXNlckFjdGlvbnMuQ3JlYXRlQjJCVXNlckZhaWxcbiAgICB8IE9yZ1VuaXRBY3Rpb25zLkFzc2lnbkFwcHJvdmVyXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShCMkJVc2VyQWN0aW9ucy5DUkVBVEVfQjJCX1VTRVIpLFxuICAgIG1hcCgoYWN0aW9uOiBCMkJVc2VyQWN0aW9ucy5DcmVhdGVCMkJVc2VyKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgc3dpdGNoTWFwKCh7IHVzZXJJZCwgb3JnQ3VzdG9tZXIgfSkgPT5cbiAgICAgIHRoaXMuYjJiVXNlckNvbm5lY3Rvci5jcmVhdGUodXNlcklkLCBvcmdDdXN0b21lcikucGlwZShcbiAgICAgICAgc3dpdGNoTWFwKChkYXRhKSA9PiB7XG4gICAgICAgICAgY29uc3QgaXNBc3NpZ25lZFRvQXBwcm92ZXJzID0gb3JnQ3VzdG9tZXIuaXNBc3NpZ25lZFRvQXBwcm92ZXJzO1xuICAgICAgICAgIC8vIFRPRE8gV29ya2Fyb3VuZCBmb3Igbm90IGtub3duIGN1c3RvbWVySWQgd2hpbGUgdXNlciBjcmVhdGlvbiAocmVkaXJlY2l0b24pXG4gICAgICAgICAgcmV0dXJuIHRoaXMucm91dGluZ1NlcnZpY2UuZ2V0Um91dGVyU3RhdGUoKS5waXBlKFxuICAgICAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgICAgIHRhcCgocm91dGUpID0+IHRoaXMucmVkaXJlY3RUb0RldGFpbHMocm91dGUsIGRhdGEpKSxcbiAgICAgICAgICAgIHN3aXRjaE1hcCgoKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IHN1Y2Nlc3NBY3Rpb25zID0gW1xuICAgICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5DcmVhdGVCMkJVc2VyU3VjY2VzcyhkYXRhKSxcbiAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuQ3JlYXRlQjJCVXNlclN1Y2Nlc3MoeyBjdXN0b21lcklkOiBudWxsIH0pLFxuICAgICAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgICBdIGFzIGFueVtdO1xuICAgICAgICAgICAgICBpZiAoaXNBc3NpZ25lZFRvQXBwcm92ZXJzKSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzc0FjdGlvbnMuc3BsaWNlKFxuICAgICAgICAgICAgICAgICAgMSxcbiAgICAgICAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuQXNzaWduQXBwcm92ZXIoe1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgICAgICAgIG9yZ1VuaXRJZDogb3JnQ3VzdG9tZXIub3JnVW5pdC51aWQsXG4gICAgICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQ6IGRhdGEuY3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgcm9sZUlkOiBCMkJVc2VyUm9sZS5BUFBST1ZFUixcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gc3VjY2Vzc0FjdGlvbnM7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICk7XG4gICAgICAgIH0pLFxuICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuQ3JlYXRlQjJCVXNlckZhaWwoe1xuICAgICAgICAgICAgICBvcmdDdXN0b21lcklkOiBvcmdDdXN0b21lci5jdXN0b21lcklkLFxuICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgXSlcbiAgICAgICAgKVxuICAgICAgKVxuICAgIClcbiAgKTtcblxuICBARWZmZWN0KClcbiAgdXBkYXRlQjJCVXNlciQ6IE9ic2VydmFibGU8XG4gICAgfCBCMkJVc2VyQWN0aW9ucy5VcGRhdGVCMkJVc2VyU3VjY2Vzc1xuICAgIHwgQjJCVXNlckFjdGlvbnMuVXBkYXRlQjJCVXNlckZhaWxcbiAgICB8IE9yZ1VuaXRBY3Rpb25zLkFzc2lnbkFwcHJvdmVyXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShCMkJVc2VyQWN0aW9ucy5VUERBVEVfQjJCX1VTRVIpLFxuICAgIG1hcCgoYWN0aW9uOiBCMkJVc2VyQWN0aW9ucy5VcGRhdGVCMkJVc2VyKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgc3dpdGNoTWFwKCh7IHVzZXJJZCwgb3JnQ3VzdG9tZXJJZCwgb3JnQ3VzdG9tZXIgfSkgPT4ge1xuICAgICAgY29uc3QgaXNBc3NpZ25lZFRvQXBwcm92ZXJzID0gb3JnQ3VzdG9tZXIuaXNBc3NpZ25lZFRvQXBwcm92ZXJzO1xuICAgICAgcmV0dXJuIHRoaXMuYjJiVXNlckNvbm5lY3RvclxuICAgICAgICAudXBkYXRlKHVzZXJJZCwgb3JnQ3VzdG9tZXJJZCwgb3JnQ3VzdG9tZXIpXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIHN3aXRjaE1hcCgoX2RhdGEpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHN1Y2Nlc3NBY3Rpb25zID0gW1xuICAgICAgICAgICAgICAvLyBUT0RPOiBjaGFuZ2UgZm9yICdwYXlsb2FkOiBkYXRhJyB3aGVuIGJhY2tlbmQgQVBJIHN0YXJ0IHRvIHJldHVybiB1c2VyIGRhdGEgb24gUEFUQ0hcbiAgICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLlVwZGF0ZUIyQlVzZXJTdWNjZXNzKG9yZ0N1c3RvbWVyKSxcbiAgICAgICAgICAgIF0gYXMgYW55W107XG4gICAgICAgICAgICBpZiAoaXNBc3NpZ25lZFRvQXBwcm92ZXJzKSB7XG4gICAgICAgICAgICAgIHN1Y2Nlc3NBY3Rpb25zLnB1c2goXG4gICAgICAgICAgICAgICAgbmV3IE9yZ1VuaXRBY3Rpb25zLkFzc2lnbkFwcHJvdmVyKHtcbiAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgIG9yZ1VuaXRJZDogb3JnQ3VzdG9tZXIub3JnVW5pdC51aWQsXG4gICAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgICAgICAgcm9sZUlkOiBCMkJVc2VyUm9sZS5BUFBST1ZFUixcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3NBY3Rpb25zO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuVXBkYXRlQjJCVXNlckZhaWwoe1xuICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQ6IG9yZ0N1c3RvbWVyLmN1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH0pXG4gICk7XG5cbiAgQEVmZmVjdCgpXG4gIGNoZWNrU2VsZkVtYWlsVXBkYXRlJDogT2JzZXJ2YWJsZTxcbiAgICB8IEF1dGhBY3Rpb25zLkxvZ291dFxuICAgIHwgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJcbiAgICB8IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhXG4gID4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgb2ZUeXBlKEIyQlVzZXJBY3Rpb25zLlVQREFURV9CMkJfVVNFUl9TVUNDRVNTKSxcbiAgICBtYXAoKGFjdGlvbjogQjJCVXNlckFjdGlvbnMuVXBkYXRlQjJCVXNlclN1Y2Nlc3MpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICB3aXRoTGF0ZXN0RnJvbSh0aGlzLnVzZXJTZXJ2aWNlLmdldCgpLCB0aGlzLnVzZXJJZFNlcnZpY2UuZ2V0VXNlcklkKCkpLFxuICAgIHN3aXRjaE1hcCgoW3BheWxvYWQsIGN1cnJlbnRVc2VyXTogW0IyQlVzZXIsIFVzZXIsIHN0cmluZ10pID0+IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyRW1haWxNYXRjaCA9XG4gICAgICAgIHBheWxvYWQuY3VzdG9tZXJJZCA9PT0gY3VycmVudFVzZXIuY3VzdG9tZXJJZCAmJlxuICAgICAgICBwYXlsb2FkLmVtYWlsICE9PSBjdXJyZW50VXNlci5kaXNwbGF5VWlkO1xuXG4gICAgICBpZiAoY3VycmVudFVzZXJFbWFpbE1hdGNoKSB7XG4gICAgICAgIHRoaXMucm91dGluZ1NlcnZpY2UuZ28oeyBjeFJvdXRlOiAnbG9naW4nIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGN1cnJlbnRVc2VyRW1haWxNYXRjaFxuICAgICAgICA/IFtuZXcgQXV0aEFjdGlvbnMuTG9nb3V0KCldXG4gICAgICAgIDogW25ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpXTtcbiAgICB9KVxuICApO1xuXG4gIEBFZmZlY3QoKVxuICBsb2FkQjJCVXNlcnMkOiBPYnNlcnZhYmxlPFxuICAgIHwgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJzU3VjY2Vzc1xuICAgIHwgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJTdWNjZXNzXG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlcnNGYWlsXG4gID4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgb2ZUeXBlKEIyQlVzZXJBY3Rpb25zLkxPQURfQjJCX1VTRVJTKSxcbiAgICBtYXAoKGFjdGlvbjogQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJzKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgc3dpdGNoTWFwKChwYXlsb2FkKSA9PlxuICAgICAgdGhpcy5iMmJVc2VyQ29ubmVjdG9yLmdldExpc3QocGF5bG9hZC51c2VySWQsIHBheWxvYWQucGFyYW1zKS5waXBlKFxuICAgICAgICBzd2l0Y2hNYXAoKGIyYlVzZXJzOiBFbnRpdGllc01vZGVsPEIyQlVzZXI+KSA9PiB7XG4gICAgICAgICAgY29uc3QgeyB2YWx1ZXMsIHBhZ2UgfSA9IFN0YXRlVXRpbHMubm9ybWFsaXplTGlzdFBhZ2UoXG4gICAgICAgICAgICBiMmJVc2VycyxcbiAgICAgICAgICAgICdjdXN0b21lcklkJ1xuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlclN1Y2Nlc3ModmFsdWVzKSxcbiAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlcnNTdWNjZXNzKHtcbiAgICAgICAgICAgICAgcGFnZSxcbiAgICAgICAgICAgICAgcGFyYW1zOiBwYXlsb2FkLnBhcmFtcyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIF07XG4gICAgICAgIH0pLFxuICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgb2YoXG4gICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJzRmFpbCh7XG4gICAgICAgICAgICAgIHBhcmFtczogcGF5bG9hZC5wYXJhbXMsXG4gICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgQEVmZmVjdCgpXG4gIGxvYWRCMkJVc2VyQXBwcm92ZXJzJDogT2JzZXJ2YWJsZTxcbiAgICB8IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyQXBwcm92ZXJzU3VjY2Vzc1xuICAgIHwgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJBcHByb3ZlcnNGYWlsXG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlclN1Y2Nlc3NcbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICBvZlR5cGUoQjJCVXNlckFjdGlvbnMuTE9BRF9CMkJfVVNFUl9BUFBST1ZFUlMpLFxuICAgIG1hcCgoYWN0aW9uOiBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlckFwcHJvdmVycykgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgIGdyb3VwQnkoKHsgb3JnQ3VzdG9tZXJJZCwgcGFyYW1zIH0pID0+XG4gICAgICBTdGF0ZVV0aWxzLnNlcmlhbGl6ZVBhcmFtcyhvcmdDdXN0b21lcklkLCBwYXJhbXMpXG4gICAgKSxcbiAgICBtZXJnZU1hcCgoZ3JvdXApID0+XG4gICAgICBncm91cC5waXBlKFxuICAgICAgICBzd2l0Y2hNYXAoKHBheWxvYWQpID0+XG4gICAgICAgICAgdGhpcy5iMmJVc2VyQ29ubmVjdG9yXG4gICAgICAgICAgICAuZ2V0QXBwcm92ZXJzKHBheWxvYWQudXNlcklkLCBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsIHBheWxvYWQucGFyYW1zKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgIHN3aXRjaE1hcCgoYXBwcm92ZXJzOiBFbnRpdGllc01vZGVsPEIyQlVzZXI+KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyB2YWx1ZXMsIHBhZ2UgfSA9IFN0YXRlVXRpbHMubm9ybWFsaXplTGlzdFBhZ2UoXG4gICAgICAgICAgICAgICAgICBhcHByb3ZlcnMsXG4gICAgICAgICAgICAgICAgICAnY3VzdG9tZXJJZCdcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJTdWNjZXNzKHZhbHVlcyksXG4gICAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJBcHByb3ZlcnNTdWNjZXNzKHtcbiAgICAgICAgICAgICAgICAgICAgb3JnQ3VzdG9tZXJJZDogcGF5bG9hZC5vcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgICAgICAgICBwYWdlLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBheWxvYWQucGFyYW1zLFxuICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgICAgICBvZihcbiAgICAgICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlckFwcHJvdmVyc0ZhaWwoe1xuICAgICAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkOiBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGF5bG9hZC5wYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKVxuICAgIClcbiAgKTtcblxuICBARWZmZWN0KClcbiAgbG9hZEIyQlVzZXJQZXJtaXNzaW9ucyQ6IE9ic2VydmFibGU8XG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlclBlcm1pc3Npb25zU3VjY2Vzc1xuICAgIHwgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJQZXJtaXNzaW9uc0ZhaWxcbiAgICB8IFBlcm1pc3Npb25BY3Rpb25zLkxvYWRQZXJtaXNzaW9uU3VjY2Vzc1xuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShCMkJVc2VyQWN0aW9ucy5MT0FEX0IyQl9VU0VSX1BFUk1JU1NJT05TKSxcbiAgICBtYXAoKGFjdGlvbjogQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJQZXJtaXNzaW9ucykgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgIGdyb3VwQnkoKHsgb3JnQ3VzdG9tZXJJZCwgcGFyYW1zIH0pID0+XG4gICAgICBTdGF0ZVV0aWxzLnNlcmlhbGl6ZVBhcmFtcyhvcmdDdXN0b21lcklkLCBwYXJhbXMpXG4gICAgKSxcbiAgICBtZXJnZU1hcCgoZ3JvdXApID0+XG4gICAgICBncm91cC5waXBlKFxuICAgICAgICBzd2l0Y2hNYXAoKHBheWxvYWQpID0+XG4gICAgICAgICAgdGhpcy5iMmJVc2VyQ29ubmVjdG9yXG4gICAgICAgICAgICAuZ2V0UGVybWlzc2lvbnMoXG4gICAgICAgICAgICAgIHBheWxvYWQudXNlcklkLFxuICAgICAgICAgICAgICBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgIHBheWxvYWQucGFyYW1zXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgc3dpdGNoTWFwKChwZXJtaXNzaW9uczogRW50aXRpZXNNb2RlbDxQZXJtaXNzaW9uPikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgdmFsdWVzLCBwYWdlIH0gPSBTdGF0ZVV0aWxzLm5vcm1hbGl6ZUxpc3RQYWdlKFxuICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnMsXG4gICAgICAgICAgICAgICAgICAnY29kZSdcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgICBuZXcgUGVybWlzc2lvbkFjdGlvbnMuTG9hZFBlcm1pc3Npb25TdWNjZXNzKHZhbHVlcyksXG4gICAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJQZXJtaXNzaW9uc1N1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkOiBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2UsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGF5bG9hZC5wYXJhbXMsXG4gICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgICAgIG9mKFxuICAgICAgICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyUGVybWlzc2lvbnNGYWlsKHtcbiAgICAgICAgICAgICAgICAgICAgb3JnQ3VzdG9tZXJJZDogcGF5bG9hZC5vcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBheWxvYWQucGFyYW1zLFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgQEVmZmVjdCgpXG4gIGxvYWRCMkJVc2VyVXNlckdyb3VwcyQ6IE9ic2VydmFibGU8XG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlclVzZXJHcm91cHNTdWNjZXNzXG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlclVzZXJHcm91cHNGYWlsXG4gICAgfCBVc2VyR3JvdXBBY3Rpb25zLkxvYWRVc2VyR3JvdXBTdWNjZXNzXG4gID4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgb2ZUeXBlKEIyQlVzZXJBY3Rpb25zLkxPQURfQjJCX1VTRVJfVVNFUl9HUk9VUFMpLFxuICAgIG1hcCgoYWN0aW9uOiBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlclVzZXJHcm91cHMpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICBncm91cEJ5KCh7IG9yZ0N1c3RvbWVySWQsIHBhcmFtcyB9KSA9PlxuICAgICAgU3RhdGVVdGlscy5zZXJpYWxpemVQYXJhbXMob3JnQ3VzdG9tZXJJZCwgcGFyYW1zKVxuICAgICksXG4gICAgbWVyZ2VNYXAoKGdyb3VwKSA9PlxuICAgICAgZ3JvdXAucGlwZShcbiAgICAgICAgc3dpdGNoTWFwKChwYXlsb2FkKSA9PlxuICAgICAgICAgIHRoaXMuYjJiVXNlckNvbm5lY3RvclxuICAgICAgICAgICAgLmdldFVzZXJHcm91cHMoXG4gICAgICAgICAgICAgIHBheWxvYWQudXNlcklkLFxuICAgICAgICAgICAgICBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgIHBheWxvYWQucGFyYW1zXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgc3dpdGNoTWFwKCh1c2VyR3JvdXBzOiBFbnRpdGllc01vZGVsPFVzZXJHcm91cD4pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IHZhbHVlcywgcGFnZSB9ID0gU3RhdGVVdGlscy5ub3JtYWxpemVMaXN0UGFnZShcbiAgICAgICAgICAgICAgICAgIHVzZXJHcm91cHMsXG4gICAgICAgICAgICAgICAgICAndWlkJ1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICAgIG5ldyBVc2VyR3JvdXBBY3Rpb25zLkxvYWRVc2VyR3JvdXBTdWNjZXNzKHZhbHVlcyksXG4gICAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJVc2VyR3JvdXBzU3VjY2Vzcyh7XG4gICAgICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQ6IHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgcGFnZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXlsb2FkLnBhcmFtcyxcbiAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICAgICAgb2YoXG4gICAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJVc2VyR3JvdXBzRmFpbCh7XG4gICAgICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQ6IHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXlsb2FkLnBhcmFtcyxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIEBFZmZlY3QoKVxuICBhc3NpZ25BcHByb3ZlclRvQjJCVXNlciQ6IE9ic2VydmFibGU8XG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyQXBwcm92ZXJTdWNjZXNzXG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyQXBwcm92ZXJGYWlsXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShCMkJVc2VyQWN0aW9ucy5BU1NJR05fQjJCX1VTRVJfQVBQUk9WRVIpLFxuICAgIG1hcCgoYWN0aW9uOiBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyQXBwcm92ZXIpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICBtZXJnZU1hcCgocGF5bG9hZCkgPT5cbiAgICAgIHRoaXMuYjJiVXNlckNvbm5lY3RvclxuICAgICAgICAuYXNzaWduQXBwcm92ZXIoXG4gICAgICAgICAgcGF5bG9hZC51c2VySWQsXG4gICAgICAgICAgcGF5bG9hZC5vcmdDdXN0b21lcklkLFxuICAgICAgICAgIHBheWxvYWQuYXBwcm92ZXJJZFxuICAgICAgICApXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIHN3aXRjaE1hcCgoZGF0YSkgPT4gW1xuICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLkFzc2lnbkIyQlVzZXJBcHByb3ZlclN1Y2Nlc3Moe1xuICAgICAgICAgICAgICAvLyBPY2MgcmV0dXJuZWQgZW1haWwsIGJ1dCB3ZSB1c2UgY3VzdG9tZXJJZCBpbiBzdG9yZVxuICAgICAgICAgICAgICBhcHByb3ZlcklkOiBwYXlsb2FkLmFwcHJvdmVySWQsXG4gICAgICAgICAgICAgIHNlbGVjdGVkOiBkYXRhLnNlbGVjdGVkLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAvLyBDbGVhcmluZyBkYXRhIGluIHRoaXMgY2FzZSBjYXVzZXMgdW5leHBlY3RlZCBiZWhhdmlvciAoIzEwNDY4KVxuICAgICAgICAgICAgLy8gbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgXSksXG4gICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyQXBwcm92ZXJGYWlsKHtcbiAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkOiBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgYXBwcm92ZXJJZDogcGF5bG9hZC5hcHByb3ZlcklkLFxuICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgIClcbiAgKTtcblxuICBARWZmZWN0KClcbiAgdW5hc3NpZ25BcHByb3ZlckZyb21CMkJVc2VyJDogT2JzZXJ2YWJsZTxcbiAgICB8IEIyQlVzZXJBY3Rpb25zLlVuYXNzaWduQjJCVXNlckFwcHJvdmVyU3VjY2Vzc1xuICAgIHwgQjJCVXNlckFjdGlvbnMuVW5hc3NpZ25CMkJVc2VyQXBwcm92ZXJGYWlsXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShCMkJVc2VyQWN0aW9ucy5VTkFTU0lHTl9CMkJfVVNFUl9BUFBST1ZFUiksXG4gICAgbWFwKChhY3Rpb246IEIyQlVzZXJBY3Rpb25zLlVuYXNzaWduQjJCVXNlckFwcHJvdmVyKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgbWVyZ2VNYXAoKHBheWxvYWQpID0+XG4gICAgICB0aGlzLmIyYlVzZXJDb25uZWN0b3JcbiAgICAgICAgLnVuYXNzaWduQXBwcm92ZXIoXG4gICAgICAgICAgcGF5bG9hZC51c2VySWQsXG4gICAgICAgICAgcGF5bG9hZC5vcmdDdXN0b21lcklkLFxuICAgICAgICAgIHBheWxvYWQuYXBwcm92ZXJJZFxuICAgICAgICApXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIHN3aXRjaE1hcCgoZGF0YSkgPT4gW1xuICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLlVuYXNzaWduQjJCVXNlckFwcHJvdmVyU3VjY2Vzcyh7XG4gICAgICAgICAgICAgIC8vIE9jYyByZXR1cm5lZCBlbWFpbCwgYnV0IHdlIHVzZSBjdXN0b21lcklkIGluIHN0b3JlXG4gICAgICAgICAgICAgIGFwcHJvdmVySWQ6IHBheWxvYWQuYXBwcm92ZXJJZCxcbiAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGRhdGEuc2VsZWN0ZWQsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIC8vIENsZWFyaW5nIGRhdGEgaW4gdGhpcyBjYXNlIGNhdXNlcyB1bmV4cGVjdGVkIGJlaGF2aW9yICgjMTA0NjgpXG4gICAgICAgICAgICAvLyBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICBdKSxcbiAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICBmcm9tKFtcbiAgICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLlVuYXNzaWduQjJCVXNlckFwcHJvdmVyRmFpbCh7XG4gICAgICAgICAgICAgICAgb3JnQ3VzdG9tZXJJZDogcGF5bG9hZC5vcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgICAgIGFwcHJvdmVySWQ6IHBheWxvYWQuYXBwcm92ZXJJZCxcbiAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgXSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICApXG4gICk7XG5cbiAgQEVmZmVjdCgpXG4gIGFzc2lnblBlcm1pc3Npb25Ub0IyQlVzZXIkOiBPYnNlcnZhYmxlPFxuICAgIHwgQjJCVXNlckFjdGlvbnMuQXNzaWduQjJCVXNlclBlcm1pc3Npb25TdWNjZXNzXG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyUGVybWlzc2lvbkZhaWxcbiAgICB8IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhXG4gID4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgb2ZUeXBlKEIyQlVzZXJBY3Rpb25zLkFTU0lHTl9CMkJfVVNFUl9QRVJNSVNTSU9OKSxcbiAgICBtYXAoKGFjdGlvbjogQjJCVXNlckFjdGlvbnMuQXNzaWduQjJCVXNlclBlcm1pc3Npb24pID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICBtZXJnZU1hcCgocGF5bG9hZCkgPT5cbiAgICAgIHRoaXMuYjJiVXNlckNvbm5lY3RvclxuICAgICAgICAuYXNzaWduUGVybWlzc2lvbihcbiAgICAgICAgICBwYXlsb2FkLnVzZXJJZCxcbiAgICAgICAgICBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgcGF5bG9hZC5wZXJtaXNzaW9uSWRcbiAgICAgICAgKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKGRhdGEpID0+IFtcbiAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyUGVybWlzc2lvblN1Y2Nlc3Moe1xuICAgICAgICAgICAgICBwZXJtaXNzaW9uSWQ6IGRhdGEuaWQsXG4gICAgICAgICAgICAgIHNlbGVjdGVkOiBkYXRhLnNlbGVjdGVkLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICBdKSxcbiAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICBmcm9tKFtcbiAgICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLkFzc2lnbkIyQlVzZXJQZXJtaXNzaW9uRmFpbCh7XG4gICAgICAgICAgICAgICAgb3JnQ3VzdG9tZXJJZDogcGF5bG9hZC5vcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgICAgIHBlcm1pc3Npb25JZDogcGF5bG9hZC5wZXJtaXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgKVxuICApO1xuXG4gIEBFZmZlY3QoKVxuICB1bmFzc2lnblBlcm1pc3Npb25Gcm9tQjJCVXNlciQ6IE9ic2VydmFibGU8XG4gICAgfCBCMkJVc2VyQWN0aW9ucy5VbmFzc2lnbkIyQlVzZXJQZXJtaXNzaW9uU3VjY2Vzc1xuICAgIHwgQjJCVXNlckFjdGlvbnMuVW5hc3NpZ25CMkJVc2VyUGVybWlzc2lvbkZhaWxcbiAgICB8IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhXG4gID4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgb2ZUeXBlKEIyQlVzZXJBY3Rpb25zLlVOQVNTSUdOX0IyQl9VU0VSX1BFUk1JU1NJT04pLFxuICAgIG1hcCgoYWN0aW9uOiBCMkJVc2VyQWN0aW9ucy5VbmFzc2lnbkIyQlVzZXJQZXJtaXNzaW9uKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgbWVyZ2VNYXAoKHBheWxvYWQpID0+XG4gICAgICB0aGlzLmIyYlVzZXJDb25uZWN0b3JcbiAgICAgICAgLnVuYXNzaWduUGVybWlzc2lvbihcbiAgICAgICAgICBwYXlsb2FkLnVzZXJJZCxcbiAgICAgICAgICBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgcGF5bG9hZC5wZXJtaXNzaW9uSWRcbiAgICAgICAgKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKGRhdGEpID0+IFtcbiAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5VbmFzc2lnbkIyQlVzZXJQZXJtaXNzaW9uU3VjY2Vzcyh7XG4gICAgICAgICAgICAgIHBlcm1pc3Npb25JZDogZGF0YS5pZCxcbiAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGRhdGEuc2VsZWN0ZWQsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgIF0pLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuVW5hc3NpZ25CMkJVc2VyUGVybWlzc2lvbkZhaWwoe1xuICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQ6IHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICBwZXJtaXNzaW9uSWQ6IHBheWxvYWQucGVybWlzc2lvbklkLFxuICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgIClcbiAgKTtcblxuICBARWZmZWN0KClcbiAgYXNzaWduVXNlckdyb3VwVG9CMkJVc2VyJDogT2JzZXJ2YWJsZTxcbiAgICB8IEIyQlVzZXJBY3Rpb25zLkFzc2lnbkIyQlVzZXJVc2VyR3JvdXBTdWNjZXNzXG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyVXNlckdyb3VwRmFpbFxuICAgIHwgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGFcbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICBvZlR5cGUoQjJCVXNlckFjdGlvbnMuQVNTSUdOX0IyQl9VU0VSX1VTRVJfR1JPVVApLFxuICAgIG1hcCgoYWN0aW9uOiBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyVXNlckdyb3VwKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgbWVyZ2VNYXAoKHBheWxvYWQpID0+XG4gICAgICB0aGlzLmIyYlVzZXJDb25uZWN0b3JcbiAgICAgICAgLmFzc2lnblVzZXJHcm91cChcbiAgICAgICAgICBwYXlsb2FkLnVzZXJJZCxcbiAgICAgICAgICBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgcGF5bG9hZC51c2VyR3JvdXBJZFxuICAgICAgICApXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIHN3aXRjaE1hcCgoZGF0YSkgPT4gW1xuICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLkFzc2lnbkIyQlVzZXJVc2VyR3JvdXBTdWNjZXNzKHtcbiAgICAgICAgICAgICAgdWlkOiBkYXRhLmlkLFxuICAgICAgICAgICAgICBzZWxlY3RlZDogZGF0YS5zZWxlY3RlZCxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgXSksXG4gICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyVXNlckdyb3VwRmFpbCh7XG4gICAgICAgICAgICAgICAgb3JnQ3VzdG9tZXJJZDogcGF5bG9hZC5vcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgICAgIHVzZXJHcm91cElkOiBwYXlsb2FkLnVzZXJHcm91cElkLFxuICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgIClcbiAgKTtcblxuICBARWZmZWN0KClcbiAgdW5hc3NpZ25Vc2VyR3JvdXBGcm9tQjJCVXNlciQ6IE9ic2VydmFibGU8XG4gICAgfCBCMkJVc2VyQWN0aW9ucy5VbmFzc2lnbkIyQlVzZXJVc2VyR3JvdXBTdWNjZXNzXG4gICAgfCBCMkJVc2VyQWN0aW9ucy5VbmFzc2lnbkIyQlVzZXJVc2VyR3JvdXBGYWlsXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShCMkJVc2VyQWN0aW9ucy5VTkFTU0lHTl9CMkJfVVNFUl9VU0VSX0dST1VQKSxcbiAgICBtYXAoKGFjdGlvbjogQjJCVXNlckFjdGlvbnMuVW5hc3NpZ25CMkJVc2VyVXNlckdyb3VwKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgbWVyZ2VNYXAoKHBheWxvYWQpID0+XG4gICAgICB0aGlzLmIyYlVzZXJDb25uZWN0b3JcbiAgICAgICAgLnVuYXNzaWduVXNlckdyb3VwKFxuICAgICAgICAgIHBheWxvYWQudXNlcklkLFxuICAgICAgICAgIHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICBwYXlsb2FkLnVzZXJHcm91cElkXG4gICAgICAgIClcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgc3dpdGNoTWFwKFxuICAgICAgICAgICAgLy8gVE9ETzogV29ya2Fyb3VuZCBiZWNhdXNlIG9jYyBkb2Vzbid0IHJlc3BvbmQgaGVyZVxuICAgICAgICAgICAgLy8gKGRhdGEpID0+XG4gICAgICAgICAgICAvLyAgIG5ldyBCMkJVc2VyQWN0aW9ucy5EZWxldGVCMkJVc2VyVXNlckdyb3VwU3VjY2Vzcyh7XG4gICAgICAgICAgICAvLyAgICAgdWlkOiBkYXRhLmlkLFxuICAgICAgICAgICAgLy8gICAgIHNlbGVjdGVkOiBkYXRhLnNlbGVjdGVkLFxuICAgICAgICAgICAgLy8gICB9KVxuICAgICAgICAgICAgKCkgPT4gW1xuICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuVW5hc3NpZ25CMkJVc2VyVXNlckdyb3VwU3VjY2Vzcyh7XG4gICAgICAgICAgICAgICAgdWlkOiBwYXlsb2FkLnVzZXJHcm91cElkLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgXVxuICAgICAgICAgICksXG4gICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5VbmFzc2lnbkIyQlVzZXJVc2VyR3JvdXBGYWlsKHtcbiAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkOiBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgdXNlckdyb3VwSWQ6IHBheWxvYWQudXNlckdyb3VwSWQsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgKVxuICApO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgYWN0aW9ucyQ6IEFjdGlvbnMsXG4gICAgcHJpdmF0ZSBiMmJVc2VyQ29ubmVjdG9yOiBCMkJVc2VyQ29ubmVjdG9yLFxuICAgIHByaXZhdGUgcm91dGluZ1NlcnZpY2U6IFJvdXRpbmdTZXJ2aWNlLFxuICAgIHByaXZhdGUgdXNlclNlcnZpY2U6IFVzZXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgdXNlcklkU2VydmljZTogVXNlcklkU2VydmljZVxuICApIHt9XG5cbiAgcHJvdGVjdGVkIHJlZGlyZWN0VG9EZXRhaWxzKHJvdXRlLCBkYXRhKSB7XG4gICAgaWYgKChyb3V0ZSBhcyBhbnkpPy5zdGF0ZT8uY29udGV4dD8uaWQgIT09ICcvb3JnYW5pemF0aW9uL3VuaXRzJykge1xuICAgICAgdGhpcy5yb3V0aW5nU2VydmljZS5nbyh7XG4gICAgICAgIGN4Um91dGU6ICdvcmdVc2VyRGV0YWlscycsXG4gICAgICAgIHBhcmFtczogZGF0YSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuIl19