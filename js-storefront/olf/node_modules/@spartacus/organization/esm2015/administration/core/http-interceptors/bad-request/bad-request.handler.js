import { Injectable } from '@angular/core';
import { GlobalMessageType, HttpErrorHandler, HttpResponseStatus, } from '@spartacus/core';
import * as i0 from "@angular/core";
export class OrganizationBadRequestHandler extends HttpErrorHandler {
    constructor() {
        super(...arguments);
        this.responseStatus = HttpResponseStatus.BAD_REQUEST;
        this.costCenterMask = /ambiguous unique keys \{code\=(.*)\} for model B2BCostCenterModel/;
        this.unitMask = /ambiguous unique keys \{uid\=(.*)\} for model B2BUnitModel/;
        this.permissionMask = /Approval Permission with code\: (.*) already exists\./;
        this.unknownMask = /Model saving error\./;
    }
    hasMatch(errorResponse) {
        return super.hasMatch(errorResponse) && this.matchMask(errorResponse);
    }
    handleError(_request, response) {
        this.getErrors(response).forEach(({ message }) => {
            // Handle cost center conflict
            this.handleOrganizationConflict(message, this.costCenterMask, 'costCenter');
            // Handle unit conflict
            this.handleOrganizationConflict(message, this.unitMask, 'unit');
            // Handle unit conflict
            this.handleOrganizationConflict(message, this.permissionMask, 'permission');
            // Handle unknown conflict
            this.handleOrganizationConflict(message, this.unknownMask, 'unknown');
        });
    }
    matchMask(response) {
        return this.getErrors(response).some((error) => [
            this.costCenterMask,
            this.unitMask,
            this.permissionMask,
            this.unknownMask,
        ].some((mask) => mask.test(error.message)));
    }
    handleOrganizationConflict(message, mask, key) {
        const result = message.match(mask);
        const params = { code: result === null || result === void 0 ? void 0 : result[1] };
        if (result) {
            this.globalMessageService.add({ key: `organization.httpHandlers.conflict.${key}`, params }, GlobalMessageType.MSG_TYPE_ERROR);
        }
    }
    getErrors(response) {
        var _a;
        return (((_a = response.error) === null || _a === void 0 ? void 0 : _a.errors) || []).filter((error) => error.type === 'ModelSavingError' || error.type === 'DuplicateUidError');
    }
    getPriority() {
        return 0 /* NORMAL */;
    }
}
OrganizationBadRequestHandler.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: OrganizationBadRequestHandler, deps: null, target: i0.ɵɵFactoryTarget.Injectable });
OrganizationBadRequestHandler.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: OrganizationBadRequestHandler, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: OrganizationBadRequestHandler, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFkLXJlcXVlc3QuaGFuZGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2ZlYXR1cmUtbGlicy9vcmdhbml6YXRpb24vYWRtaW5pc3RyYXRpb24vY29yZS9odHRwLWludGVyY2VwdG9ycy9iYWQtcmVxdWVzdC9iYWQtcmVxdWVzdC5oYW5kbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUVMLGlCQUFpQixFQUNqQixnQkFBZ0IsRUFDaEIsa0JBQWtCLEdBRW5CLE1BQU0saUJBQWlCLENBQUM7O0FBS3pCLE1BQU0sT0FBTyw2QkFBOEIsU0FBUSxnQkFBZ0I7SUFIbkU7O1FBSUUsbUJBQWMsR0FBRyxrQkFBa0IsQ0FBQyxXQUFXLENBQUM7UUFFdEMsbUJBQWMsR0FDdEIsbUVBQW1FLENBQUM7UUFDNUQsYUFBUSxHQUNoQiw0REFBNEQsQ0FBQztRQUNyRCxtQkFBYyxHQUN0Qix1REFBdUQsQ0FBQztRQUNoRCxnQkFBVyxHQUFHLHNCQUFzQixDQUFDO0tBK0RoRDtJQTdEQyxRQUFRLENBQUMsYUFBZ0M7UUFDdkMsT0FBTyxLQUFLLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDeEUsQ0FBQztJQUVELFdBQVcsQ0FBQyxRQUEwQixFQUFFLFFBQTJCO1FBQ2pFLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQWMsRUFBRSxFQUFFO1lBQzNELDhCQUE4QjtZQUM5QixJQUFJLENBQUMsMEJBQTBCLENBQzdCLE9BQU8sRUFDUCxJQUFJLENBQUMsY0FBYyxFQUNuQixZQUFZLENBQ2IsQ0FBQztZQUNGLHVCQUF1QjtZQUN2QixJQUFJLENBQUMsMEJBQTBCLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDaEUsdUJBQXVCO1lBQ3ZCLElBQUksQ0FBQywwQkFBMEIsQ0FDN0IsT0FBTyxFQUNQLElBQUksQ0FBQyxjQUFjLEVBQ25CLFlBQVksQ0FDYixDQUFDO1lBQ0YsMEJBQTBCO1lBQzFCLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLFdBQVcsRUFBRSxTQUFTLENBQUMsQ0FBQztRQUN4RSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFUyxTQUFTLENBQUMsUUFBMkI7UUFDN0MsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQzdDO1lBQ0UsSUFBSSxDQUFDLGNBQWM7WUFDbkIsSUFBSSxDQUFDLFFBQVE7WUFDYixJQUFJLENBQUMsY0FBYztZQUNuQixJQUFJLENBQUMsV0FBVztTQUNqQixDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FDM0MsQ0FBQztJQUNKLENBQUM7SUFFUywwQkFBMEIsQ0FDbEMsT0FBZSxFQUNmLElBQVksRUFDWixHQUFXO1FBRVgsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNuQyxNQUFNLE1BQU0sR0FBRyxFQUFFLElBQUksRUFBRSxNQUFNLGFBQU4sTUFBTSx1QkFBTixNQUFNLENBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUNyQyxJQUFJLE1BQU0sRUFBRTtZQUNWLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLENBQzNCLEVBQUUsR0FBRyxFQUFFLHNDQUFzQyxHQUFHLEVBQUUsRUFBRSxNQUFNLEVBQUUsRUFDNUQsaUJBQWlCLENBQUMsY0FBYyxDQUNqQyxDQUFDO1NBQ0g7SUFDSCxDQUFDO0lBRVMsU0FBUyxDQUFDLFFBQTJCOztRQUM3QyxPQUFPLENBQUMsQ0FBQSxNQUFBLFFBQVEsQ0FBQyxLQUFLLDBDQUFFLE1BQU0sS0FBSSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQzFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FDUixLQUFLLENBQUMsSUFBSSxLQUFLLGtCQUFrQixJQUFJLEtBQUssQ0FBQyxJQUFJLEtBQUssbUJBQW1CLENBQzFFLENBQUM7SUFDSixDQUFDO0lBRUQsV0FBVztRQUNULHNCQUF1QjtJQUN6QixDQUFDOzswSEF2RVUsNkJBQTZCOzhIQUE3Qiw2QkFBNkIsY0FGNUIsTUFBTTsyRkFFUCw2QkFBNkI7a0JBSHpDLFVBQVU7bUJBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cEVycm9yUmVzcG9uc2UsIEh0dHBSZXF1ZXN0IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgRXJyb3JNb2RlbCxcbiAgR2xvYmFsTWVzc2FnZVR5cGUsXG4gIEh0dHBFcnJvckhhbmRsZXIsXG4gIEh0dHBSZXNwb25zZVN0YXR1cyxcbiAgUHJpb3JpdHksXG59IGZyb20gJ0BzcGFydGFjdXMvY29yZSc7XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnLFxufSlcbmV4cG9ydCBjbGFzcyBPcmdhbml6YXRpb25CYWRSZXF1ZXN0SGFuZGxlciBleHRlbmRzIEh0dHBFcnJvckhhbmRsZXIge1xuICByZXNwb25zZVN0YXR1cyA9IEh0dHBSZXNwb25zZVN0YXR1cy5CQURfUkVRVUVTVDtcblxuICBwcm90ZWN0ZWQgY29zdENlbnRlck1hc2sgPVxuICAgIC9hbWJpZ3VvdXMgdW5pcXVlIGtleXMgXFx7Y29kZVxcPSguKilcXH0gZm9yIG1vZGVsIEIyQkNvc3RDZW50ZXJNb2RlbC87XG4gIHByb3RlY3RlZCB1bml0TWFzayA9XG4gICAgL2FtYmlndW91cyB1bmlxdWUga2V5cyBcXHt1aWRcXD0oLiopXFx9IGZvciBtb2RlbCBCMkJVbml0TW9kZWwvO1xuICBwcm90ZWN0ZWQgcGVybWlzc2lvbk1hc2sgPVxuICAgIC9BcHByb3ZhbCBQZXJtaXNzaW9uIHdpdGggY29kZVxcOiAoLiopIGFscmVhZHkgZXhpc3RzXFwuLztcbiAgcHJvdGVjdGVkIHVua25vd25NYXNrID0gL01vZGVsIHNhdmluZyBlcnJvclxcLi87XG5cbiAgaGFzTWF0Y2goZXJyb3JSZXNwb25zZTogSHR0cEVycm9yUmVzcG9uc2UpOiBib29sZWFuIHtcbiAgICByZXR1cm4gc3VwZXIuaGFzTWF0Y2goZXJyb3JSZXNwb25zZSkgJiYgdGhpcy5tYXRjaE1hc2soZXJyb3JSZXNwb25zZSk7XG4gIH1cblxuICBoYW5kbGVFcnJvcihfcmVxdWVzdDogSHR0cFJlcXVlc3Q8YW55PiwgcmVzcG9uc2U6IEh0dHBFcnJvclJlc3BvbnNlKTogdm9pZCB7XG4gICAgdGhpcy5nZXRFcnJvcnMocmVzcG9uc2UpLmZvckVhY2goKHsgbWVzc2FnZSB9OiBFcnJvck1vZGVsKSA9PiB7XG4gICAgICAvLyBIYW5kbGUgY29zdCBjZW50ZXIgY29uZmxpY3RcbiAgICAgIHRoaXMuaGFuZGxlT3JnYW5pemF0aW9uQ29uZmxpY3QoXG4gICAgICAgIG1lc3NhZ2UsXG4gICAgICAgIHRoaXMuY29zdENlbnRlck1hc2ssXG4gICAgICAgICdjb3N0Q2VudGVyJ1xuICAgICAgKTtcbiAgICAgIC8vIEhhbmRsZSB1bml0IGNvbmZsaWN0XG4gICAgICB0aGlzLmhhbmRsZU9yZ2FuaXphdGlvbkNvbmZsaWN0KG1lc3NhZ2UsIHRoaXMudW5pdE1hc2ssICd1bml0Jyk7XG4gICAgICAvLyBIYW5kbGUgdW5pdCBjb25mbGljdFxuICAgICAgdGhpcy5oYW5kbGVPcmdhbml6YXRpb25Db25mbGljdChcbiAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgdGhpcy5wZXJtaXNzaW9uTWFzayxcbiAgICAgICAgJ3Blcm1pc3Npb24nXG4gICAgICApO1xuICAgICAgLy8gSGFuZGxlIHVua25vd24gY29uZmxpY3RcbiAgICAgIHRoaXMuaGFuZGxlT3JnYW5pemF0aW9uQ29uZmxpY3QobWVzc2FnZSwgdGhpcy51bmtub3duTWFzaywgJ3Vua25vd24nKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBtYXRjaE1hc2socmVzcG9uc2U6IEh0dHBFcnJvclJlc3BvbnNlKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0RXJyb3JzKHJlc3BvbnNlKS5zb21lKChlcnJvcikgPT5cbiAgICAgIFtcbiAgICAgICAgdGhpcy5jb3N0Q2VudGVyTWFzayxcbiAgICAgICAgdGhpcy51bml0TWFzayxcbiAgICAgICAgdGhpcy5wZXJtaXNzaW9uTWFzayxcbiAgICAgICAgdGhpcy51bmtub3duTWFzayxcbiAgICAgIF0uc29tZSgobWFzaykgPT4gbWFzay50ZXN0KGVycm9yLm1lc3NhZ2UpKVxuICAgICk7XG4gIH1cblxuICBwcm90ZWN0ZWQgaGFuZGxlT3JnYW5pemF0aW9uQ29uZmxpY3QoXG4gICAgbWVzc2FnZTogc3RyaW5nLFxuICAgIG1hc2s6IFJlZ0V4cCxcbiAgICBrZXk6IHN0cmluZ1xuICApIHtcbiAgICBjb25zdCByZXN1bHQgPSBtZXNzYWdlLm1hdGNoKG1hc2spO1xuICAgIGNvbnN0IHBhcmFtcyA9IHsgY29kZTogcmVzdWx0Py5bMV0gfTtcbiAgICBpZiAocmVzdWx0KSB7XG4gICAgICB0aGlzLmdsb2JhbE1lc3NhZ2VTZXJ2aWNlLmFkZChcbiAgICAgICAgeyBrZXk6IGBvcmdhbml6YXRpb24uaHR0cEhhbmRsZXJzLmNvbmZsaWN0LiR7a2V5fWAsIHBhcmFtcyB9LFxuICAgICAgICBHbG9iYWxNZXNzYWdlVHlwZS5NU0dfVFlQRV9FUlJPUlxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0RXJyb3JzKHJlc3BvbnNlOiBIdHRwRXJyb3JSZXNwb25zZSk6IEVycm9yTW9kZWxbXSB7XG4gICAgcmV0dXJuIChyZXNwb25zZS5lcnJvcj8uZXJyb3JzIHx8IFtdKS5maWx0ZXIoXG4gICAgICAoZXJyb3IpID0+XG4gICAgICAgIGVycm9yLnR5cGUgPT09ICdNb2RlbFNhdmluZ0Vycm9yJyB8fCBlcnJvci50eXBlID09PSAnRHVwbGljYXRlVWlkRXJyb3InXG4gICAgKTtcbiAgfVxuXG4gIGdldFByaW9yaXR5KCk6IFByaW9yaXR5IHtcbiAgICByZXR1cm4gUHJpb3JpdHkuTk9STUFMO1xuICB9XG59XG4iXX0=