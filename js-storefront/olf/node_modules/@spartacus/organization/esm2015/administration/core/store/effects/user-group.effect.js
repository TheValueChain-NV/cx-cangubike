import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { Effect, ofType } from '@ngrx/effects';
import { normalizeHttpError, StateUtils, } from '@spartacus/core';
import { from, of } from 'rxjs';
import { catchError, groupBy, map, mergeMap, switchMap } from 'rxjs/operators';
import { B2BUserActions, OrganizationActions, PermissionActions, UserGroupActions, } from '../actions/index';
import * as i0 from "@angular/core";
import * as i1 from "@ngrx/effects";
import * as i2 from "../../connectors/user-group/user-group.connector";
export class UserGroupEffects {
    constructor(actions$, userGroupConnector) {
        this.actions$ = actions$;
        this.userGroupConnector = userGroupConnector;
        this.loadUserGroup$ = this.actions$.pipe(ofType(UserGroupActions.LOAD_USER_GROUP), map((action) => action.payload), switchMap(({ userId, userGroupId }) => {
            return this.userGroupConnector.get(userId, userGroupId).pipe(map((userGroup) => {
                return new UserGroupActions.LoadUserGroupSuccess([userGroup]);
            }), catchError((error) => of(new UserGroupActions.LoadUserGroupFail({
                userGroupId,
                error: normalizeHttpError(error),
            }))));
        }));
        this.loadUserGroups$ = this.actions$.pipe(ofType(UserGroupActions.LOAD_USER_GROUPS), map((action) => action.payload), switchMap((payload) => this.userGroupConnector.getList(payload.userId, payload.params).pipe(switchMap((userGroups) => {
            const { values, page } = StateUtils.normalizeListPage(userGroups, 'uid');
            return [
                new UserGroupActions.LoadUserGroupSuccess(values),
                new UserGroupActions.LoadUserGroupsSuccess({
                    page,
                    params: payload.params,
                }),
            ];
        }), catchError((error) => of(new UserGroupActions.LoadUserGroupsFail({
            params: payload.params,
            error: normalizeHttpError(error),
        }))))));
        this.loadAvailableOrderApprovalPermissions$ = this.actions$.pipe(ofType(UserGroupActions.LOAD_USER_GROUP_PERMISSIONS), map((action) => action.payload), groupBy(({ userGroupId, params }) => StateUtils.serializeParams(userGroupId, params)), mergeMap((group) => group.pipe(switchMap((payload) => this.userGroupConnector
            .getAvailableOrderApprovalPermissions(payload.userId, payload.userGroupId, payload.params)
            .pipe(switchMap((permissions) => {
            const { values, page } = StateUtils.normalizeListPage(permissions, 'code');
            return [
                new PermissionActions.LoadPermissionSuccess(values),
                new UserGroupActions.LoadPermissionsSuccess({
                    userGroupId: payload.userGroupId,
                    page,
                    params: payload.params,
                }),
            ];
        }), catchError((error) => of(new UserGroupActions.LoadPermissionsFail({
            userGroupId: payload.userGroupId,
            params: payload.params,
            error: normalizeHttpError(error),
        }))))))));
        this.loadAvailableOrgCustomers$ = this.actions$.pipe(ofType(UserGroupActions.LOAD_USER_GROUP_AVAILABLE_CUSTOMERS), map((action) => action.payload), groupBy(({ userGroupId, params }) => StateUtils.serializeParams(userGroupId, params)), mergeMap((group) => group.pipe(switchMap((payload) => this.userGroupConnector
            .getAvailableOrgCustomers(payload.userId, payload.userGroupId, payload.params)
            .pipe(switchMap((customers) => {
            const { values, page } = StateUtils.normalizeListPage(customers, 'customerId');
            return [
                new B2BUserActions.LoadB2BUserSuccess(values),
                new UserGroupActions.LoadAvailableOrgCustomersSuccess({
                    userGroupId: payload.userGroupId,
                    page,
                    params: payload.params,
                }),
            ];
        }), catchError((error) => of(new UserGroupActions.LoadAvailableOrgCustomersFail({
            userGroupId: payload.userGroupId,
            params: payload.params,
            error: normalizeHttpError(error),
        }))))))));
        this.createUserGroup$ = this.actions$.pipe(ofType(UserGroupActions.CREATE_USER_GROUP), map((action) => action.payload), switchMap((payload) => this.userGroupConnector.create(payload.userId, payload.userGroup).pipe(switchMap((data) => [
            new UserGroupActions.CreateUserGroupSuccess(data),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new UserGroupActions.CreateUserGroupFail({
                userGroupId: payload.userGroup.uid,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.updateUserGroup$ = this.actions$.pipe(ofType(UserGroupActions.UPDATE_USER_GROUP), map((action) => action.payload), switchMap((payload) => this.userGroupConnector
            .update(payload.userId, payload.userGroupId, payload.userGroup)
            .pipe(switchMap(() => [
            // TODO: Workaround for empty PATCH response:
            new UserGroupActions.UpdateUserGroupSuccess(payload.userGroup),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new UserGroupActions.UpdateUserGroupFail({
                userGroupId: payload.userGroup.uid,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.deleteUserGroup$ = this.actions$.pipe(ofType(UserGroupActions.DELETE_USER_GROUP), map((action) => action.payload), switchMap((payload) => this.userGroupConnector.delete(payload.userId, payload.userGroupId).pipe(switchMap((data) => [
            new UserGroupActions.DeleteUserGroupSuccess(data),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new UserGroupActions.DeleteUserGroupFail({
                userGroupId: payload.userGroupId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.assignPermissionToUserGroup$ = this.actions$.pipe(ofType(UserGroupActions.USER_GROUP_ASSIGN_PERMISSION), map((action) => action.payload), mergeMap((payload) => this.userGroupConnector
            .assignOrderApprovalPermission(payload.userId, payload.userGroupId, payload.permissionUid)
            .pipe(switchMap((data) => [
            new UserGroupActions.AssignPermissionSuccess({
                permissionUid: data.id,
                selected: data.selected,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new UserGroupActions.AssignPermissionFail({
                userGroupId: payload.userGroupId,
                permissionUid: payload.permissionUid,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.assignMemberUnitUserGroup$ = this.actions$.pipe(ofType(UserGroupActions.USER_GROUP_ASSIGN_MEMBER), map((action) => action.payload), mergeMap((payload) => this.userGroupConnector
            .assignMember(payload.userId, payload.userGroupId, payload.customerId)
            .pipe(switchMap(() => [
            new UserGroupActions.AssignMemberSuccess({
                customerId: payload.customerId,
                selected: true,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new UserGroupActions.AssignMemberFail({
                userGroupId: payload.userGroupId,
                customerId: payload.customerId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.unassignMemberFromUserGroup$ = this.actions$.pipe(ofType(UserGroupActions.USER_GROUP_UNASSIGN_MEMBER), map((action) => action.payload), mergeMap((payload) => this.userGroupConnector
            .unassignMember(payload.userId, payload.userGroupId, payload.customerId)
            .pipe(switchMap(() => [
            new UserGroupActions.UnassignMemberSuccess({
                customerId: payload.customerId,
                selected: false,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new UserGroupActions.UnassignMemberFail({
                userGroupId: payload.userGroupId,
                customerId: payload.customerId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.unassignPermissionFromUserGroup$ = this.actions$.pipe(ofType(UserGroupActions.USER_GROUP_UNASSIGN_PERMISSION), map((action) => action.payload), mergeMap((payload) => this.userGroupConnector
            .unassignOrderApprovalPermission(payload.userId, payload.userGroupId, payload.permissionUid)
            .pipe(switchMap((data) => [
            new UserGroupActions.UnassignPermissionSuccess({
                permissionUid: data.id,
                selected: data.selected,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new UserGroupActions.UnassignPermissionFail({
                userGroupId: payload.userGroupId,
                permissionUid: payload.permissionUid,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.unassignAllMembersFromUserGroup$ = this.actions$.pipe(ofType(UserGroupActions.USER_GROUP_UNASSIGN_ALL_MEMBERS), map((action) => action.payload), switchMap((payload) => this.userGroupConnector
            .unassignAllMembers(payload.userId, payload.userGroupId)
            .pipe(switchMap(() => [
            new UserGroupActions.UnassignAllMembersSuccess({
                selected: false,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new UserGroupActions.UnassignAllMembersFail({
                userGroupId: payload.userGroupId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
    }
}
UserGroupEffects.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: UserGroupEffects, deps: [{ token: i1.Actions }, { token: i2.UserGroupConnector }], target: i0.ɵɵFactoryTarget.Injectable });
UserGroupEffects.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: UserGroupEffects });
__decorate([
    Effect()
], UserGroupEffects.prototype, "loadUserGroup$", void 0);
__decorate([
    Effect()
], UserGroupEffects.prototype, "loadUserGroups$", void 0);
__decorate([
    Effect()
], UserGroupEffects.prototype, "loadAvailableOrderApprovalPermissions$", void 0);
__decorate([
    Effect()
], UserGroupEffects.prototype, "loadAvailableOrgCustomers$", void 0);
__decorate([
    Effect()
], UserGroupEffects.prototype, "createUserGroup$", void 0);
__decorate([
    Effect()
], UserGroupEffects.prototype, "updateUserGroup$", void 0);
__decorate([
    Effect()
], UserGroupEffects.prototype, "deleteUserGroup$", void 0);
__decorate([
    Effect()
], UserGroupEffects.prototype, "assignPermissionToUserGroup$", void 0);
__decorate([
    Effect()
], UserGroupEffects.prototype, "assignMemberUnitUserGroup$", void 0);
__decorate([
    Effect()
], UserGroupEffects.prototype, "unassignMemberFromUserGroup$", void 0);
__decorate([
    Effect()
], UserGroupEffects.prototype, "unassignPermissionFromUserGroup$", void 0);
__decorate([
    Effect()
], UserGroupEffects.prototype, "unassignAllMembersFromUserGroup$", void 0);
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: UserGroupEffects, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.Actions }, { type: i2.UserGroupConnector }]; }, propDecorators: { loadUserGroup$: [], loadUserGroups$: [], loadAvailableOrderApprovalPermissions$: [], loadAvailableOrgCustomers$: [], createUserGroup$: [], updateUserGroup$: [], deleteUserGroup$: [], assignPermissionToUserGroup$: [], assignMemberUnitUserGroup$: [], unassignMemberFromUserGroup$: [], unassignPermissionFromUserGroup$: [], unassignAllMembersFromUserGroup$: [] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1ncm91cC5lZmZlY3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvb3JnYW5pemF0aW9uL2FkbWluaXN0cmF0aW9uL2NvcmUvc3RvcmUvZWZmZWN0cy91c2VyLWdyb3VwLmVmZmVjdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQVcsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN4RCxPQUFPLEVBR0wsa0JBQWtCLEVBQ2xCLFVBQVUsR0FDWCxNQUFNLGlCQUFpQixDQUFDO0FBQ3pCLE9BQU8sRUFBRSxJQUFJLEVBQWMsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFJL0UsT0FBTyxFQUNMLGNBQWMsRUFDZCxtQkFBbUIsRUFDbkIsaUJBQWlCLEVBQ2pCLGdCQUFnQixHQUNqQixNQUFNLGtCQUFrQixDQUFDOzs7O0FBRzFCLE1BQU0sT0FBTyxnQkFBZ0I7SUE4WjNCLFlBQ1UsUUFBaUIsRUFDakIsa0JBQXNDO1FBRHRDLGFBQVEsR0FBUixRQUFRLENBQVM7UUFDakIsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQTlaaEQsbUJBQWMsR0FFVixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDcEIsTUFBTSxDQUFDLGdCQUFnQixDQUFDLGVBQWUsQ0FBQyxFQUN4QyxHQUFHLENBQUMsQ0FBQyxNQUFzQyxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQy9ELFNBQVMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxFQUFFLEVBQUU7WUFDcEMsT0FBTyxJQUFJLENBQUMsa0JB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c0VBbUNQO0FBR0Y7SUFEQyxNQUFNLEVBQUU7b0VBK0JQO0FBR0Y7SUFEQyxNQUFNLEVBQUU7c0VBK0JQO0FBR0Y7SUFEQyxNQUFNLEVBQUU7MEVBbUNQO0FBR0Y7SUFEQyxNQUFNLEVBQUU7MEVBNkJQOzJGQTVaUyxnQkFBZ0I7a0JBRDVCLFVBQVU7K0hBR1QsY0FBYyxNQXVCZCxlQUFlLE1BbUNmLHNDQUFzQyxNQWtEdEMsMEJBQTBCLE1Ba0QxQixnQkFBZ0IsTUEyQmhCLGdCQUFnQixNQThCaEIsZ0JBQWdCLE1BMkJoQiw0QkFBNEIsTUFxQzVCLDBCQUEwQixNQWlDMUIsNEJBQTRCLE1BaUM1QixnQ0FBZ0MsTUFxQ2hDLGdDQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBFcnJvclJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWN0aW9ucywgRWZmZWN0LCBvZlR5cGUgfSBmcm9tICdAbmdyeC9lZmZlY3RzJztcbmltcG9ydCB7XG4gIEIyQlVzZXIsXG4gIEVudGl0aWVzTW9kZWwsXG4gIG5vcm1hbGl6ZUh0dHBFcnJvcixcbiAgU3RhdGVVdGlscyxcbn0gZnJvbSAnQHNwYXJ0YWN1cy9jb3JlJztcbmltcG9ydCB7IGZyb20sIE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjYXRjaEVycm9yLCBncm91cEJ5LCBtYXAsIG1lcmdlTWFwLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBVc2VyR3JvdXBDb25uZWN0b3IgfSBmcm9tICcuLi8uLi9jb25uZWN0b3JzL3VzZXItZ3JvdXAvdXNlci1ncm91cC5jb25uZWN0b3InO1xuaW1wb3J0IHsgUGVybWlzc2lvbiB9IGZyb20gJy4uLy4uL21vZGVsL3Blcm1pc3Npb24ubW9kZWwnO1xuaW1wb3J0IHsgVXNlckdyb3VwIH0gZnJvbSAnLi4vLi4vbW9kZWwvdXNlci1ncm91cC5tb2RlbCc7XG5pbXBvcnQge1xuICBCMkJVc2VyQWN0aW9ucyxcbiAgT3JnYW5pemF0aW9uQWN0aW9ucyxcbiAgUGVybWlzc2lvbkFjdGlvbnMsXG4gIFVzZXJHcm91cEFjdGlvbnMsXG59IGZyb20gJy4uL2FjdGlvbnMvaW5kZXgnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgVXNlckdyb3VwRWZmZWN0cyB7XG4gIEBFZmZlY3QoKVxuICBsb2FkVXNlckdyb3VwJDogT2JzZXJ2YWJsZTxcbiAgICBVc2VyR3JvdXBBY3Rpb25zLkxvYWRVc2VyR3JvdXBTdWNjZXNzIHwgVXNlckdyb3VwQWN0aW9ucy5Mb2FkVXNlckdyb3VwRmFpbFxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShVc2VyR3JvdXBBY3Rpb25zLkxPQURfVVNFUl9HUk9VUCksXG4gICAgbWFwKChhY3Rpb246IFVzZXJHcm91cEFjdGlvbnMuTG9hZFVzZXJHcm91cCkgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgIHN3aXRjaE1hcCgoeyB1c2VySWQsIHVzZXJHcm91cElkIH0pID0+IHtcbiAgICAgIHJldHVybiB0aGlzLnVzZXJHcm91cENvbm5lY3Rvci5nZXQodXNlcklkLCB1c2VyR3JvdXBJZCkucGlwZShcbiAgICAgICAgbWFwKCh1c2VyR3JvdXA6IFVzZXJHcm91cCkgPT4ge1xuICAgICAgICAgIHJldHVybiBuZXcgVXNlckdyb3VwQWN0aW9ucy5Mb2FkVXNlckdyb3VwU3VjY2VzcyhbdXNlckdyb3VwXSk7XG4gICAgICAgIH0pLFxuICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgb2YoXG4gICAgICAgICAgICBuZXcgVXNlckdyb3VwQWN0aW9ucy5Mb2FkVXNlckdyb3VwRmFpbCh7XG4gICAgICAgICAgICAgIHVzZXJHcm91cElkLFxuICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICApO1xuICAgIH0pXG4gICk7XG5cbiAgQEVmZmVjdCgpXG4gIGxvYWRVc2VyR3JvdXBzJDogT2JzZXJ2YWJsZTxcbiAgICB8IFVzZXJHcm91cEFjdGlvbnMuTG9hZFVzZXJHcm91cHNTdWNjZXNzXG4gICAgfCBVc2VyR3JvdXBBY3Rpb25zLkxvYWRVc2VyR3JvdXBTdWNjZXNzXG4gICAgfCBVc2VyR3JvdXBBY3Rpb25zLkxvYWRVc2VyR3JvdXBzRmFpbFxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShVc2VyR3JvdXBBY3Rpb25zLkxPQURfVVNFUl9HUk9VUFMpLFxuICAgIG1hcCgoYWN0aW9uOiBVc2VyR3JvdXBBY3Rpb25zLkxvYWRVc2VyR3JvdXBzKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgc3dpdGNoTWFwKChwYXlsb2FkKSA9PlxuICAgICAgdGhpcy51c2VyR3JvdXBDb25uZWN0b3IuZ2V0TGlzdChwYXlsb2FkLnVzZXJJZCwgcGF5bG9hZC5wYXJhbXMpLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcCgodXNlckdyb3VwczogRW50aXRpZXNNb2RlbDxVc2VyR3JvdXA+KSA9PiB7XG4gICAgICAgICAgY29uc3QgeyB2YWx1ZXMsIHBhZ2UgfSA9IFN0YXRlVXRpbHMubm9ybWFsaXplTGlzdFBhZ2UoXG4gICAgICAgICAgICB1c2VyR3JvdXBzLFxuICAgICAgICAgICAgJ3VpZCdcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBuZXcgVXNlckdyb3VwQWN0aW9ucy5Mb2FkVXNlckdyb3VwU3VjY2Vzcyh2YWx1ZXMpLFxuICAgICAgICAgICAgbmV3IFVzZXJHcm91cEFjdGlvbnMuTG9hZFVzZXJHcm91cHNTdWNjZXNzKHtcbiAgICAgICAgICAgICAgcGFnZSxcbiAgICAgICAgICAgICAgcGFyYW1zOiBwYXlsb2FkLnBhcmFtcyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIF07XG4gICAgICAgIH0pLFxuICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgb2YoXG4gICAgICAgICAgICBuZXcgVXNlckdyb3VwQWN0aW9ucy5Mb2FkVXNlckdyb3Vwc0ZhaWwoe1xuICAgICAgICAgICAgICBwYXJhbXM6IHBheWxvYWQucGFyYW1zLFxuICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIEBFZmZlY3QoKVxuICBsb2FkQXZhaWxhYmxlT3JkZXJBcHByb3ZhbFBlcm1pc3Npb25zJDogT2JzZXJ2YWJsZTxcbiAgICB8IFVzZXJHcm91cEFjdGlvbnMuTG9hZFBlcm1pc3Npb25zU3VjY2Vzc1xuICAgIHwgUGVybWlzc2lvbkFjdGlvbnMuTG9hZFBlcm1pc3Npb25TdWNjZXNzXG4gICAgfCBVc2VyR3JvdXBBY3Rpb25zLkxvYWRQZXJtaXNzaW9uc0ZhaWxcbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICBvZlR5cGUoVXNlckdyb3VwQWN0aW9ucy5MT0FEX1VTRVJfR1JPVVBfUEVSTUlTU0lPTlMpLFxuICAgIG1hcCgoYWN0aW9uOiBVc2VyR3JvdXBBY3Rpb25zLkxvYWRQZXJtaXNzaW9ucykgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgIGdyb3VwQnkoKHsgdXNlckdyb3VwSWQsIHBhcmFtcyB9KSA9PlxuICAgICAgU3RhdGVVdGlscy5zZXJpYWxpemVQYXJhbXModXNlckdyb3VwSWQsIHBhcmFtcylcbiAgICApLFxuICAgIG1lcmdlTWFwKChncm91cCkgPT5cbiAgICAgIGdyb3VwLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcCgocGF5bG9hZCkgPT5cbiAgICAgICAgICB0aGlzLnVzZXJHcm91cENvbm5lY3RvclxuICAgICAgICAgICAgLmdldEF2YWlsYWJsZU9yZGVyQXBwcm92YWxQZXJtaXNzaW9ucyhcbiAgICAgICAgICAgICAgcGF5bG9hZC51c2VySWQsXG4gICAgICAgICAgICAgIHBheWxvYWQudXNlckdyb3VwSWQsXG4gICAgICAgICAgICAgIHBheWxvYWQucGFyYW1zXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgc3dpdGNoTWFwKChwZXJtaXNzaW9uczogRW50aXRpZXNNb2RlbDxQZXJtaXNzaW9uPikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgdmFsdWVzLCBwYWdlIH0gPSBTdGF0ZVV0aWxzLm5vcm1hbGl6ZUxpc3RQYWdlKFxuICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnMsXG4gICAgICAgICAgICAgICAgICAnY29kZSdcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgICBuZXcgUGVybWlzc2lvbkFjdGlvbnMuTG9hZFBlcm1pc3Npb25TdWNjZXNzKHZhbHVlcyksXG4gICAgICAgICAgICAgICAgICBuZXcgVXNlckdyb3VwQWN0aW9ucy5Mb2FkUGVybWlzc2lvbnNTdWNjZXNzKHtcbiAgICAgICAgICAgICAgICAgICAgdXNlckdyb3VwSWQ6IHBheWxvYWQudXNlckdyb3VwSWQsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2UsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGF5bG9hZC5wYXJhbXMsXG4gICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgICAgIG9mKFxuICAgICAgICAgICAgICAgICAgbmV3IFVzZXJHcm91cEFjdGlvbnMuTG9hZFBlcm1pc3Npb25zRmFpbCh7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJHcm91cElkOiBwYXlsb2FkLnVzZXJHcm91cElkLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBheWxvYWQucGFyYW1zLFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgQEVmZmVjdCgpXG4gIGxvYWRBdmFpbGFibGVPcmdDdXN0b21lcnMkOiBPYnNlcnZhYmxlPFxuICAgIHwgVXNlckdyb3VwQWN0aW9ucy5Mb2FkQXZhaWxhYmxlT3JnQ3VzdG9tZXJzU3VjY2Vzc1xuICAgIHwgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJTdWNjZXNzXG4gICAgfCBVc2VyR3JvdXBBY3Rpb25zLkxvYWRBdmFpbGFibGVPcmdDdXN0b21lcnNGYWlsXG4gID4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgb2ZUeXBlKFVzZXJHcm91cEFjdGlvbnMuTE9BRF9VU0VSX0dST1VQX0FWQUlMQUJMRV9DVVNUT01FUlMpLFxuICAgIG1hcCgoYWN0aW9uOiBVc2VyR3JvdXBBY3Rpb25zLkxvYWRBdmFpbGFibGVPcmdDdXN0b21lcnMpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICBncm91cEJ5KCh7IHVzZXJHcm91cElkLCBwYXJhbXMgfSkgPT5cbiAgICAgIFN0YXRlVXRpbHMuc2VyaWFsaXplUGFyYW1zKHVzZXJHcm91cElkLCBwYXJhbXMpXG4gICAgKSxcbiAgICBtZXJnZU1hcCgoZ3JvdXApID0+XG4gICAgICBncm91cC5waXBlKFxuICAgICAgICBzd2l0Y2hNYXAoKHBheWxvYWQpID0+XG4gICAgICAgICAgdGhpcy51c2VyR3JvdXBDb25uZWN0b3JcbiAgICAgICAgICAgIC5nZXRBdmFpbGFibGVPcmdDdXN0b21lcnMoXG4gICAgICAgICAgICAgIHBheWxvYWQudXNlcklkLFxuICAgICAgICAgICAgICBwYXlsb2FkLnVzZXJHcm91cElkLFxuICAgICAgICAgICAgICBwYXlsb2FkLnBhcmFtc1xuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgIHN3aXRjaE1hcCgoY3VzdG9tZXJzOiBFbnRpdGllc01vZGVsPEIyQlVzZXI+KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyB2YWx1ZXMsIHBhZ2UgfSA9IFN0YXRlVXRpbHMubm9ybWFsaXplTGlzdFBhZ2UoXG4gICAgICAgICAgICAgICAgICBjdXN0b21lcnMsXG4gICAgICAgICAgICAgICAgICAnY3VzdG9tZXJJZCdcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJTdWNjZXNzKHZhbHVlcyksXG4gICAgICAgICAgICAgICAgICBuZXcgVXNlckdyb3VwQWN0aW9ucy5Mb2FkQXZhaWxhYmxlT3JnQ3VzdG9tZXJzU3VjY2Vzcyh7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJHcm91cElkOiBwYXlsb2FkLnVzZXJHcm91cElkLFxuICAgICAgICAgICAgICAgICAgICBwYWdlLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBheWxvYWQucGFyYW1zLFxuICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgICAgICBvZihcbiAgICAgICAgICAgICAgICAgIG5ldyBVc2VyR3JvdXBBY3Rpb25zLkxvYWRBdmFpbGFibGVPcmdDdXN0b21lcnNGYWlsKHtcbiAgICAgICAgICAgICAgICAgICAgdXNlckdyb3VwSWQ6IHBheWxvYWQudXNlckdyb3VwSWQsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGF5bG9hZC5wYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKVxuICAgIClcbiAgKTtcblxuICBARWZmZWN0KClcbiAgY3JlYXRlVXNlckdyb3VwJDogT2JzZXJ2YWJsZTxcbiAgICB8IFVzZXJHcm91cEFjdGlvbnMuQ3JlYXRlVXNlckdyb3VwU3VjY2Vzc1xuICAgIHwgVXNlckdyb3VwQWN0aW9ucy5DcmVhdGVVc2VyR3JvdXBGYWlsXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShVc2VyR3JvdXBBY3Rpb25zLkNSRUFURV9VU0VSX0dST1VQKSxcbiAgICBtYXAoKGFjdGlvbjogVXNlckdyb3VwQWN0aW9ucy5DcmVhdGVVc2VyR3JvdXApID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICBzd2l0Y2hNYXAoKHBheWxvYWQpID0+XG4gICAgICB0aGlzLnVzZXJHcm91cENvbm5lY3Rvci5jcmVhdGUocGF5bG9hZC51c2VySWQsIHBheWxvYWQudXNlckdyb3VwKS5waXBlKFxuICAgICAgICBzd2l0Y2hNYXAoKGRhdGEpID0+IFtcbiAgICAgICAgICBuZXcgVXNlckdyb3VwQWN0aW9ucy5DcmVhdGVVc2VyR3JvdXBTdWNjZXNzKGRhdGEpLFxuICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICBdKSxcbiAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgbmV3IFVzZXJHcm91cEFjdGlvbnMuQ3JlYXRlVXNlckdyb3VwRmFpbCh7XG4gICAgICAgICAgICAgIHVzZXJHcm91cElkOiBwYXlsb2FkLnVzZXJHcm91cC51aWQsXG4gICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICBdKVxuICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIEBFZmZlY3QoKVxuICB1cGRhdGVVc2VyR3JvdXAkOiBPYnNlcnZhYmxlPFxuICAgIHwgVXNlckdyb3VwQWN0aW9ucy5VcGRhdGVVc2VyR3JvdXBTdWNjZXNzXG4gICAgfCBVc2VyR3JvdXBBY3Rpb25zLlVwZGF0ZVVzZXJHcm91cEZhaWxcbiAgICB8IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhXG4gID4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgb2ZUeXBlKFVzZXJHcm91cEFjdGlvbnMuVVBEQVRFX1VTRVJfR1JPVVApLFxuICAgIG1hcCgoYWN0aW9uOiBVc2VyR3JvdXBBY3Rpb25zLlVwZGF0ZVVzZXJHcm91cCkgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgIHN3aXRjaE1hcCgocGF5bG9hZCkgPT5cbiAgICAgIHRoaXMudXNlckdyb3VwQ29ubmVjdG9yXG4gICAgICAgIC51cGRhdGUocGF5bG9hZC51c2VySWQsIHBheWxvYWQudXNlckdyb3VwSWQsIHBheWxvYWQudXNlckdyb3VwKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKCkgPT4gW1xuICAgICAgICAgICAgLy8gVE9ETzogV29ya2Fyb3VuZCBmb3IgZW1wdHkgUEFUQ0ggcmVzcG9uc2U6XG4gICAgICAgICAgICBuZXcgVXNlckdyb3VwQWN0aW9ucy5VcGRhdGVVc2VyR3JvdXBTdWNjZXNzKHBheWxvYWQudXNlckdyb3VwKSxcbiAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgIF0pLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICBuZXcgVXNlckdyb3VwQWN0aW9ucy5VcGRhdGVVc2VyR3JvdXBGYWlsKHtcbiAgICAgICAgICAgICAgICB1c2VyR3JvdXBJZDogcGF5bG9hZC51c2VyR3JvdXAudWlkLFxuICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgIClcbiAgKTtcblxuICBARWZmZWN0KClcbiAgZGVsZXRlVXNlckdyb3VwJDogT2JzZXJ2YWJsZTxcbiAgICB8IFVzZXJHcm91cEFjdGlvbnMuRGVsZXRlVXNlckdyb3VwU3VjY2Vzc1xuICAgIHwgVXNlckdyb3VwQWN0aW9ucy5EZWxldGVVc2VyR3JvdXBGYWlsXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShVc2VyR3JvdXBBY3Rpb25zLkRFTEVURV9VU0VSX0dST1VQKSxcbiAgICBtYXAoKGFjdGlvbjogVXNlckdyb3VwQWN0aW9ucy5EZWxldGVVc2VyR3JvdXApID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICBzd2l0Y2hNYXAoKHBheWxvYWQpID0+XG4gICAgICB0aGlzLnVzZXJHcm91cENvbm5lY3Rvci5kZWxldGUocGF5bG9hZC51c2VySWQsIHBheWxvYWQudXNlckdyb3VwSWQpLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcCgoZGF0YSkgPT4gW1xuICAgICAgICAgIG5ldyBVc2VyR3JvdXBBY3Rpb25zLkRlbGV0ZVVzZXJHcm91cFN1Y2Nlc3MoZGF0YSksXG4gICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgIF0pLFxuICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICBuZXcgVXNlckdyb3VwQWN0aW9ucy5EZWxldGVVc2VyR3JvdXBGYWlsKHtcbiAgICAgICAgICAgICAgdXNlckdyb3VwSWQ6IHBheWxvYWQudXNlckdyb3VwSWQsXG4gICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICBdKVxuICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIEBFZmZlY3QoKVxuICBhc3NpZ25QZXJtaXNzaW9uVG9Vc2VyR3JvdXAkOiBPYnNlcnZhYmxlPFxuICAgIHwgVXNlckdyb3VwQWN0aW9ucy5Bc3NpZ25QZXJtaXNzaW9uU3VjY2Vzc1xuICAgIHwgVXNlckdyb3VwQWN0aW9ucy5Bc3NpZ25QZXJtaXNzaW9uRmFpbFxuICAgIHwgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGFcbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICBvZlR5cGUoVXNlckdyb3VwQWN0aW9ucy5VU0VSX0dST1VQX0FTU0lHTl9QRVJNSVNTSU9OKSxcbiAgICBtYXAoKGFjdGlvbjogVXNlckdyb3VwQWN0aW9ucy5Bc3NpZ25QZXJtaXNzaW9uKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgbWVyZ2VNYXAoKHBheWxvYWQpID0+XG4gICAgICB0aGlzLnVzZXJHcm91cENvbm5lY3RvclxuICAgICAgICAuYXNzaWduT3JkZXJBcHByb3ZhbFBlcm1pc3Npb24oXG4gICAgICAgICAgcGF5bG9hZC51c2VySWQsXG4gICAgICAgICAgcGF5bG9hZC51c2VyR3JvdXBJZCxcbiAgICAgICAgICBwYXlsb2FkLnBlcm1pc3Npb25VaWRcbiAgICAgICAgKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKGRhdGEpID0+IFtcbiAgICAgICAgICAgIG5ldyBVc2VyR3JvdXBBY3Rpb25zLkFzc2lnblBlcm1pc3Npb25TdWNjZXNzKHtcbiAgICAgICAgICAgICAgcGVybWlzc2lvblVpZDogZGF0YS5pZCxcbiAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGRhdGEuc2VsZWN0ZWQsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgIF0pLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICBuZXcgVXNlckdyb3VwQWN0aW9ucy5Bc3NpZ25QZXJtaXNzaW9uRmFpbCh7XG4gICAgICAgICAgICAgICAgdXNlckdyb3VwSWQ6IHBheWxvYWQudXNlckdyb3VwSWQsXG4gICAgICAgICAgICAgICAgcGVybWlzc2lvblVpZDogcGF5bG9hZC5wZXJtaXNzaW9uVWlkLFxuICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgIClcbiAgKTtcblxuICBARWZmZWN0KClcbiAgYXNzaWduTWVtYmVyVW5pdFVzZXJHcm91cCQ6IE9ic2VydmFibGU8XG4gICAgfCBVc2VyR3JvdXBBY3Rpb25zLkFzc2lnbk1lbWJlclN1Y2Nlc3NcbiAgICB8IFVzZXJHcm91cEFjdGlvbnMuQXNzaWduTWVtYmVyRmFpbFxuICAgIHwgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGFcbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICBvZlR5cGUoVXNlckdyb3VwQWN0aW9ucy5VU0VSX0dST1VQX0FTU0lHTl9NRU1CRVIpLFxuICAgIG1hcCgoYWN0aW9uOiBVc2VyR3JvdXBBY3Rpb25zLkFzc2lnbk1lbWJlcikgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgIG1lcmdlTWFwKChwYXlsb2FkKSA9PlxuICAgICAgdGhpcy51c2VyR3JvdXBDb25uZWN0b3JcbiAgICAgICAgLmFzc2lnbk1lbWJlcihwYXlsb2FkLnVzZXJJZCwgcGF5bG9hZC51c2VyR3JvdXBJZCwgcGF5bG9hZC5jdXN0b21lcklkKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKCkgPT4gW1xuICAgICAgICAgICAgbmV3IFVzZXJHcm91cEFjdGlvbnMuQXNzaWduTWVtYmVyU3VjY2Vzcyh7XG4gICAgICAgICAgICAgIGN1c3RvbWVySWQ6IHBheWxvYWQuY3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHRydWUsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgIF0pLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICBuZXcgVXNlckdyb3VwQWN0aW9ucy5Bc3NpZ25NZW1iZXJGYWlsKHtcbiAgICAgICAgICAgICAgICB1c2VyR3JvdXBJZDogcGF5bG9hZC51c2VyR3JvdXBJZCxcbiAgICAgICAgICAgICAgICBjdXN0b21lcklkOiBwYXlsb2FkLmN1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgKVxuICApO1xuXG4gIEBFZmZlY3QoKVxuICB1bmFzc2lnbk1lbWJlckZyb21Vc2VyR3JvdXAkOiBPYnNlcnZhYmxlPFxuICAgIHwgVXNlckdyb3VwQWN0aW9ucy5VbmFzc2lnbk1lbWJlclN1Y2Nlc3NcbiAgICB8IFVzZXJHcm91cEFjdGlvbnMuVW5hc3NpZ25NZW1iZXJGYWlsXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShVc2VyR3JvdXBBY3Rpb25zLlVTRVJfR1JPVVBfVU5BU1NJR05fTUVNQkVSKSxcbiAgICBtYXAoKGFjdGlvbjogVXNlckdyb3VwQWN0aW9ucy5VbmFzc2lnbk1lbWJlcikgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgIG1lcmdlTWFwKChwYXlsb2FkKSA9PlxuICAgICAgdGhpcy51c2VyR3JvdXBDb25uZWN0b3JcbiAgICAgICAgLnVuYXNzaWduTWVtYmVyKHBheWxvYWQudXNlcklkLCBwYXlsb2FkLnVzZXJHcm91cElkLCBwYXlsb2FkLmN1c3RvbWVySWQpXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIHN3aXRjaE1hcCgoKSA9PiBbXG4gICAgICAgICAgICBuZXcgVXNlckdyb3VwQWN0aW9ucy5VbmFzc2lnbk1lbWJlclN1Y2Nlc3Moe1xuICAgICAgICAgICAgICBjdXN0b21lcklkOiBwYXlsb2FkLmN1c3RvbWVySWQsXG4gICAgICAgICAgICAgIHNlbGVjdGVkOiBmYWxzZSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgXSksXG4gICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICAgIG5ldyBVc2VyR3JvdXBBY3Rpb25zLlVuYXNzaWduTWVtYmVyRmFpbCh7XG4gICAgICAgICAgICAgICAgdXNlckdyb3VwSWQ6IHBheWxvYWQudXNlckdyb3VwSWQsXG4gICAgICAgICAgICAgICAgY3VzdG9tZXJJZDogcGF5bG9hZC5jdXN0b21lcklkLFxuICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgIClcbiAgKTtcblxuICBARWZmZWN0KClcbiAgdW5hc3NpZ25QZXJtaXNzaW9uRnJvbVVzZXJHcm91cCQ6IE9ic2VydmFibGU8XG4gICAgfCBVc2VyR3JvdXBBY3Rpb25zLlVuYXNzaWduUGVybWlzc2lvblN1Y2Nlc3NcbiAgICB8IFVzZXJHcm91cEFjdGlvbnMuVW5hc3NpZ25QZXJtaXNzaW9uRmFpbFxuICAgIHwgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGFcbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICBvZlR5cGUoVXNlckdyb3VwQWN0aW9ucy5VU0VSX0dST1VQX1VOQVNTSUdOX1BFUk1JU1NJT04pLFxuICAgIG1hcCgoYWN0aW9uOiBVc2VyR3JvdXBBY3Rpb25zLlVuYXNzaWduUGVybWlzc2lvbikgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgIG1lcmdlTWFwKChwYXlsb2FkKSA9PlxuICAgICAgdGhpcy51c2VyR3JvdXBDb25uZWN0b3JcbiAgICAgICAgLnVuYXNzaWduT3JkZXJBcHByb3ZhbFBlcm1pc3Npb24oXG4gICAgICAgICAgcGF5bG9hZC51c2VySWQsXG4gICAgICAgICAgcGF5bG9hZC51c2VyR3JvdXBJZCxcbiAgICAgICAgICBwYXlsb2FkLnBlcm1pc3Npb25VaWRcbiAgICAgICAgKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKGRhdGEpID0+IFtcbiAgICAgICAgICAgIG5ldyBVc2VyR3JvdXBBY3Rpb25zLlVuYXNzaWduUGVybWlzc2lvblN1Y2Nlc3Moe1xuICAgICAgICAgICAgICBwZXJtaXNzaW9uVWlkOiBkYXRhLmlkLFxuICAgICAgICAgICAgICBzZWxlY3RlZDogZGF0YS5zZWxlY3RlZCxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgXSksXG4gICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICAgIG5ldyBVc2VyR3JvdXBBY3Rpb25zLlVuYXNzaWduUGVybWlzc2lvbkZhaWwoe1xuICAgICAgICAgICAgICAgIHVzZXJHcm91cElkOiBwYXlsb2FkLnVzZXJHcm91cElkLFxuICAgICAgICAgICAgICAgIHBlcm1pc3Npb25VaWQ6IHBheWxvYWQucGVybWlzc2lvblVpZCxcbiAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgXSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICApXG4gICk7XG5cbiAgQEVmZmVjdCgpXG4gIHVuYXNzaWduQWxsTWVtYmVyc0Zyb21Vc2VyR3JvdXAkOiBPYnNlcnZhYmxlPFxuICAgIHwgVXNlckdyb3VwQWN0aW9ucy5VbmFzc2lnbkFsbE1lbWJlcnNTdWNjZXNzXG4gICAgfCBVc2VyR3JvdXBBY3Rpb25zLlVuYXNzaWduQWxsTWVtYmVyc0ZhaWxcbiAgICB8IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhXG4gID4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgb2ZUeXBlKFVzZXJHcm91cEFjdGlvbnMuVVNFUl9HUk9VUF9VTkFTU0lHTl9BTExfTUVNQkVSUyksXG4gICAgbWFwKChhY3Rpb246IFVzZXJHcm91cEFjdGlvbnMuVW5hc3NpZ25BbGxNZW1iZXJzKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgc3dpdGNoTWFwKChwYXlsb2FkKSA9PlxuICAgICAgdGhpcy51c2VyR3JvdXBDb25uZWN0b3JcbiAgICAgICAgLnVuYXNzaWduQWxsTWVtYmVycyhwYXlsb2FkLnVzZXJJZCwgcGF5bG9hZC51c2VyR3JvdXBJZClcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgc3dpdGNoTWFwKCgpID0+IFtcbiAgICAgICAgICAgIG5ldyBVc2VyR3JvdXBBY3Rpb25zLlVuYXNzaWduQWxsTWVtYmVyc1N1Y2Nlc3Moe1xuICAgICAgICAgICAgICBzZWxlY3RlZDogZmFsc2UsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgIF0pLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICBuZXcgVXNlckdyb3VwQWN0aW9ucy5VbmFzc2lnbkFsbE1lbWJlcnNGYWlsKHtcbiAgICAgICAgICAgICAgICB1c2VyR3JvdXBJZDogcGF5bG9hZC51c2VyR3JvdXBJZCxcbiAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgXSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICApXG4gICk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBhY3Rpb25zJDogQWN0aW9ucyxcbiAgICBwcml2YXRlIHVzZXJHcm91cENvbm5lY3RvcjogVXNlckdyb3VwQ29ubmVjdG9yXG4gICkge31cbn1cbiJdfQ==