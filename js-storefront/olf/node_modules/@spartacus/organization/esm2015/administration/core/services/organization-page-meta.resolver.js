import { Injectable } from '@angular/core';
import { PageMetaResolver, PageType, } from '@spartacus/core';
import { combineLatest, defer, of } from 'rxjs';
import { distinctUntilChanged, map, shareReplay, switchMap, } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@spartacus/core";
/**
 * Resolves the page data for Organization Pages.
 *
 * Breadcrumbs are built in this implementation only.
 *
 * @property {string} ORGANIZATION_SEMANTIC_ROUTE the default root path for organization pages.
 * @property {string} ORGANIZATION_TRANSLATION_KEY the default i18n key for the organization breadcrumb label.
 */
export class OrganizationPageMetaResolver extends PageMetaResolver {
    constructor(contentPageMetaResolver, translation, semanticPath, routingService) {
        super();
        this.contentPageMetaResolver = contentPageMetaResolver;
        this.translation = translation;
        this.semanticPath = semanticPath;
        this.routingService = routingService;
        this.pageTemplate = 'CompanyPageTemplate';
        this.pageType = PageType.CONTENT_PAGE;
        /**
         * Translation key for the breadcrumb of Organization home page
         */
        this.ORGANIZATION_TRANSLATION_KEY = 'organization.breadcrumb';
        /**
         * The semantic route of the organization landing page. It's used to recognize whether
         * we are on this page. In such a case we avoid showing the breadcrumb for this page.
         */
        this.ORGANIZATION_SEMANTIC_ROUTE = 'organization';
        /**
         * Breadcrumb of the Organization page.
         * It's empty when the current page is the Organization page.
         */
        this.organizationPageBreadcrumb$ = defer(() => this.routingService.getRouterState()).pipe(map((routerState) => { var _a; return (_a = routerState === null || routerState === void 0 ? void 0 : routerState.state) === null || _a === void 0 ? void 0 : _a.semanticRoute; }), distinctUntilChanged(), switchMap((semanticRoute) => semanticRoute === this.ORGANIZATION_SEMANTIC_ROUTE
            ? of([])
            : this.translation.translate(this.ORGANIZATION_TRANSLATION_KEY).pipe(map((label) => [
                {
                    label,
                    link: this.semanticPath.get(this.ORGANIZATION_SEMANTIC_ROUTE),
                },
            ]))));
        /**
         * Breadcrumbs returned in the method #resolveBreadcrumbs.
         */
        this.breadcrumbs$ = combineLatest([
            this.organizationPageBreadcrumb$,
            defer(() => this.contentPageMetaResolver.resolveBreadcrumbs()),
        ]).pipe(map(([organizationPageBreadcrumb, breadcrumbs = []]) => {
            const [home, ...restBreadcrumbs] = breadcrumbs;
            return [home, ...organizationPageBreadcrumb, ...restBreadcrumbs];
        }), shareReplay({ bufferSize: 1, refCount: true }));
    }
    resolveTitle() {
        return this.contentPageMetaResolver.resolveTitle();
    }
    resolveDescription() {
        return this.contentPageMetaResolver.resolveDescription();
    }
    resolveRobots() {
        return this.contentPageMetaResolver.resolveRobots();
    }
    /**
     * Returns list of breadcrumbs for:
     * - the home page
     * - the organization home page
     * - the organization's child pages (i.e. cost center list)
     * - sub-routes of the organization's child pages (i.e. cost center details, edit cost center, ...)
     */
    resolveBreadcrumbs() {
        return this.breadcrumbs$;
    }
}
OrganizationPageMetaResolver.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: OrganizationPageMetaResolver, deps: [{ token: i1.ContentPageMetaResolver }, { token: i1.TranslationService }, { token: i1.SemanticPathService }, { token: i1.RoutingService }], target: i0.ɵɵFactoryTarget.Injectable });
OrganizationPageMetaResolver.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: OrganizationPageMetaResolver, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: OrganizationPageMetaResolver, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }], ctorParameters: function () { return [{ type: i1.ContentPageMetaResolver }, { type: i1.TranslationService }, { type: i1.SemanticPathService }, { type: i1.RoutingService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3JnYW5pemF0aW9uLXBhZ2UtbWV0YS5yZXNvbHZlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2ZlYXR1cmUtbGlicy9vcmdhbml6YXRpb24vYWRtaW5pc3RyYXRpb24vY29yZS9zZXJ2aWNlcy9vcmdhbml6YXRpb24tcGFnZS1tZXRhLnJlc29sdmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUtMLGdCQUFnQixFQUloQixRQUFRLEdBSVQsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QixPQUFPLEVBQUUsYUFBYSxFQUFFLEtBQUssRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDNUQsT0FBTyxFQUNMLG9CQUFvQixFQUNwQixHQUFHLEVBQ0gsV0FBVyxFQUNYLFNBQVMsR0FDVixNQUFNLGdCQUFnQixDQUFDOzs7QUFFeEI7Ozs7Ozs7R0FPRztBQUlILE1BQU0sT0FBTyw0QkFDWCxTQUFRLGdCQUFnQjtJQXFCeEIsWUFDWSx1QkFBZ0QsRUFDaEQsV0FBK0IsRUFDL0IsWUFBaUMsRUFDakMsY0FBOEI7UUFFeEMsS0FBSyxFQUFFLENBQUM7UUFMRSw0QkFBdUIsR0FBdkIsdUJBQXVCLENBQXlCO1FBQ2hELGdCQUFXLEdBQVgsV0FBVyxDQUFvQjtRQUMvQixpQkFBWSxHQUFaLFlBQVksQ0FBcUI7UUFDakMsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBbEIxQyxpQkFBWSxHQUFHLHFCQUFxQixDQUFDO1FBQ3JDLGFBQVEsR0FBRyxRQUFRLENBQUMsWUFBWSxDQUFDO1FBRWpDOztXQUVHO1FBQ2dCLGlDQUE0QixHQUFHLHlCQUF5QixDQUFDO1FBRTVFOzs7V0FHRztRQUNnQixnQ0FBMkIsR0FBRyxjQUFjLENBQUM7UUFrQ2hFOzs7V0FHRztRQUNPLGdDQUEyQixHQUFpQyxLQUFLLENBQ3pFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsY0FBYyxFQUFFLENBQzNDLENBQUMsSUFBSSxDQUNKLEdBQUcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxFQUFFLFdBQUMsT0FBQSxNQUFBLFdBQVcsYUFBWCxXQUFXLHVCQUFYLFdBQVcsQ0FBRSxLQUFLLDBDQUFFLGFBQWEsQ0FBQSxFQUFBLENBQUMsRUFDdkQsb0JBQW9CLEVBQUUsRUFDdEIsU0FBUyxDQUFDLENBQUMsYUFBYSxFQUFFLEVBQUUsQ0FDMUIsYUFBYSxLQUFLLElBQUksQ0FBQywyQkFBMkI7WUFDaEQsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7WUFDUixDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLDRCQUE0QixDQUFDLENBQUMsSUFBSSxDQUNoRSxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDO2dCQUNiO29CQUNFLEtBQUs7b0JBQ0wsSUFBSSxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQywyQkFBMkIsQ0FBQztpQkFDOUQ7YUFDRixDQUFDLENBQ0gsQ0FDTixDQUNGLENBQUM7UUFFRjs7V0FFRztRQUNPLGlCQUFZLEdBQWlDLGFBQWEsQ0FBQztZQUNuRSxJQUFJLENBQUMsMkJBQTJCO1lBQ2hDLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztTQUMvRCxDQUFDLENBQUMsSUFBSSxDQUNMLEdBQUcsQ0FBQyxDQUFDLENBQUMsMEJBQTBCLEVBQUUsV0FBVyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDckQsTUFBTSxDQUFDLElBQUksRUFBRSxHQUFHLGVBQWUsQ0FBQyxHQUFHLFdBQVcsQ0FBQztZQUMvQyxPQUFPLENBQUMsSUFBSSxFQUFFLEdBQUcsMEJBQTBCLEVBQUUsR0FBRyxlQUFlLENBQUMsQ0FBQztRQUNuRSxDQUFDLENBQUMsRUFDRixXQUFXLENBQUMsRUFBRSxVQUFVLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUMvQyxDQUFDO0lBNURGLENBQUM7SUFFRCxZQUFZO1FBQ1YsT0FBTyxJQUFJLENBQUMsdUJBQXVCLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDckQsQ0FBQztJQUVELGtCQUFrQjtRQUNoQixPQUFPLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO0lBQzNELENBQUM7SUFFRCxhQUFhO1FBQ1gsT0FBTyxJQUFJLENBQUMsdUJBQXVCLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdEQsQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNILGtCQUFrQjtRQUNoQixPQUFPLElBQUksQ0FBQyxZQUFZLENBQUM7SUFDM0IsQ0FBQzs7eUhBcERVLDRCQUE0Qjs2SEFBNUIsNEJBQTRCLGNBRjNCLE1BQU07MkZBRVAsNEJBQTRCO2tCQUh4QyxVQUFVO21CQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIEJyZWFkY3J1bWJNZXRhLFxuICBDb250ZW50UGFnZU1ldGFSZXNvbHZlcixcbiAgUGFnZUJyZWFkY3J1bWJSZXNvbHZlcixcbiAgUGFnZURlc2NyaXB0aW9uUmVzb2x2ZXIsXG4gIFBhZ2VNZXRhUmVzb2x2ZXIsXG4gIFBhZ2VSb2JvdHNNZXRhLFxuICBQYWdlUm9ib3RzUmVzb2x2ZXIsXG4gIFBhZ2VUaXRsZVJlc29sdmVyLFxuICBQYWdlVHlwZSxcbiAgUm91dGluZ1NlcnZpY2UsXG4gIFNlbWFudGljUGF0aFNlcnZpY2UsXG4gIFRyYW5zbGF0aW9uU2VydmljZSxcbn0gZnJvbSAnQHNwYXJ0YWN1cy9jb3JlJztcbmltcG9ydCB7IGNvbWJpbmVMYXRlc3QsIGRlZmVyLCBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtcbiAgZGlzdGluY3RVbnRpbENoYW5nZWQsXG4gIG1hcCxcbiAgc2hhcmVSZXBsYXksXG4gIHN3aXRjaE1hcCxcbn0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG4vKipcbiAqIFJlc29sdmVzIHRoZSBwYWdlIGRhdGEgZm9yIE9yZ2FuaXphdGlvbiBQYWdlcy5cbiAqXG4gKiBCcmVhZGNydW1icyBhcmUgYnVpbHQgaW4gdGhpcyBpbXBsZW1lbnRhdGlvbiBvbmx5LlxuICpcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBPUkdBTklaQVRJT05fU0VNQU5USUNfUk9VVEUgdGhlIGRlZmF1bHQgcm9vdCBwYXRoIGZvciBvcmdhbml6YXRpb24gcGFnZXMuXG4gKiBAcHJvcGVydHkge3N0cmluZ30gT1JHQU5JWkFUSU9OX1RSQU5TTEFUSU9OX0tFWSB0aGUgZGVmYXVsdCBpMThuIGtleSBmb3IgdGhlIG9yZ2FuaXphdGlvbiBicmVhZGNydW1iIGxhYmVsLlxuICovXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290Jyxcbn0pXG5leHBvcnQgY2xhc3MgT3JnYW5pemF0aW9uUGFnZU1ldGFSZXNvbHZlclxuICBleHRlbmRzIFBhZ2VNZXRhUmVzb2x2ZXJcbiAgaW1wbGVtZW50c1xuICAgIFBhZ2VCcmVhZGNydW1iUmVzb2x2ZXIsXG4gICAgUGFnZVRpdGxlUmVzb2x2ZXIsXG4gICAgUGFnZURlc2NyaXB0aW9uUmVzb2x2ZXIsXG4gICAgUGFnZVJvYm90c1Jlc29sdmVyXG57XG4gIHBhZ2VUZW1wbGF0ZSA9ICdDb21wYW55UGFnZVRlbXBsYXRlJztcbiAgcGFnZVR5cGUgPSBQYWdlVHlwZS5DT05URU5UX1BBR0U7XG5cbiAgLyoqXG4gICAqIFRyYW5zbGF0aW9uIGtleSBmb3IgdGhlIGJyZWFkY3J1bWIgb2YgT3JnYW5pemF0aW9uIGhvbWUgcGFnZVxuICAgKi9cbiAgcHJvdGVjdGVkIHJlYWRvbmx5IE9SR0FOSVpBVElPTl9UUkFOU0xBVElPTl9LRVkgPSAnb3JnYW5pemF0aW9uLmJyZWFkY3J1bWInO1xuXG4gIC8qKlxuICAgKiBUaGUgc2VtYW50aWMgcm91dGUgb2YgdGhlIG9yZ2FuaXphdGlvbiBsYW5kaW5nIHBhZ2UuIEl0J3MgdXNlZCB0byByZWNvZ25pemUgd2hldGhlclxuICAgKiB3ZSBhcmUgb24gdGhpcyBwYWdlLiBJbiBzdWNoIGEgY2FzZSB3ZSBhdm9pZCBzaG93aW5nIHRoZSBicmVhZGNydW1iIGZvciB0aGlzIHBhZ2UuXG4gICAqL1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgT1JHQU5JWkFUSU9OX1NFTUFOVElDX1JPVVRFID0gJ29yZ2FuaXphdGlvbic7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIGNvbnRlbnRQYWdlTWV0YVJlc29sdmVyOiBDb250ZW50UGFnZU1ldGFSZXNvbHZlcixcbiAgICBwcm90ZWN0ZWQgdHJhbnNsYXRpb246IFRyYW5zbGF0aW9uU2VydmljZSxcbiAgICBwcm90ZWN0ZWQgc2VtYW50aWNQYXRoOiBTZW1hbnRpY1BhdGhTZXJ2aWNlLFxuICAgIHByb3RlY3RlZCByb3V0aW5nU2VydmljZTogUm91dGluZ1NlcnZpY2VcbiAgKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIHJlc29sdmVUaXRsZSgpOiBPYnNlcnZhYmxlPHN0cmluZyB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLmNvbnRlbnRQYWdlTWV0YVJlc29sdmVyLnJlc29sdmVUaXRsZSgpO1xuICB9XG5cbiAgcmVzb2x2ZURlc2NyaXB0aW9uKCk6IE9ic2VydmFibGU8c3RyaW5nIHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMuY29udGVudFBhZ2VNZXRhUmVzb2x2ZXIucmVzb2x2ZURlc2NyaXB0aW9uKCk7XG4gIH1cblxuICByZXNvbHZlUm9ib3RzKCk6IE9ic2VydmFibGU8UGFnZVJvYm90c01ldGFbXT4ge1xuICAgIHJldHVybiB0aGlzLmNvbnRlbnRQYWdlTWV0YVJlc29sdmVyLnJlc29sdmVSb2JvdHMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGxpc3Qgb2YgYnJlYWRjcnVtYnMgZm9yOlxuICAgKiAtIHRoZSBob21lIHBhZ2VcbiAgICogLSB0aGUgb3JnYW5pemF0aW9uIGhvbWUgcGFnZVxuICAgKiAtIHRoZSBvcmdhbml6YXRpb24ncyBjaGlsZCBwYWdlcyAoaS5lLiBjb3N0IGNlbnRlciBsaXN0KVxuICAgKiAtIHN1Yi1yb3V0ZXMgb2YgdGhlIG9yZ2FuaXphdGlvbidzIGNoaWxkIHBhZ2VzIChpLmUuIGNvc3QgY2VudGVyIGRldGFpbHMsIGVkaXQgY29zdCBjZW50ZXIsIC4uLilcbiAgICovXG4gIHJlc29sdmVCcmVhZGNydW1icygpOiBPYnNlcnZhYmxlPEJyZWFkY3J1bWJNZXRhW10+IHtcbiAgICByZXR1cm4gdGhpcy5icmVhZGNydW1icyQ7XG4gIH1cblxuICAvKipcbiAgICogQnJlYWRjcnVtYiBvZiB0aGUgT3JnYW5pemF0aW9uIHBhZ2UuXG4gICAqIEl0J3MgZW1wdHkgd2hlbiB0aGUgY3VycmVudCBwYWdlIGlzIHRoZSBPcmdhbml6YXRpb24gcGFnZS5cbiAgICovXG4gIHByb3RlY3RlZCBvcmdhbml6YXRpb25QYWdlQnJlYWRjcnVtYiQ6IE9ic2VydmFibGU8QnJlYWRjcnVtYk1ldGFbXT4gPSBkZWZlcihcbiAgICAoKSA9PiB0aGlzLnJvdXRpbmdTZXJ2aWNlLmdldFJvdXRlclN0YXRlKClcbiAgKS5waXBlKFxuICAgIG1hcCgocm91dGVyU3RhdGUpID0+IHJvdXRlclN0YXRlPy5zdGF0ZT8uc2VtYW50aWNSb3V0ZSksXG4gICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKSxcbiAgICBzd2l0Y2hNYXAoKHNlbWFudGljUm91dGUpID0+XG4gICAgICBzZW1hbnRpY1JvdXRlID09PSB0aGlzLk9SR0FOSVpBVElPTl9TRU1BTlRJQ19ST1VURVxuICAgICAgICA/IG9mKFtdKVxuICAgICAgICA6IHRoaXMudHJhbnNsYXRpb24udHJhbnNsYXRlKHRoaXMuT1JHQU5JWkFUSU9OX1RSQU5TTEFUSU9OX0tFWSkucGlwZShcbiAgICAgICAgICAgIG1hcCgobGFiZWwpID0+IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGxhYmVsLFxuICAgICAgICAgICAgICAgIGxpbms6IHRoaXMuc2VtYW50aWNQYXRoLmdldCh0aGlzLk9SR0FOSVpBVElPTl9TRU1BTlRJQ19ST1VURSksXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIClcbiAgICApXG4gICk7XG5cbiAgLyoqXG4gICAqIEJyZWFkY3J1bWJzIHJldHVybmVkIGluIHRoZSBtZXRob2QgI3Jlc29sdmVCcmVhZGNydW1icy5cbiAgICovXG4gIHByb3RlY3RlZCBicmVhZGNydW1icyQ6IE9ic2VydmFibGU8QnJlYWRjcnVtYk1ldGFbXT4gPSBjb21iaW5lTGF0ZXN0KFtcbiAgICB0aGlzLm9yZ2FuaXphdGlvblBhZ2VCcmVhZGNydW1iJCxcbiAgICBkZWZlcigoKSA9PiB0aGlzLmNvbnRlbnRQYWdlTWV0YVJlc29sdmVyLnJlc29sdmVCcmVhZGNydW1icygpKSxcbiAgXSkucGlwZShcbiAgICBtYXAoKFtvcmdhbml6YXRpb25QYWdlQnJlYWRjcnVtYiwgYnJlYWRjcnVtYnMgPSBbXV0pID0+IHtcbiAgICAgIGNvbnN0IFtob21lLCAuLi5yZXN0QnJlYWRjcnVtYnNdID0gYnJlYWRjcnVtYnM7XG4gICAgICByZXR1cm4gW2hvbWUsIC4uLm9yZ2FuaXphdGlvblBhZ2VCcmVhZGNydW1iLCAuLi5yZXN0QnJlYWRjcnVtYnNdO1xuICAgIH0pLFxuICAgIHNoYXJlUmVwbGF5KHsgYnVmZmVyU2l6ZTogMSwgcmVmQ291bnQ6IHRydWUgfSlcbiAgKTtcbn1cbiJdfQ==