import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { Effect, ofType } from '@ngrx/effects';
import { from, of } from 'rxjs';
import { catchError, map, switchMap, groupBy, mergeMap } from 'rxjs/operators';
import { normalizeHttpError, StateUtils, } from '@spartacus/core';
import { CostCenterActions, BudgetActions, OrganizationActions, } from '../actions/index';
import * as i0 from "@angular/core";
import * as i1 from "@ngrx/effects";
import * as i2 from "../../connectors/cost-center/cost-center.connector";
export class CostCenterEffects {
    constructor(actions$, costCenterConnector) {
        this.actions$ = actions$;
        this.costCenterConnector = costCenterConnector;
        this.loadCostCenter$ = this.actions$.pipe(ofType(CostCenterActions.LOAD_COST_CENTER), map((action) => action.payload), switchMap(({ userId, costCenterCode }) => {
            return this.costCenterConnector.get(userId, costCenterCode).pipe(map((costCenter) => {
                return new CostCenterActions.LoadCostCenterSuccess([costCenter]);
            }), catchError((error) => of(new CostCenterActions.LoadCostCenterFail({
                costCenterCode,
                error: normalizeHttpError(error),
            }))));
        }));
        this.loadCostCenters$ = this.actions$.pipe(ofType(CostCenterActions.LOAD_COST_CENTERS), map((action) => action.payload), switchMap((payload) => this.costCenterConnector.getList(payload.userId, payload.params).pipe(switchMap((costCenters) => {
            const { values, page } = StateUtils.normalizeListPage(costCenters, 'code');
            return [
                new CostCenterActions.LoadCostCenterSuccess(values),
                new CostCenterActions.LoadCostCentersSuccess({
                    page,
                    params: payload.params,
                }),
            ];
        }), catchError((error) => of(new CostCenterActions.LoadCostCentersFail({
            params: payload.params,
            error: normalizeHttpError(error),
        }))))));
        this.createCostCenter$ = this.actions$.pipe(ofType(CostCenterActions.CREATE_COST_CENTER), map((action) => action.payload), switchMap((payload) => this.costCenterConnector.create(payload.userId, payload.costCenter).pipe(switchMap((data) => [
            new CostCenterActions.CreateCostCenterSuccess(data),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new CostCenterActions.CreateCostCenterFail({
                costCenterCode: payload.costCenter.code,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.updateCostCenter$ = this.actions$.pipe(ofType(CostCenterActions.UPDATE_COST_CENTER), map((action) => action.payload), switchMap((payload) => this.costCenterConnector
            .update(payload.userId, payload.costCenterCode, payload.costCenter)
            .pipe(switchMap((data) => [
            new CostCenterActions.UpdateCostCenterSuccess(data),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new CostCenterActions.UpdateCostCenterFail({
                costCenterCode: payload.costCenter.code,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.loadAssignedBudgets$ = this.actions$.pipe(ofType(CostCenterActions.LOAD_ASSIGNED_BUDGETS), map((action) => action.payload), groupBy(({ costCenterCode, params }) => StateUtils.serializeParams(costCenterCode, params)), mergeMap((group) => group.pipe(switchMap(({ userId, costCenterCode, params }) => this.costCenterConnector
            .getBudgets(userId, costCenterCode, params)
            .pipe(switchMap((budgets) => {
            const { values, page } = StateUtils.normalizeListPage(budgets, 'code');
            return [
                new BudgetActions.LoadBudgetSuccess(values),
                new CostCenterActions.LoadAssignedBudgetsSuccess({
                    costCenterCode,
                    page,
                    params,
                }),
            ];
        }), catchError((error) => of(new CostCenterActions.LoadAssignedBudgetsFail({
            costCenterCode,
            params,
            error: normalizeHttpError(error),
        }))))))));
        this.assignBudgetToCostCenter$ = this.actions$.pipe(ofType(CostCenterActions.ASSIGN_BUDGET), map((action) => action.payload), mergeMap(({ userId, costCenterCode, budgetCode }) => this.costCenterConnector
            .assignBudget(userId, costCenterCode, budgetCode)
            .pipe(switchMap(() => [
            new CostCenterActions.AssignBudgetSuccess({
                code: budgetCode,
                selected: true,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new CostCenterActions.AssignBudgetFail({
                budgetCode,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
        this.unassignBudgetToCostCenter$ = this.actions$.pipe(ofType(CostCenterActions.UNASSIGN_BUDGET), map((action) => action.payload), mergeMap(({ userId, costCenterCode, budgetCode }) => this.costCenterConnector
            .unassignBudget(userId, costCenterCode, budgetCode)
            .pipe(switchMap(() => [
            new CostCenterActions.UnassignBudgetSuccess({
                code: budgetCode,
                selected: false,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new CostCenterActions.UnassignBudgetFail({
                budgetCode,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ])))));
    }
}
CostCenterEffects.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: CostCenterEffects, deps: [{ token: i1.Actions }, { token: i2.CostCenterConnector }], target: i0.ɵɵFactoryTarget.Injectable });
CostCenterEffects.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: CostCenterEffects });
__decorate([
    Effect()
], CostCenterEffects.prototype, "loadCostCenter$", void 0);
__decorate([
    Effect()
], CostCenterEffects.prototype, "loadCostCenters$", void 0);
__decorate([
    Effect()
], CostCenterEffects.prototype, "createCostCenter$", void 0);
__decorate([
    Effect()
], CostCenterEffects.prototype, "updateCostCenter$", void 0);
__decorate([
    Effect()
], CostCenterEffects.prototype, "loadAssignedBudgets$", void 0);
__decorate([
    Effect()
], CostCenterEffects.prototype, "assignBudgetToCostCenter$", void 0);
__decorate([
    Effect()
], CostCenterEffects.prototype, "unassignBudgetToCostCenter$", void 0);
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: CostCenterEffects, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.Actions }, { type: i2.CostCenterConnector }]; }, propDecorators: { loadCostCenter$: [], loadCostCenters$: [], createCostCenter$: [], updateCostCenter$: [], loadAssignedBudgets$: [], assignBudgetToCostCenter$: [], unassignBudgetToCostCenter$: [] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29zdC1jZW50ZXIuZWZmZWN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL29yZ2FuaXphdGlvbi9hZG1pbmlzdHJhdGlvbi9jb3JlL3N0b3JlL2VmZmVjdHMvY29zdC1jZW50ZXIuZWZmZWN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBVyxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hELE9BQU8sRUFBRSxJQUFJLEVBQWMsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDL0UsT0FBTyxFQUdMLGtCQUFrQixFQUNsQixVQUFVLEdBQ1gsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QixPQUFPLEVBQ0wsaUJBQWlCLEVBQ2pCLGFBQWEsRUFDYixtQkFBbUIsR0FDcEIsTUFBTSxrQkFBa0IsQ0FBQzs7OztBQU0xQixNQUFNLE9BQU8saUJBQWlCO0lBa081QixZQUNVLFFBQWlCLEVBQ2pCLG1CQUF3QztRQUR4QyxhQUFRLEdBQVIsUUFBUSxDQUFTO1FBQ2pCLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBcUI7UUFsT2xELG9CQUFlLEdBR1gsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQ3BCLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUMxQyxHQUFHLENBQUMsQ0FBQyxNQUF3QyxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQ2pFLFNBQVMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLGNBQWMsRUFBRSxFQUFFLEVBQUU7WUFDdkMsT0FBTyxJQUFJLENBQUMsbUJBQW1CLENBQUMs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RUFBRSxDQUN0QyxJQUFJLENBQUM7WUFDSCxJQUFJLGlCQUFpQixDQUFDLGtCQUFrQixDQUFDO2dCQUN2QyxVQUFVO2dCQUNWLEtBQUssRUFBRSxrQkFBa0IsQ0FBQyxLQUFLLENBQUM7YUFDakMsQ0FBQztZQUNGLElBQUksbUJBQW1CLENBQUMscUJBQXFCLEVBQUU7U0FDaEQsQ0FBQyxDQUNILENBQ0YsQ0FDSixDQUNGLENBQUM7SUFLQyxDQUFDOzs4R0FyT08saUJBQWlCO2tIQUFqQixpQkFBaUI7QUFFNUI7SUFEQyxNQUFNLEVBQUU7MERBc0JQO0FBR0Y7SUFEQyxNQUFNLEVBQUU7MkRBaUNQO0FBR0Y7SUFEQyxNQUFNLEVBQUU7NERBeUJQO0FBR0Y7SUFEQyxNQUFNLEVBQUU7NERBMkJQO0FBR0Y7SUFEQyxNQUFNLEVBQUU7K0RBNENQO0FBR0Y7SUFEQyxNQUFNLEVBQUU7b0VBOEJQO0FBR0Y7SUFEQyxNQUFNLEVBQUU7c0VBOEJQOzJGQWhPUyxpQkFBaUI7a0JBRDdCLFVBQVU7Z0lBR1QsZUFBZSxNQXdCZixnQkFBZ0IsTUFtQ2hCLGlCQUFpQixNQTJCakIsaUJBQWlCLE1BNkJqQixvQkFBb0IsTUE4Q3BCLHlCQUF5QixNQWdDekIsMkJBQTJCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWN0aW9ucywgRWZmZWN0LCBvZlR5cGUgfSBmcm9tICdAbmdyeC9lZmZlY3RzJztcbmltcG9ydCB7IGZyb20sIE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjYXRjaEVycm9yLCBtYXAsIHN3aXRjaE1hcCwgZ3JvdXBCeSwgbWVyZ2VNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge1xuICBFbnRpdGllc01vZGVsLFxuICBDb3N0Q2VudGVyLFxuICBub3JtYWxpemVIdHRwRXJyb3IsXG4gIFN0YXRlVXRpbHMsXG59IGZyb20gJ0BzcGFydGFjdXMvY29yZSc7XG5pbXBvcnQge1xuICBDb3N0Q2VudGVyQWN0aW9ucyxcbiAgQnVkZ2V0QWN0aW9ucyxcbiAgT3JnYW5pemF0aW9uQWN0aW9ucyxcbn0gZnJvbSAnLi4vYWN0aW9ucy9pbmRleCc7XG5pbXBvcnQgeyBCdWRnZXQgfSBmcm9tICcuLi8uLi9tb2RlbC9idWRnZXQubW9kZWwnO1xuaW1wb3J0IHsgQ29zdENlbnRlckNvbm5lY3RvciB9IGZyb20gJy4uLy4uL2Nvbm5lY3RvcnMvY29zdC1jZW50ZXIvY29zdC1jZW50ZXIuY29ubmVjdG9yJztcbmltcG9ydCB7IEh0dHBFcnJvclJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQ29zdENlbnRlckVmZmVjdHMge1xuICBARWZmZWN0KClcbiAgbG9hZENvc3RDZW50ZXIkOiBPYnNlcnZhYmxlPFxuICAgIHwgQ29zdENlbnRlckFjdGlvbnMuTG9hZENvc3RDZW50ZXJTdWNjZXNzXG4gICAgfCBDb3N0Q2VudGVyQWN0aW9ucy5Mb2FkQ29zdENlbnRlckZhaWxcbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICBvZlR5cGUoQ29zdENlbnRlckFjdGlvbnMuTE9BRF9DT1NUX0NFTlRFUiksXG4gICAgbWFwKChhY3Rpb246IENvc3RDZW50ZXJBY3Rpb25zLkxvYWRDb3N0Q2VudGVyKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgc3dpdGNoTWFwKCh7IHVzZXJJZCwgY29zdENlbnRlckNvZGUgfSkgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuY29zdENlbnRlckNvbm5lY3Rvci5nZXQodXNlcklkLCBjb3N0Q2VudGVyQ29kZSkucGlwZShcbiAgICAgICAgbWFwKChjb3N0Q2VudGVyOiBDb3N0Q2VudGVyKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBDb3N0Q2VudGVyQWN0aW9ucy5Mb2FkQ29zdENlbnRlclN1Y2Nlc3MoW2Nvc3RDZW50ZXJdKTtcbiAgICAgICAgfSksXG4gICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICBvZihcbiAgICAgICAgICAgIG5ldyBDb3N0Q2VudGVyQWN0aW9ucy5Mb2FkQ29zdENlbnRlckZhaWwoe1xuICAgICAgICAgICAgICBjb3N0Q2VudGVyQ29kZSxcbiAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9KVxuICApO1xuXG4gIEBFZmZlY3QoKVxuICBsb2FkQ29zdENlbnRlcnMkOiBPYnNlcnZhYmxlPFxuICAgIHwgQ29zdENlbnRlckFjdGlvbnMuTG9hZENvc3RDZW50ZXJzU3VjY2Vzc1xuICAgIHwgQ29zdENlbnRlckFjdGlvbnMuTG9hZENvc3RDZW50ZXJTdWNjZXNzXG4gICAgfCBDb3N0Q2VudGVyQWN0aW9ucy5Mb2FkQ29zdENlbnRlcnNGYWlsXG4gID4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgb2ZUeXBlKENvc3RDZW50ZXJBY3Rpb25zLkxPQURfQ09TVF9DRU5URVJTKSxcbiAgICBtYXAoKGFjdGlvbjogQ29zdENlbnRlckFjdGlvbnMuTG9hZENvc3RDZW50ZXJzKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgc3dpdGNoTWFwKChwYXlsb2FkKSA9PlxuICAgICAgdGhpcy5jb3N0Q2VudGVyQ29ubmVjdG9yLmdldExpc3QocGF5bG9hZC51c2VySWQsIHBheWxvYWQucGFyYW1zKS5waXBlKFxuICAgICAgICBzd2l0Y2hNYXAoKGNvc3RDZW50ZXJzOiBFbnRpdGllc01vZGVsPENvc3RDZW50ZXI+KSA9PiB7XG4gICAgICAgICAgY29uc3QgeyB2YWx1ZXMsIHBhZ2UgfSA9IFN0YXRlVXRpbHMubm9ybWFsaXplTGlzdFBhZ2UoXG4gICAgICAgICAgICBjb3N0Q2VudGVycyxcbiAgICAgICAgICAgICdjb2RlJ1xuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIG5ldyBDb3N0Q2VudGVyQWN0aW9ucy5Mb2FkQ29zdENlbnRlclN1Y2Nlc3ModmFsdWVzKSxcbiAgICAgICAgICAgIG5ldyBDb3N0Q2VudGVyQWN0aW9ucy5Mb2FkQ29zdENlbnRlcnNTdWNjZXNzKHtcbiAgICAgICAgICAgICAgcGFnZSxcbiAgICAgICAgICAgICAgcGFyYW1zOiBwYXlsb2FkLnBhcmFtcyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIF07XG4gICAgICAgIH0pLFxuICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgb2YoXG4gICAgICAgICAgICBuZXcgQ29zdENlbnRlckFjdGlvbnMuTG9hZENvc3RDZW50ZXJzRmFpbCh7XG4gICAgICAgICAgICAgIHBhcmFtczogcGF5bG9hZC5wYXJhbXMsXG4gICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgQEVmZmVjdCgpXG4gIGNyZWF0ZUNvc3RDZW50ZXIkOiBPYnNlcnZhYmxlPFxuICAgIHwgQ29zdENlbnRlckFjdGlvbnMuQ3JlYXRlQ29zdENlbnRlclN1Y2Nlc3NcbiAgICB8IENvc3RDZW50ZXJBY3Rpb25zLkNyZWF0ZUNvc3RDZW50ZXJGYWlsXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShDb3N0Q2VudGVyQWN0aW9ucy5DUkVBVEVfQ09TVF9DRU5URVIpLFxuICAgIG1hcCgoYWN0aW9uOiBDb3N0Q2VudGVyQWN0aW9ucy5DcmVhdGVDb3N0Q2VudGVyKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgc3dpdGNoTWFwKChwYXlsb2FkKSA9PlxuICAgICAgdGhpcy5jb3N0Q2VudGVyQ29ubmVjdG9yLmNyZWF0ZShwYXlsb2FkLnVzZXJJZCwgcGF5bG9hZC5jb3N0Q2VudGVyKS5waXBlKFxuICAgICAgICBzd2l0Y2hNYXAoKGRhdGEpID0+IFtcbiAgICAgICAgICBuZXcgQ29zdENlbnRlckFjdGlvbnMuQ3JlYXRlQ29zdENlbnRlclN1Y2Nlc3MoZGF0YSksXG4gICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgIF0pLFxuICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICBuZXcgQ29zdENlbnRlckFjdGlvbnMuQ3JlYXRlQ29zdENlbnRlckZhaWwoe1xuICAgICAgICAgICAgICBjb3N0Q2VudGVyQ29kZTogcGF5bG9hZC5jb3N0Q2VudGVyLmNvZGUsXG4gICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICBdKVxuICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIEBFZmZlY3QoKVxuICB1cGRhdGVDb3N0Q2VudGVyJDogT2JzZXJ2YWJsZTxcbiAgICB8IENvc3RDZW50ZXJBY3Rpb25zLlVwZGF0ZUNvc3RDZW50ZXJTdWNjZXNzXG4gICAgfCBDb3N0Q2VudGVyQWN0aW9ucy5VcGRhdGVDb3N0Q2VudGVyRmFpbFxuICAgIHwgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGFcbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICBvZlR5cGUoQ29zdENlbnRlckFjdGlvbnMuVVBEQVRFX0NPU1RfQ0VOVEVSKSxcbiAgICBtYXAoKGFjdGlvbjogQ29zdENlbnRlckFjdGlvbnMuVXBkYXRlQ29zdENlbnRlcikgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgIHN3aXRjaE1hcCgocGF5bG9hZCkgPT5cbiAgICAgIHRoaXMuY29zdENlbnRlckNvbm5lY3RvclxuICAgICAgICAudXBkYXRlKHBheWxvYWQudXNlcklkLCBwYXlsb2FkLmNvc3RDZW50ZXJDb2RlLCBwYXlsb2FkLmNvc3RDZW50ZXIpXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIHN3aXRjaE1hcCgoZGF0YSkgPT4gW1xuICAgICAgICAgICAgbmV3IENvc3RDZW50ZXJBY3Rpb25zLlVwZGF0ZUNvc3RDZW50ZXJTdWNjZXNzKGRhdGEpLFxuICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgXSksXG4gICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICAgIG5ldyBDb3N0Q2VudGVyQWN0aW9ucy5VcGRhdGVDb3N0Q2VudGVyRmFpbCh7XG4gICAgICAgICAgICAgICAgY29zdENlbnRlckNvZGU6IHBheWxvYWQuY29zdENlbnRlci5jb2RlLFxuICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgIClcbiAgKTtcblxuICBARWZmZWN0KClcbiAgbG9hZEFzc2lnbmVkQnVkZ2V0cyQ6IE9ic2VydmFibGU8XG4gICAgfCBDb3N0Q2VudGVyQWN0aW9ucy5Mb2FkQXNzaWduZWRCdWRnZXRzU3VjY2Vzc1xuICAgIHwgQnVkZ2V0QWN0aW9ucy5Mb2FkQnVkZ2V0U3VjY2Vzc1xuICAgIHwgQ29zdENlbnRlckFjdGlvbnMuTG9hZEFzc2lnbmVkQnVkZ2V0c0ZhaWxcbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICBvZlR5cGUoQ29zdENlbnRlckFjdGlvbnMuTE9BRF9BU1NJR05FRF9CVURHRVRTKSxcbiAgICBtYXAoKGFjdGlvbjogQ29zdENlbnRlckFjdGlvbnMuTG9hZEFzc2lnbmVkQnVkZ2V0cykgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgIGdyb3VwQnkoKHsgY29zdENlbnRlckNvZGUsIHBhcmFtcyB9KSA9PlxuICAgICAgU3RhdGVVdGlscy5zZXJpYWxpemVQYXJhbXMoY29zdENlbnRlckNvZGUsIHBhcmFtcylcbiAgICApLFxuICAgIG1lcmdlTWFwKChncm91cCkgPT5cbiAgICAgIGdyb3VwLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcCgoeyB1c2VySWQsIGNvc3RDZW50ZXJDb2RlLCBwYXJhbXMgfSkgPT5cbiAgICAgICAgICB0aGlzLmNvc3RDZW50ZXJDb25uZWN0b3JcbiAgICAgICAgICAgIC5nZXRCdWRnZXRzKHVzZXJJZCwgY29zdENlbnRlckNvZGUsIHBhcmFtcylcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICBzd2l0Y2hNYXAoKGJ1ZGdldHM6IEVudGl0aWVzTW9kZWw8QnVkZ2V0PikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgdmFsdWVzLCBwYWdlIH0gPSBTdGF0ZVV0aWxzLm5vcm1hbGl6ZUxpc3RQYWdlKFxuICAgICAgICAgICAgICAgICAgYnVkZ2V0cyxcbiAgICAgICAgICAgICAgICAgICdjb2RlJ1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICAgIG5ldyBCdWRnZXRBY3Rpb25zLkxvYWRCdWRnZXRTdWNjZXNzKHZhbHVlcyksXG4gICAgICAgICAgICAgICAgICBuZXcgQ29zdENlbnRlckFjdGlvbnMuTG9hZEFzc2lnbmVkQnVkZ2V0c1N1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgICAgICBjb3N0Q2VudGVyQ29kZSxcbiAgICAgICAgICAgICAgICAgICAgcGFnZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLFxuICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgICAgICBvZihcbiAgICAgICAgICAgICAgICAgIG5ldyBDb3N0Q2VudGVyQWN0aW9ucy5Mb2FkQXNzaWduZWRCdWRnZXRzRmFpbCh7XG4gICAgICAgICAgICAgICAgICAgIGNvc3RDZW50ZXJDb2RlLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKVxuICAgIClcbiAgKTtcblxuICBARWZmZWN0KClcbiAgYXNzaWduQnVkZ2V0VG9Db3N0Q2VudGVyJDogT2JzZXJ2YWJsZTxcbiAgICB8IENvc3RDZW50ZXJBY3Rpb25zLkFzc2lnbkJ1ZGdldFN1Y2Nlc3NcbiAgICB8IENvc3RDZW50ZXJBY3Rpb25zLkFzc2lnbkJ1ZGdldEZhaWxcbiAgICB8IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhXG4gID4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgb2ZUeXBlKENvc3RDZW50ZXJBY3Rpb25zLkFTU0lHTl9CVURHRVQpLFxuICAgIG1hcCgoYWN0aW9uOiBDb3N0Q2VudGVyQWN0aW9ucy5Bc3NpZ25CdWRnZXQpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICBtZXJnZU1hcCgoeyB1c2VySWQsIGNvc3RDZW50ZXJDb2RlLCBidWRnZXRDb2RlIH0pID0+XG4gICAgICB0aGlzLmNvc3RDZW50ZXJDb25uZWN0b3JcbiAgICAgICAgLmFzc2lnbkJ1ZGdldCh1c2VySWQsIGNvc3RDZW50ZXJDb2RlLCBidWRnZXRDb2RlKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKCkgPT4gW1xuICAgICAgICAgICAgbmV3IENvc3RDZW50ZXJBY3Rpb25zLkFzc2lnbkJ1ZGdldFN1Y2Nlc3Moe1xuICAgICAgICAgICAgICBjb2RlOiBidWRnZXRDb2RlLFxuICAgICAgICAgICAgICBzZWxlY3RlZDogdHJ1ZSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgXSksXG4gICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICAgIG5ldyBDb3N0Q2VudGVyQWN0aW9ucy5Bc3NpZ25CdWRnZXRGYWlsKHtcbiAgICAgICAgICAgICAgICBidWRnZXRDb2RlLFxuICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgIClcbiAgKTtcblxuICBARWZmZWN0KClcbiAgdW5hc3NpZ25CdWRnZXRUb0Nvc3RDZW50ZXIkOiBPYnNlcnZhYmxlPFxuICAgIHwgQ29zdENlbnRlckFjdGlvbnMuVW5hc3NpZ25CdWRnZXRTdWNjZXNzXG4gICAgfCBDb3N0Q2VudGVyQWN0aW9ucy5VbmFzc2lnbkJ1ZGdldEZhaWxcbiAgICB8IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhXG4gID4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgb2ZUeXBlKENvc3RDZW50ZXJBY3Rpb25zLlVOQVNTSUdOX0JVREdFVCksXG4gICAgbWFwKChhY3Rpb246IENvc3RDZW50ZXJBY3Rpb25zLlVuYXNzaWduQnVkZ2V0KSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgbWVyZ2VNYXAoKHsgdXNlcklkLCBjb3N0Q2VudGVyQ29kZSwgYnVkZ2V0Q29kZSB9KSA9PlxuICAgICAgdGhpcy5jb3N0Q2VudGVyQ29ubmVjdG9yXG4gICAgICAgIC51bmFzc2lnbkJ1ZGdldCh1c2VySWQsIGNvc3RDZW50ZXJDb2RlLCBidWRnZXRDb2RlKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKCkgPT4gW1xuICAgICAgICAgICAgbmV3IENvc3RDZW50ZXJBY3Rpb25zLlVuYXNzaWduQnVkZ2V0U3VjY2Vzcyh7XG4gICAgICAgICAgICAgIGNvZGU6IGJ1ZGdldENvZGUsXG4gICAgICAgICAgICAgIHNlbGVjdGVkOiBmYWxzZSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgXSksXG4gICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICAgIG5ldyBDb3N0Q2VudGVyQWN0aW9ucy5VbmFzc2lnbkJ1ZGdldEZhaWwoe1xuICAgICAgICAgICAgICAgIGJ1ZGdldENvZGUsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgKVxuICApO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgYWN0aW9ucyQ6IEFjdGlvbnMsXG4gICAgcHJpdmF0ZSBjb3N0Q2VudGVyQ29ubmVjdG9yOiBDb3N0Q2VudGVyQ29ubmVjdG9yXG4gICkge31cbn1cbiJdfQ==