{"ast":null,"code":"import * as i1 from '@spartacus/core';\nimport * as i0 from '@angular/core';\nimport { Injectable } from '@angular/core';\nimport { of } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\nclass BulkPricingService {\n  constructor(productService) {\n    this.productService = productService;\n    this.PRODUCT_SCOPE = \"bulkPrices\" /* BULK_PRICES */;\n  }\n\n  getBulkPrices(productCode) {\n    return this.productService.get(productCode, this.PRODUCT_SCOPE).pipe(switchMap(productPriceScope => {\n      return of(this.convert(productPriceScope));\n    }));\n  }\n  convert(productPriceScope) {\n    var _a;\n    let bulkPrices = [];\n    if (productPriceScope) {\n      const basePrice = (_a = productPriceScope.price) === null || _a === void 0 ? void 0 : _a.value;\n      const volumePrices = productPriceScope.volumePrices;\n      bulkPrices = volumePrices === null || volumePrices === void 0 ? void 0 : volumePrices.map(volumePrice => this.parsePrice(volumePrice, basePrice));\n    }\n    return bulkPrices;\n  }\n  parsePrice(priceTier, basePrice) {\n    const bulkPriceTemplate = {\n      currencyIso: priceTier.currencyIso,\n      formattedValue: priceTier.formattedValue,\n      maxQuantity: priceTier.maxQuantity,\n      minQuantity: priceTier.minQuantity,\n      priceType: priceTier.priceType,\n      value: priceTier.value,\n      formattedDiscount: '',\n      discount: 0\n    };\n    return this.calculateDiscount(bulkPriceTemplate, basePrice);\n  }\n  calculateDiscount(bulkPriceTemplate, basePrice) {\n    const bulkPrice = Object.assign({}, bulkPriceTemplate);\n    const tierPrice = bulkPriceTemplate.value;\n    if (tierPrice && basePrice) {\n      const discount = Math.round(100.0 - tierPrice / basePrice * 100);\n      const formatted = discount === 0 ? `${discount}%` : `-${discount}%`;\n      bulkPrice.formattedDiscount = formatted;\n      bulkPrice.discount = discount;\n    }\n    return bulkPrice;\n  }\n}\nBulkPricingService.ɵfac = function BulkPricingService_Factory(t) {\n  return new (t || BulkPricingService)(i0.ɵɵinject(i1.ProductService));\n};\nBulkPricingService.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n  token: BulkPricingService,\n  factory: BulkPricingService.ɵfac,\n  providedIn: 'root'\n});\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(BulkPricingService, [{\n    type: Injectable,\n    args: [{\n      providedIn: 'root'\n    }]\n  }], function () {\n    return [{\n      type: i1.ProductService\n    }];\n  }, null);\n})();\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { BulkPricingService };","map":{"version":3,"names":["i1","i0","Injectable","of","switchMap","BulkPricingService","constructor","productService","PRODUCT_SCOPE","getBulkPrices","productCode","get","pipe","productPriceScope","convert","_a","bulkPrices","basePrice","price","value","volumePrices","map","volumePrice","parsePrice","priceTier","bulkPriceTemplate","currencyIso","formattedValue","maxQuantity","minQuantity","priceType","formattedDiscount","discount","calculateDiscount","bulkPrice","Object","assign","tierPrice","Math","round","formatted","ɵfac","ProductService","ɵprov","type","args","providedIn"],"sources":["/home/hamid/learning/cx-cangubike/js-storefront/olf/node_modules/@spartacus/product/fesm2015/spartacus-product-bulk-pricing-core.js"],"sourcesContent":["import * as i1 from '@spartacus/core';\nimport * as i0 from '@angular/core';\nimport { Injectable } from '@angular/core';\nimport { of } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\n\nclass BulkPricingService {\n    constructor(productService) {\n        this.productService = productService;\n        this.PRODUCT_SCOPE = \"bulkPrices\" /* BULK_PRICES */;\n    }\n    getBulkPrices(productCode) {\n        return this.productService.get(productCode, this.PRODUCT_SCOPE).pipe(switchMap((productPriceScope) => {\n            return of(this.convert(productPriceScope));\n        }));\n    }\n    convert(productPriceScope) {\n        var _a;\n        let bulkPrices = [];\n        if (productPriceScope) {\n            const basePrice = (_a = productPriceScope.price) === null || _a === void 0 ? void 0 : _a.value;\n            const volumePrices = productPriceScope.volumePrices;\n            bulkPrices = volumePrices === null || volumePrices === void 0 ? void 0 : volumePrices.map((volumePrice) => this.parsePrice(volumePrice, basePrice));\n        }\n        return bulkPrices;\n    }\n    parsePrice(priceTier, basePrice) {\n        const bulkPriceTemplate = {\n            currencyIso: priceTier.currencyIso,\n            formattedValue: priceTier.formattedValue,\n            maxQuantity: priceTier.maxQuantity,\n            minQuantity: priceTier.minQuantity,\n            priceType: priceTier.priceType,\n            value: priceTier.value,\n            formattedDiscount: '',\n            discount: 0,\n        };\n        return this.calculateDiscount(bulkPriceTemplate, basePrice);\n    }\n    calculateDiscount(bulkPriceTemplate, basePrice) {\n        const bulkPrice = Object.assign({}, bulkPriceTemplate);\n        const tierPrice = bulkPriceTemplate.value;\n        if (tierPrice && basePrice) {\n            const discount = Math.round(100.0 - (tierPrice / basePrice) * 100);\n            const formatted = discount === 0 ? `${discount}%` : `-${discount}%`;\n            bulkPrice.formattedDiscount = formatted;\n            bulkPrice.discount = discount;\n        }\n        return bulkPrice;\n    }\n}\nBulkPricingService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: BulkPricingService, deps: [{ token: i1.ProductService }], target: i0.ɵɵFactoryTarget.Injectable });\nBulkPricingService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: BulkPricingService, providedIn: 'root' });\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: BulkPricingService, decorators: [{\n            type: Injectable,\n            args: [{\n                    providedIn: 'root',\n                }]\n        }], ctorParameters: function () { return [{ type: i1.ProductService }]; } });\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { BulkPricingService };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}