{"ast":null,"code":"import * as i0 from '@angular/core';\nimport { EventEmitter, Component, ChangeDetectionStrategy, Output, Input, ElementRef, ViewChild, HostListener, NgModule } from '@angular/core';\nimport * as i3 from '@angular/common';\nimport { CommonModule } from '@angular/common';\nimport { RouterModule } from '@angular/router';\nimport * as i3$1 from '@spartacus/core';\nimport { isNotNullable, I18nModule, provideConfig, provideDefaultConfig } from '@spartacus/core';\nimport * as i1 from '@spartacus/storefront';\nimport { ICON_TYPE, BREAKPOINT, DIALOG_TYPE, ProductImagesComponent, CarouselModule, IconModule, KeyboardFocusModule, MediaModule, OutletModule } from '@spartacus/storefront';\nimport { BehaviorSubject, Subscription, merge, combineLatest, fromEvent, of } from 'rxjs';\nimport { filter, map, switchMap, tap, distinctUntilChanged, shareReplay, switchMapTo } from 'rxjs/operators';\nfunction ProductImageZoomThumbnailsComponent_ng_container_0_cx_carousel_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"cx-carousel\", 3);\n  }\n  if (rf & 2) {\n    const thumbs_r3 = i0.ɵɵnextContext().ngIf;\n    i0.ɵɵnextContext();\n    const _r1 = i0.ɵɵreference(3);\n    i0.ɵɵproperty(\"items\", thumbs_r3)(\"hideIndicators\", false)(\"template\", _r1);\n  }\n}\nfunction ProductImageZoomThumbnailsComponent_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, ProductImageZoomThumbnailsComponent_ng_container_0_cx_carousel_1_Template, 1, 3, \"cx-carousel\", 2);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const thumbs_r3 = ctx.ngIf;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", thumbs_r3.length);\n  }\n}\nfunction ProductImageZoomThumbnailsComponent_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"cx-media\", 4);\n    i0.ɵɵlistener(\"focus\", function ProductImageZoomThumbnailsComponent_ng_template_2_Template_cx_media_focus_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const item_r6 = restoredCtx.item;\n      const ctx_r7 = i0.ɵɵnextContext();\n      return ctx_r7.openImage(item_r6.container);\n    });\n    i0.ɵɵpipe(1, \"async\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const item_r6 = ctx.item;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵclassProp(\"is-active\", i0.ɵɵpipeBind1(1, 3, ctx_r2.isActive(item_r6.container)));\n    i0.ɵɵproperty(\"container\", item_r6.container);\n  }\n}\nconst _c0 = [\"defaultImage\"];\nconst _c1 = [\"zoomContainer\"];\nconst _c2 = [\"zoomedImage\"];\nfunction ProductImageZoomViewComponent_ng_container_0_div_1_button_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function ProductImageZoomViewComponent_ng_container_0_div_1_button_2_Template_button_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r10);\n      const previousProduct_r8 = restoredCtx.ngIf;\n      const ctx_r9 = i0.ɵɵnextContext(3);\n      return ctx_r9.openImage(previousProduct_r8.container);\n    });\n    i0.ɵɵelement(1, \"cx-icon\", 9);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"type\", ctx_r4.iconType.CARET_LEFT);\n  }\n}\nfunction ProductImageZoomViewComponent_ng_container_0_div_1_cx_media_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"cx-media\", 10, 11);\n  }\n  if (rf & 2) {\n    const main_r1 = i0.ɵɵnextContext(2).ngIf;\n    i0.ɵɵproperty(\"container\", main_r1);\n  }\n}\nfunction ProductImageZoomViewComponent_ng_container_0_div_1_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 12, 13);\n    i0.ɵɵelementStart(2, \"cx-media\", 14, 15);\n    i0.ɵɵlistener(\"mousemove\", function ProductImageZoomViewComponent_ng_container_0_div_1_div_5_Template_cx_media_mousemove_2_listener($event) {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r15 = i0.ɵɵnextContext(3);\n      return ctx_r15.pointerMove($event);\n    })(\"touchmove\", function ProductImageZoomViewComponent_ng_container_0_div_1_div_5_Template_cx_media_touchmove_2_listener($event) {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r17 = i0.ɵɵnextContext(3);\n      return ctx_r17.touchMove($event);\n    })(\"touchend\", function ProductImageZoomViewComponent_ng_container_0_div_1_div_5_Template_cx_media_touchend_2_listener() {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r18 = i0.ɵɵnextContext(3);\n      return ctx_r18.clearTouch();\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const main_r1 = i0.ɵɵnextContext(2).ngIf;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"container\", main_r1);\n  }\n}\nfunction ProductImageZoomViewComponent_ng_container_0_div_1_button_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r22 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function ProductImageZoomViewComponent_ng_container_0_div_1_button_7_Template_button_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r22);\n      const nextProduct_r20 = restoredCtx.ngIf;\n      const ctx_r21 = i0.ɵɵnextContext(3);\n      return ctx_r21.openImage(nextProduct_r20.container);\n    });\n    i0.ɵɵelement(1, \"cx-icon\", 9);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r7 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"type\", ctx_r7.iconType.CARET_RIGHT);\n  }\n}\nfunction ProductImageZoomViewComponent_ng_container_0_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 3);\n    i0.ɵɵelementStart(1, \"div\", 4);\n    i0.ɵɵtemplate(2, ProductImageZoomViewComponent_ng_container_0_div_1_button_2_Template, 2, 1, \"button\", 5);\n    i0.ɵɵpipe(3, \"async\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, ProductImageZoomViewComponent_ng_container_0_div_1_cx_media_4_Template, 2, 1, \"cx-media\", 6);\n    i0.ɵɵtemplate(5, ProductImageZoomViewComponent_ng_container_0_div_1_div_5_Template, 4, 1, \"div\", 7);\n    i0.ɵɵelementStart(6, \"div\", 4);\n    i0.ɵɵtemplate(7, ProductImageZoomViewComponent_ng_container_0_div_1_button_7_Template, 2, 1, \"button\", 5);\n    i0.ɵɵpipe(8, \"async\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const thumbs_r3 = ctx.ngIf;\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(3, 4, ctx_r2.getPreviousProduct(thumbs_r3)));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r2.isZoomed);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.isZoomed);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(8, 6, ctx_r2.getNextProduct(thumbs_r3)));\n  }\n}\nfunction ProductImageZoomViewComponent_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, ProductImageZoomViewComponent_ng_container_0_div_1_Template, 9, 8, \"div\", 2);\n    i0.ɵɵpipe(2, \"async\");\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(2, 1, ctx_r0.thumbnails$));\n  }\n}\nconst _c3 = [\"expandButton\"];\nfunction ProductImageZoomProductImagesComponent_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"cx-media\", 2);\n    i0.ɵɵlistener(\"click\", function ProductImageZoomProductImagesComponent_ng_container_0_Template_cx_media_click_1_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return ctx_r5.triggerZoom(true);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"cx-product-image-zoom-trigger\", 3);\n    i0.ɵɵlistener(\"dialogClose\", function ProductImageZoomProductImagesComponent_ng_container_0_Template_cx_product_image_zoom_trigger_dialogClose_2_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return ctx_r7.triggerZoom(false);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const main_r4 = ctx.ngIf;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"container\", main_r4);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"expandImage\", ctx_r0.expandImage.value)(\"galleryIndex\", ctx_r0.selectedIndex);\n  }\n}\nfunction ProductImageZoomProductImagesComponent_ng_container_2_cx_carousel_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"cx-carousel\", 5);\n  }\n  if (rf & 2) {\n    const thumbs_r8 = i0.ɵɵnextContext().ngIf;\n    i0.ɵɵnextContext();\n    const _r2 = i0.ɵɵreference(5);\n    i0.ɵɵproperty(\"items\", thumbs_r8)(\"hideIndicators\", false)(\"template\", _r2);\n  }\n}\nfunction ProductImageZoomProductImagesComponent_ng_container_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, ProductImageZoomProductImagesComponent_ng_container_2_cx_carousel_1_Template, 1, 3, \"cx-carousel\", 4);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const thumbs_r8 = ctx.ngIf;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", thumbs_r8.length);\n  }\n}\nfunction ProductImageZoomProductImagesComponent_ng_template_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"cx-media\", 6);\n    i0.ɵɵlistener(\"focus\", function ProductImageZoomProductImagesComponent_ng_template_4_Template_cx_media_focus_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r13);\n      const item_r11 = restoredCtx.item;\n      const ctx_r12 = i0.ɵɵnextContext();\n      return ctx_r12.openImage(item_r11.container);\n    });\n    i0.ɵɵpipe(1, \"async\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const item_r11 = ctx.item;\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵclassProp(\"is-active\", i0.ɵɵpipeBind1(1, 3, ctx_r3.isActive(item_r11.container)));\n    i0.ɵɵproperty(\"container\", item_r11.container);\n  }\n}\nlet ProductImageZoomThumbnailsComponent = /*#__PURE__*/(() => {\n  class ProductImageZoomThumbnailsComponent {\n    constructor() {\n      this.mainMediaContainer = new BehaviorSubject({});\n      this.productImage = new EventEmitter();\n      this.subscription = new Subscription();\n    }\n    ngOnInit() {\n      this.subscription.add(this.activeThumb.subscribe(image => {\n        this.mainMediaContainer.next(image);\n      }));\n    }\n    openImage(image) {\n      var _a;\n      this.mainMediaContainer.next(image);\n      if (typeof ((_a = image.zoom) === null || _a === void 0 ? void 0 : _a.galleryIndex) === 'number') {\n        this.productImage.emit({\n          image,\n          index: image.zoom.galleryIndex\n        });\n      }\n    }\n    isActive(thumbnail) {\n      return this.mainMediaContainer.asObservable().pipe(filter(isNotNullable), map(container => {\n        var _a, _b;\n        return ((_a = container.zoom) === null || _a === void 0 ? void 0 : _a.url) && ((_b = thumbnail.zoom) === null || _b === void 0 ? void 0 : _b.url) && container.zoom.url === thumbnail.zoom.url;\n      }));\n    }\n    ngOnDestroy() {\n      this.subscription.unsubscribe();\n    }\n  }\n  ProductImageZoomThumbnailsComponent.ɵfac = function ProductImageZoomThumbnailsComponent_Factory(t) {\n    return new (t || ProductImageZoomThumbnailsComponent)();\n  };\n  ProductImageZoomThumbnailsComponent.ɵcmp = /* @__PURE__ */i0.ɵɵdefineComponent({\n    type: ProductImageZoomThumbnailsComponent,\n    selectors: [[\"cx-product-image-zoom-thumbnails\"]],\n    inputs: {\n      thumbs$: \"thumbs$\",\n      activeThumb: \"activeThumb\"\n    },\n    outputs: {\n      productImage: \"productImage\"\n    },\n    decls: 4,\n    vars: 3,\n    consts: [[4, \"ngIf\"], [\"thumb\", \"\"], [\"class\", \"thumbs\", \"itemWidth\", \"70px\", 3, \"items\", \"hideIndicators\", \"template\", 4, \"ngIf\"], [\"itemWidth\", \"70px\", 1, \"thumbs\", 3, \"items\", \"hideIndicators\", \"template\"], [\"tabindex\", \"0\", 3, \"container\", \"focus\"]],\n    template: function ProductImageZoomThumbnailsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, ProductImageZoomThumbnailsComponent_ng_container_0_Template, 2, 1, \"ng-container\", 0);\n        i0.ɵɵpipe(1, \"async\");\n        i0.ɵɵtemplate(2, ProductImageZoomThumbnailsComponent_ng_template_2_Template, 2, 5, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(1, 1, ctx.thumbs$));\n      }\n    },\n    directives: [i3.NgIf, i1.CarouselComponent, i1.MediaComponent],\n    pipes: [i3.AsyncPipe],\n    encapsulation: 2,\n    changeDetection: 0\n  });\n  return ProductImageZoomThumbnailsComponent;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet ProductImageZoomViewComponent = /*#__PURE__*/(() => {\n  class ProductImageZoomViewComponent {\n    constructor(currentProductService, renderer, cdRef, breakpointService) {\n      this.currentProductService = currentProductService;\n      this.renderer = renderer;\n      this.cdRef = cdRef;\n      this.breakpointService = breakpointService;\n      this.iconType = ICON_TYPE;\n      this.mainMediaContainer = new BehaviorSubject(null);\n      this.defaultImageReady = new BehaviorSubject(false);\n      this.zoomReady = new BehaviorSubject(false);\n      this.subscription = new Subscription();\n      this.mainMediaContainer$ = this.mainMediaContainer.asObservable();\n      this.defaultImageReady$ = this.defaultImageReady.asObservable();\n      this.zoomReady$ = this.zoomReady.asObservable();\n      this.activeThumb = new EventEmitter();\n      this.defaultImageClickHandler$ = this.defaultImageReady$.pipe(filter(Boolean), switchMap(_ => merge(...this.clickOrDoubleClick(this.defaultImage)).pipe(tap(() => this.zoom()))));\n      this.zoomImageClickHandler$ = this.zoomReady$.pipe(filter(Boolean), switchMap(_ => merge(...this.clickOrDoubleClick(this.zoomImage)).pipe(tap(() => this.zoom()))));\n      this.startCoords = null;\n      this.left = 0;\n      this.top = 0;\n      this.isZoomed = false;\n      this.product$ = this.currentProductService.getProduct().pipe(filter(isNotNullable), distinctUntilChanged(), tap(p => {\n        var _a, _b, _c, _d;\n        if (this.galleryIndex) {\n          const image = Array.isArray((_a = p.images) === null || _a === void 0 ? void 0 : _a.GALLERY) ? (_b = p.images) === null || _b === void 0 ? void 0 : _b.GALLERY.find(img => {\n            var _a;\n            return ((_a = img.zoom) === null || _a === void 0 ? void 0 : _a.galleryIndex) === this.galleryIndex;\n          }) : (_c = p.images) === null || _c === void 0 ? void 0 : _c.GALLERY;\n          this.mainMediaContainer.next(image || null);\n        } else {\n          this.mainMediaContainer.next(((_d = p.images) === null || _d === void 0 ? void 0 : _d.PRIMARY) ? p.images.PRIMARY : {});\n        }\n      }), shareReplay(1));\n      this.thumbnails$ = this.product$.pipe(map(p => this.createThumbs(p)), shareReplay(1));\n      this.mainImage$ = combineLatest([this.product$, this.mainMediaContainer$]).pipe(map(([, container]) => container));\n    }\n    get defaultImage() {\n      return this._defaultImage;\n    }\n    set defaultImage(el) {\n      if (el) {\n        this._defaultImage = el;\n        this.defaultImageReady.next(true);\n      }\n    }\n    get zoomImage() {\n      return this._zoomImage;\n    }\n    set zoomImage(el) {\n      if (el) {\n        this._zoomImage = el;\n        this.zoomReady.next(true);\n      }\n    }\n    ngOnInit() {\n      this.subscription.add(this.defaultImageClickHandler$.subscribe());\n      this.subscription.add(this.zoomImageClickHandler$.subscribe());\n    }\n    openImage(item) {\n      this.mainMediaContainer.next(item);\n      this.activeThumb.emit(item);\n    }\n    /** find the index of the main media in the list of media */\n    getActive() {\n      var _a, _b, _c, _d;\n      if (Array.isArray(this.mainMediaContainer.value)) {\n        return ((_a = this.mainMediaContainer.value[0].thumbnail) === null || _a === void 0 ? void 0 : _a.galleryIndex) || 0;\n      }\n      return ((_d = (_c = (_b = this.mainMediaContainer) === null || _b === void 0 ? void 0 : _b.value) === null || _c === void 0 ? void 0 : _c.thumbnail) === null || _d === void 0 ? void 0 : _d.galleryIndex) || 0;\n    }\n    getPreviousProduct(thumbs) {\n      const active = this.getActive();\n      if (active === 0) {\n        return thumbs[active];\n      }\n      return thumbs[active - 1];\n    }\n    getNextProduct(thumbs) {\n      const active = this.getActive();\n      if (active === thumbs.length - 1) {\n        return thumbs[active];\n      }\n      return thumbs[active + 1];\n    }\n    /**\n     * Zoom in or out of the image\n     */\n    zoom() {\n      this.isZoomed = !this.isZoomed;\n      this.startCoords = null;\n      this.left = 0;\n      this.top = 0;\n      this.cdRef.markForCheck();\n    }\n    /**\n     * Touch screen image pan\n     *\n     * @param event\n     */\n    touchMove(event) {\n      var _a, _b, _c, _d;\n      const touch = event.touches[0] || event.changedTouches[0];\n      const boundingRect = (_b = (_a = this.zoomedImage) === null || _a === void 0 ? void 0 : _a.nativeElement) === null || _b === void 0 ? void 0 : _b.getBoundingClientRect();\n      const imageElement = (_d = (_c = this.zoomedImage) === null || _c === void 0 ? void 0 : _c.nativeElement) === null || _d === void 0 ? void 0 : _d.firstChild;\n      if (!this.startCoords) this.startCoords = {\n        x: touch.clientX,\n        y: touch.clientY\n      };\n      this.left += touch.clientX - this.startCoords.x;\n      this.top += touch.clientY - this.startCoords.y;\n      this.moveImage(this.left, this.top, boundingRect, imageElement);\n      this.startCoords = {\n        x: touch.clientX,\n        y: touch.clientY\n      };\n    }\n    /**\n     * Clears touch location\n     */\n    clearTouch() {\n      this.startCoords = null;\n    }\n    /**\n     * Pointer image pan\n     *\n     * @param event\n     */\n    pointerMove(event) {\n      const boundingRect = this.zoomedImage.nativeElement.getBoundingClientRect();\n      const imageElement = this.zoomedImage.nativeElement.firstChild;\n      const {\n        positionX,\n        positionY\n      } = this.calculatePointerMovePosition(this.zoomedImage, event.clientX, event.clientY);\n      this.moveImage(positionX, positionY, boundingRect, imageElement);\n    }\n    changeImage(event) {\n      this.mainMediaContainer.next(event.image);\n    }\n    /**\n     * Applies the offset from touchMove or pointerMove to the image element\n     *\n     * @param positionX\n     * @param positionY\n     * @param boundingRect\n     * @param imageElement\n     */\n    moveImage(positionX, positionY, boundingRect, imageElement) {\n      const {\n        x,\n        y\n      } = this.handleOutOfBounds(positionX, positionY, imageElement, boundingRect);\n      if (imageElement) {\n        this.renderer.setStyle(imageElement, 'left', x + 'px');\n        this.renderer.setStyle(imageElement, 'top', y + 'px');\n      }\n    }\n    ngOnDestroy() {\n      this.subscription.unsubscribe();\n    }\n    /**\n     * Returns click and dblclick event mapping for the given element\n     *\n     * @param element\n     */\n    clickOrDoubleClick(element) {\n      return [fromEvent(element.nativeElement, 'click').pipe(switchMapTo(this.breakpointService.isUp(BREAKPOINT.md)), filter(Boolean)), fromEvent(element.nativeElement, 'dblclick').pipe(switchMapTo(this.breakpointService.isDown(BREAKPOINT.lg)), filter(Boolean))];\n    }\n    /**\n     * Return an array of CarouselItems for the product thumbnails.\n     * In case there are less then 2 thumbs, we return null.\n     */\n    createThumbs(product) {\n      if (!product.images || !product.images.GALLERY || product.images.GALLERY.length < 2) {\n        return [];\n      }\n      const images = product.images.GALLERY;\n      return images.map(c => of({\n        container: c\n      }));\n    }\n    /**\n     * Keeps the zoom image from leaving the bounding container\n     *\n     * @param positionX\n     * @param positionY\n     * @param imageElement\n     * @param boundingRect\n     */\n    handleOutOfBounds(positionX, positionY, imageElement, boundingRect) {\n      const paddingX = 60;\n      const paddingY = 60;\n      if (positionY <= -(imageElement === null || imageElement === void 0 ? void 0 : imageElement.height) + paddingY) {\n        positionY = -(imageElement === null || imageElement === void 0 ? void 0 : imageElement.height) + paddingY;\n      }\n      if (positionY >= (boundingRect === null || boundingRect === void 0 ? void 0 : boundingRect.height) - paddingY) {\n        positionY = (boundingRect === null || boundingRect === void 0 ? void 0 : boundingRect.height) - paddingY;\n      }\n      if (positionX <= -(imageElement === null || imageElement === void 0 ? void 0 : imageElement.width) - (boundingRect === null || boundingRect === void 0 ? void 0 : boundingRect.width) / 2 + paddingX) {\n        positionX = -(imageElement === null || imageElement === void 0 ? void 0 : imageElement.width) - (boundingRect === null || boundingRect === void 0 ? void 0 : boundingRect.width) / 2 + paddingX;\n      }\n      if (positionX >= (imageElement === null || imageElement === void 0 ? void 0 : imageElement.width) + (boundingRect === null || boundingRect === void 0 ? void 0 : boundingRect.width) / 2 - paddingX) {\n        positionX = (imageElement === null || imageElement === void 0 ? void 0 : imageElement.width) + (boundingRect === null || boundingRect === void 0 ? void 0 : boundingRect.width) / 2 - paddingX;\n      }\n      return {\n        x: positionX,\n        y: positionY\n      };\n    }\n    /**\n     * Returns the position of the image based on the cursor pointer\n     *\n     * @param element\n     * @param clientX\n     * @param clientY\n     */\n    calculatePointerMovePosition(element, clientX, clientY) {\n      const boundingRect = element.nativeElement.getBoundingClientRect();\n      const x = clientX - boundingRect.left;\n      const y = clientY - boundingRect.top;\n      const positionX = -x + element.nativeElement.clientWidth / 2;\n      const positionY = -y + element.nativeElement.clientHeight / 2;\n      return {\n        positionX,\n        positionY\n      };\n    }\n  }\n  ProductImageZoomViewComponent.ɵfac = function ProductImageZoomViewComponent_Factory(t) {\n    return new (t || ProductImageZoomViewComponent)(i0.ɵɵdirectiveInject(i1.CurrentProductService), i0.ɵɵdirectiveInject(i0.Renderer2), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i1.BreakpointService));\n  };\n  ProductImageZoomViewComponent.ɵcmp = /* @__PURE__ */i0.ɵɵdefineComponent({\n    type: ProductImageZoomViewComponent,\n    selectors: [[\"cx-product-image-zoom-view\"]],\n    viewQuery: function ProductImageZoomViewComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5, ElementRef);\n        i0.ɵɵviewQuery(_c1, 5, ElementRef);\n        i0.ɵɵviewQuery(_c2, 5, ElementRef);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.defaultImage = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.zoomImage = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.zoomedImage = _t.first);\n      }\n    },\n    inputs: {\n      galleryIndex: \"galleryIndex\"\n    },\n    decls: 3,\n    vars: 5,\n    consts: [[4, \"ngIf\"], [3, \"thumbs$\", \"activeThumb\", \"productImage\"], [\"class\", \"cx-main-image-group\", 4, \"ngIf\"], [1, \"cx-main-image-group\"], [1, \"cx-navigate-image\"], [\"class\", \"btn btn-link\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"cx-default-image-zoom\", 3, \"container\", 4, \"ngIf\"], [\"class\", \"cx-zoom-container\", 4, \"ngIf\"], [1, \"btn\", \"btn-link\", 3, \"click\"], [3, \"type\"], [1, \"cx-default-image-zoom\", 3, \"container\"], [\"defaultImage\", \"\"], [1, \"cx-zoom-container\"], [\"zoomContainer\", \"\"], [1, \"cx-image-zoomed\", 3, \"container\", \"mousemove\", \"touchmove\", \"touchend\"], [\"zoomedImage\", \"\"]],\n    template: function ProductImageZoomViewComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, ProductImageZoomViewComponent_ng_container_0_Template, 3, 3, \"ng-container\", 0);\n        i0.ɵɵpipe(1, \"async\");\n        i0.ɵɵelementStart(2, \"cx-product-image-zoom-thumbnails\", 1);\n        i0.ɵɵlistener(\"productImage\", function ProductImageZoomViewComponent_Template_cx_product_image_zoom_thumbnails_productImage_2_listener($event) {\n          return ctx.changeImage($event);\n        });\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(1, 3, ctx.mainImage$));\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"thumbs$\", ctx.thumbnails$)(\"activeThumb\", ctx.activeThumb);\n      }\n    },\n    directives: [i3.NgIf, ProductImageZoomThumbnailsComponent, i1.IconComponent, i1.MediaComponent],\n    pipes: [i3.AsyncPipe],\n    encapsulation: 2,\n    changeDetection: 0\n  });\n  return ProductImageZoomViewComponent;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet ProductImageZoomDialogComponent = /*#__PURE__*/(() => {\n  class ProductImageZoomDialogComponent {\n    constructor(launchDialogService, el) {\n      this.launchDialogService = launchDialogService;\n      this.el = el;\n      this.iconType = ICON_TYPE;\n      this.focusConfig = {\n        trap: true,\n        block: true,\n        autofocus: 'button',\n        focusOnEscape: true\n      };\n    }\n    handleClick(event) {\n      // Close on click outside the dialog window\n      if (event.target.tagName === this.el.nativeElement.tagName) {\n        this.close('Cross click');\n      }\n    }\n    close(reason = '') {\n      this.launchDialogService.closeDialog(reason);\n    }\n  }\n  ProductImageZoomDialogComponent.ɵfac = function ProductImageZoomDialogComponent_Factory(t) {\n    return new (t || ProductImageZoomDialogComponent)(i0.ɵɵdirectiveInject(i1.LaunchDialogService), i0.ɵɵdirectiveInject(i0.ElementRef));\n  };\n  ProductImageZoomDialogComponent.ɵcmp = /* @__PURE__ */i0.ɵɵdefineComponent({\n    type: ProductImageZoomDialogComponent,\n    selectors: [[\"cx-product-image-zoom-dialog\"]],\n    hostBindings: function ProductImageZoomDialogComponent_HostBindings(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵlistener(\"click\", function ProductImageZoomDialogComponent_click_HostBindingHandler($event) {\n          return ctx.handleClick($event);\n        });\n      }\n    },\n    inputs: {\n      galleryIndex: \"galleryIndex\"\n    },\n    decls: 9,\n    vars: 6,\n    consts: [[1, \"cx-image-zoom-dialog\", 3, \"cxFocus\"], [1, \"cx-dialog-content\"], [1, \"cx-dialog-header\"], [\"type\", \"button\", 1, \"close\", 3, \"click\"], [\"aria-hidden\", \"true\"], [3, \"type\"], [1, \"cx-dialog-body\"], [3, \"galleryIndex\"]],\n    template: function ProductImageZoomDialogComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"div\", 2);\n        i0.ɵɵelementStart(3, \"button\", 3);\n        i0.ɵɵlistener(\"click\", function ProductImageZoomDialogComponent_Template_button_click_3_listener() {\n          return ctx.close(\"cross click\");\n        });\n        i0.ɵɵpipe(4, \"cxTranslate\");\n        i0.ɵɵelementStart(5, \"span\", 4);\n        i0.ɵɵelement(6, \"cx-icon\", 5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"div\", 6);\n        i0.ɵɵelement(8, \"cx-product-image-zoom-view\", 7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"cxFocus\", ctx.focusConfig);\n        i0.ɵɵadvance(3);\n        i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind1(4, 4, \"productImageZoomDialog.close\"));\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"type\", ctx.iconType.CLOSE);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"galleryIndex\", ctx.galleryIndex);\n      }\n    },\n    directives: [i1.FocusDirective, i1.IconComponent, ProductImageZoomViewComponent],\n    pipes: [i3$1.TranslatePipe],\n    encapsulation: 2,\n    changeDetection: 0\n  });\n  return ProductImageZoomDialogComponent;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nconst defaultProductImageZoomLayoutConfig = {\n  launch: {\n    PRODUCT_IMAGE_ZOOM: {\n      inline: true,\n      component: ProductImageZoomDialogComponent,\n      dialogType: DIALOG_TYPE.DIALOG\n    }\n  }\n};\nlet ProductImageZoomTriggerComponent = /*#__PURE__*/(() => {\n  class ProductImageZoomTriggerComponent {\n    constructor(launchDialogService, vcr) {\n      this.launchDialogService = launchDialogService;\n      this.vcr = vcr;\n      this.iconType = ICON_TYPE;\n      this.subscriptions = new Subscription();\n      this.dialogClose = new EventEmitter();\n    }\n    set expandImage(expand) {\n      if (expand) {\n        this.triggerZoom();\n      }\n    }\n    triggerZoom() {\n      const component = this.launchDialogService.launch(\"PRODUCT_IMAGE_ZOOM\" /* PRODUCT_IMAGE_ZOOM */, this.vcr);\n      if (component) {\n        this.subscriptions.add(combineLatest([component, this.launchDialogService.dialogClose]).pipe(tap(([comp]) => {\n          if (this.galleryIndex) {\n            comp.instance.galleryIndex = this.galleryIndex;\n          }\n        }), filter(([, close]) => Boolean(close)), tap(([comp]) => {\n          this.launchDialogService.clear(\"PRODUCT_IMAGE_ZOOM\" /* PRODUCT_IMAGE_ZOOM */);\n          comp === null || comp === void 0 ? void 0 : comp.destroy();\n          this.dialogClose.emit();\n          this.expandButton.nativeElement.focus();\n        })).subscribe());\n      }\n    }\n    ngOnDestroy() {\n      this.subscriptions.unsubscribe();\n    }\n  }\n  ProductImageZoomTriggerComponent.ɵfac = function ProductImageZoomTriggerComponent_Factory(t) {\n    return new (t || ProductImageZoomTriggerComponent)(i0.ɵɵdirectiveInject(i1.LaunchDialogService), i0.ɵɵdirectiveInject(i0.ViewContainerRef));\n  };\n  ProductImageZoomTriggerComponent.ɵcmp = /* @__PURE__ */i0.ɵɵdefineComponent({\n    type: ProductImageZoomTriggerComponent,\n    selectors: [[\"cx-product-image-zoom-trigger\"]],\n    viewQuery: function ProductImageZoomTriggerComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c3, 5);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.expandButton = _t.first);\n      }\n    },\n    inputs: {\n      galleryIndex: \"galleryIndex\",\n      expandImage: \"expandImage\"\n    },\n    outputs: {\n      dialogClose: \"dialogClose\"\n    },\n    decls: 6,\n    vars: 4,\n    consts: [[1, \"btn\", \"btn-link\", \"cx-action-link\", 3, \"click\"], [\"expandButton\", \"\"], [3, \"type\"]],\n    template: function ProductImageZoomTriggerComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"button\", 0, 1);\n        i0.ɵɵlistener(\"click\", function ProductImageZoomTriggerComponent_Template_button_click_0_listener() {\n          return ctx.triggerZoom();\n        });\n        i0.ɵɵelementStart(2, \"span\");\n        i0.ɵɵtext(3);\n        i0.ɵɵpipe(4, \"cxTranslate\");\n        i0.ɵɵelement(5, \"cx-icon\", 2);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(4, 2, \"productImageZoomTrigger.expand\"), \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"type\", ctx.iconType.EXPAND_ARROWS);\n      }\n    },\n    directives: [i1.IconComponent],\n    pipes: [i3$1.TranslatePipe],\n    encapsulation: 2,\n    changeDetection: 0\n  });\n  return ProductImageZoomTriggerComponent;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet ProductImageZoomProductImagesComponent = /*#__PURE__*/(() => {\n  class ProductImageZoomProductImagesComponent extends ProductImagesComponent {\n    constructor(currentProductService) {\n      super(currentProductService);\n      this.currentProductService = currentProductService;\n      this.expandImage = new BehaviorSubject(false);\n    }\n    openImage(item) {\n      var _a, _b;\n      this.mainMediaContainer.next(item);\n      this.selectedIndex = (_b = (_a = this.mainMediaContainer.value) === null || _a === void 0 ? void 0 : _a.zoom) === null || _b === void 0 ? void 0 : _b.galleryIndex;\n    }\n    /**\n     * Opens image zoom dialog.\n     */\n    triggerZoom(value) {\n      this.expandImage.next(value);\n    }\n  }\n  ProductImageZoomProductImagesComponent.ɵfac = function ProductImageZoomProductImagesComponent_Factory(t) {\n    return new (t || ProductImageZoomProductImagesComponent)(i0.ɵɵdirectiveInject(i1.CurrentProductService));\n  };\n  ProductImageZoomProductImagesComponent.ɵcmp = /* @__PURE__ */i0.ɵɵdefineComponent({\n    type: ProductImageZoomProductImagesComponent,\n    selectors: [[\"cx-product-images\"]],\n    features: [i0.ɵɵInheritDefinitionFeature],\n    decls: 6,\n    vars: 6,\n    consts: [[4, \"ngIf\"], [\"thumb\", \"\"], [3, \"container\", \"click\"], [3, \"expandImage\", \"galleryIndex\", \"dialogClose\"], [\"class\", \"thumbs\", \"itemWidth\", \"120px\", 3, \"items\", \"hideIndicators\", \"template\", 4, \"ngIf\"], [\"itemWidth\", \"120px\", 1, \"thumbs\", 3, \"items\", \"hideIndicators\", \"template\"], [\"tabindex\", \"0\", \"format\", \"product\", 3, \"container\", \"focus\"]],\n    template: function ProductImageZoomProductImagesComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, ProductImageZoomProductImagesComponent_ng_container_0_Template, 3, 3, \"ng-container\", 0);\n        i0.ɵɵpipe(1, \"async\");\n        i0.ɵɵtemplate(2, ProductImageZoomProductImagesComponent_ng_container_2_Template, 2, 1, \"ng-container\", 0);\n        i0.ɵɵpipe(3, \"async\");\n        i0.ɵɵtemplate(4, ProductImageZoomProductImagesComponent_ng_template_4_Template, 2, 5, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(1, 2, ctx.mainImage$));\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(3, 4, ctx.thumbs$));\n      }\n    },\n    directives: [i3.NgIf, i1.MediaComponent, ProductImageZoomTriggerComponent, i1.CarouselComponent],\n    pipes: [i3.AsyncPipe],\n    encapsulation: 2,\n    changeDetection: 0\n  });\n  return ProductImageZoomProductImagesComponent;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet ProductImageZoomModule = /*#__PURE__*/(() => {\n  class ProductImageZoomModule {}\n  ProductImageZoomModule.ɵfac = function ProductImageZoomModule_Factory(t) {\n    return new (t || ProductImageZoomModule)();\n  };\n  ProductImageZoomModule.ɵmod = /* @__PURE__ */i0.ɵɵdefineNgModule({\n    type: ProductImageZoomModule\n  });\n  ProductImageZoomModule.ɵinj = /* @__PURE__ */i0.ɵɵdefineInjector({\n    providers: [provideConfig(defaultProductImageZoomLayoutConfig), provideDefaultConfig({\n      cmsComponents: {\n        ProductImagesComponent: {\n          component: ProductImageZoomProductImagesComponent\n        }\n      }\n    })],\n    imports: [[CarouselModule, CommonModule, I18nModule, IconModule, KeyboardFocusModule, MediaModule, OutletModule, RouterModule]]\n  });\n  return ProductImageZoomModule;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet ProductImageZoomComponentsModule = /*#__PURE__*/(() => {\n  class ProductImageZoomComponentsModule {}\n  ProductImageZoomComponentsModule.ɵfac = function ProductImageZoomComponentsModule_Factory(t) {\n    return new (t || ProductImageZoomComponentsModule)();\n  };\n  ProductImageZoomComponentsModule.ɵmod = /* @__PURE__ */i0.ɵɵdefineNgModule({\n    type: ProductImageZoomComponentsModule\n  });\n  ProductImageZoomComponentsModule.ɵinj = /* @__PURE__ */i0.ɵɵdefineInjector({\n    imports: [[ProductImageZoomModule]]\n  });\n  return ProductImageZoomComponentsModule;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { ProductImageZoomComponentsModule, ProductImageZoomDialogComponent, ProductImageZoomModule, ProductImageZoomProductImagesComponent, ProductImageZoomThumbnailsComponent, ProductImageZoomTriggerComponent, ProductImageZoomViewComponent, defaultProductImageZoomLayoutConfig };\n//# sourceMappingURL=spartacus-product-image-zoom-components.js.map","map":null,"metadata":{},"sourceType":"module"}