{"ast":null,"code":"import * as i1 from '@spartacus/core';\nimport * as i0 from '@angular/core';\nimport { Injectable } from '@angular/core';\nimport { of } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\nlet BulkPricingService = /*#__PURE__*/(() => {\n  class BulkPricingService {\n    constructor(productService) {\n      this.productService = productService;\n      this.PRODUCT_SCOPE = \"bulkPrices\" /* BULK_PRICES */;\n    }\n\n    getBulkPrices(productCode) {\n      return this.productService.get(productCode, this.PRODUCT_SCOPE).pipe(switchMap(productPriceScope => {\n        return of(this.convert(productPriceScope));\n      }));\n    }\n    convert(productPriceScope) {\n      var _a;\n      let bulkPrices = [];\n      if (productPriceScope) {\n        const basePrice = (_a = productPriceScope.price) === null || _a === void 0 ? void 0 : _a.value;\n        const volumePrices = productPriceScope.volumePrices;\n        bulkPrices = volumePrices === null || volumePrices === void 0 ? void 0 : volumePrices.map(volumePrice => this.parsePrice(volumePrice, basePrice));\n      }\n      return bulkPrices;\n    }\n    parsePrice(priceTier, basePrice) {\n      const bulkPriceTemplate = {\n        currencyIso: priceTier.currencyIso,\n        formattedValue: priceTier.formattedValue,\n        maxQuantity: priceTier.maxQuantity,\n        minQuantity: priceTier.minQuantity,\n        priceType: priceTier.priceType,\n        value: priceTier.value,\n        formattedDiscount: '',\n        discount: 0\n      };\n      return this.calculateDiscount(bulkPriceTemplate, basePrice);\n    }\n    calculateDiscount(bulkPriceTemplate, basePrice) {\n      const bulkPrice = Object.assign({}, bulkPriceTemplate);\n      const tierPrice = bulkPriceTemplate.value;\n      if (tierPrice && basePrice) {\n        const discount = Math.round(100.0 - tierPrice / basePrice * 100);\n        const formatted = discount === 0 ? `${discount}%` : `-${discount}%`;\n        bulkPrice.formattedDiscount = formatted;\n        bulkPrice.discount = discount;\n      }\n      return bulkPrice;\n    }\n  }\n  BulkPricingService.ɵfac = function BulkPricingService_Factory(t) {\n    return new (t || BulkPricingService)(i0.ɵɵinject(i1.ProductService));\n  };\n  BulkPricingService.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n    token: BulkPricingService,\n    factory: BulkPricingService.ɵfac,\n    providedIn: 'root'\n  });\n  return BulkPricingService;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { BulkPricingService };\n//# sourceMappingURL=spartacus-product-bulk-pricing-core.js.map","map":null,"metadata":{},"sourceType":"module"}